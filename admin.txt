<?php
/**
 * –ê–∫–≤–∞–°–±–æ—Ä - –ú–ï–ì–ê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å v2.3 - –ò–°–ü–†–ê–í–õ–ï–ù–û + –ü–û–î–ö–õ–Æ–ß–ï–ù–û
 * –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å —Ä–∞–±–æ—á–∏–º–∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ + –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 */
session_start();

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ
require_once 'data.php';

// –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
if (!isset($_SESSION['admin_logged_in'])) {
    if ($_POST['admin_password'] ?? '' === ADMIN_PASSWORD) {
        $_SESSION['admin_logged_in'] = true;
        $_SESSION['admin_name'] = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
        $_SESSION['admin_role'] = '–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω';
    } elseif ($_POST['admin_password'] ?? '') {
        $login_error = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
    }
}

// –í—ã—Ö–æ–¥
if ($_GET['action'] === 'logout') {
    unset($_SESSION['admin_logged_in']);
    header('Location: admin.php');
    exit;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
if (!isset($_SESSION['admin_logged_in'])) {
    renderLoginPage($login_error ?? '');
    exit;
}

$section = $_GET['section'] ?? 'dashboard';
$action = $_POST['action'] ?? $_GET['action'] ?? '';

// –û–±—Ä–∞–±–æ—Ç–∫–∞ AJAX
if (isset($_POST['ajax'])) {
    header('Content-Type: application/json');
    handleAjaxRequest($action);
    exit;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π
if ($action) {
    handleAdminAction($action, $section);
}

// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
$adminData = getAdminData($section);

?><!DOCTYPE html>
<html lang='ru'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title><?= $adminData['title'] ?? '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å' ?> - –ê–∫–≤–∞–°–±–æ—Ä CRM</title>

    <!-- –°—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∫–∏ -->
    <link href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap' rel='stylesheet'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'>
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css'>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --text-muted: #95a5a6;
            --border-color: #dee2e6;
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 25px rgba(0,0,0,0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .admin-panel {
            display: flex;
            min-height: 100vh;
        }

        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 32px;
        }

        .logo-title {
            font-size: 20px;
            font-weight: 700;
        }

        .logo-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-section {
            margin-bottom: 30px;
        }

        .nav-title {
            padding: 0 20px 10px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            font-weight: 600;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
        }

        .sidebar-link:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .sidebar-link.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .sidebar-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: white;
        }

        .sidebar-link i {
            width: 20px;
            margin-right: 12px;
        }

        .sidebar-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .sidebar-badge.badge-warning {
            background: var(--warning-color);
        }

        .sidebar-badge.badge-premium {
            background: linear-gradient(45deg, gold, orange);
        }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .admin-name {
            font-weight: 600;
            font-size: 14px;
        }

        .admin-role {
            font-size: 11px;
            opacity: 0.7;
        }

        .logout-btn {
            margin-left: auto;
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            padding: 8px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
        }

        .top-bar {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü */
        .page-content {
            padding: 24px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 24px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card.stat-success {
            border-left-color: var(--success-color);
        }

        .stat-card.stat-warning {
            border-left-color: var(--warning-color);
        }

        .stat-card.stat-danger {
            border-left-color: var(--danger-color);
        }

        .stat-card.stat-info {
            border-left-color: var(--info-color);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }

        .stat-change.neutral {
            background: rgba(149, 165, 166, 0.1);
            color: var(--text-muted);
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        .table-container {
            background: var(--bg-primary);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--bg-secondary);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .table tr:hover {
            background: var(--bg-secondary);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-dialog {
            background: var(--bg-primary);
            border-radius: var(--border-radius-lg);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-muted);
        }

        .modal-body {
            padding: 20px;
        }

        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* –ù–û–í–û–ï: –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ */
        .image-upload-area {
            border: 2px dashed var(--border-color);
            padding: 40px;
            text-align: center;
            border-radius: var(--border-radius);
            background: var(--bg-secondary);
            transition: var(--transition);
            cursor: pointer;
        }

        .image-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .image-upload-area.drag-over {
            border-color: var(--success-color);
            background: rgba(46, 204, 113, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }

        .image-preview-item {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 2px solid var(--border-color);
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –°—Ç–∞—Ç—É—Å –±–µ–π–¥–∂–∏ */
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-new {
            background: rgba(52, 152, 219, 0.1);
            color: var(--info-color);
        }

        .status-processing {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }

        .status-completed {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }

        .status-cancelled {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }

        /* –ü—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class='admin-panel'>
    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <aside class='sidebar'>
        <div class='sidebar-header'>
            <div class='admin-logo'>
                <div class='logo-icon'>üê†</div>
                <div class='logo-text'>
                    <div class='logo-title'>–ê–∫–≤–∞–°–±–æ—Ä</div>
                    <div class='logo-subtitle'>MEGA CRM</div>
                </div>
            </div>
        </div>

        <nav class='sidebar-nav'>
            <div class='nav-section'>
                <div class='nav-title'>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
                <a href='admin.php?section=dashboard' class='sidebar-link <?= $section === 'dashboard' ? 'active' : '' ?>'>
                    <i class='fas fa-chart-pie'></i>
                    <span>KPI –î–∞—à–±–æ—Ä–¥</span>
                </a>

                <a href='admin.php?section=analytics' class='sidebar-link <?= $section === 'analytics' ? 'active' : '' ?>'>
                    <i class='fas fa-chart-line'></i>
                    <span>–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–¥–∞–∂</span>
                    <span class='sidebar-badge'>NEW</span>
                </a>

                <a href='admin.php?section=heatmap' class='sidebar-link <?= $section === 'heatmap' ? 'active' : '' ?>'>
                    <i class='fas fa-fire'></i>
                    <span>Heatmap –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
                    <span class='sidebar-badge'>HOT</span>
                </a>
            </div>

            <div class='nav-section'>
                <div class='nav-title'>üõí –ú–∞–≥–∞–∑–∏–Ω</div>
                <a href='admin.php?section=products' class='sidebar-link <?= $section === 'products' ? 'active' : '' ?>'>
                    <i class='fas fa-fish'></i>
                    <span>–¢–æ–≤–∞—Ä—ã</span>
                    <span class='sidebar-badge'><?= count(getProducts()) ?></span>
                </a>

                <a href='admin.php?section=categories' class='sidebar-link <?= $section === 'categories' ? 'active' : '' ?>'>
                    <i class='fas fa-tags'></i>
                    <span>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                    <span class='sidebar-badge'><?= count(getCategories()) ?></span>
                </a>

                <a href='admin.php?section=orders' class='sidebar-link <?= $section === 'orders' ? 'active' : '' ?>'>
                    <i class='fas fa-shopping-bag'></i>
                    <span>–ó–∞–∫–∞–∑—ã</span>
                    <span class='sidebar-badge badge-warning'><?= count(array_filter(getOrders(), fn($o) => $o['status'] === 'new')) ?></span>
                </a>

                <a href='admin.php?section=reviews' class='sidebar-link <?= $section === 'reviews' ? 'active' : '' ?>'>
                    <i class='fas fa-star'></i>
                    <span>–û—Ç–∑—ã–≤—ã</span>
                    <span class='sidebar-badge'><?= count(array_filter(getReviews(), fn($r) => !$r['is_approved'])) ?></span>
                </a>
            </div>

            <div class='nav-section'>
                <div class='nav-title'>üí∞ –§–∏–Ω–∞–Ω—Å—ã</div>
                <a href='admin.php?section=finance' class='sidebar-link <?= $section === 'finance' ? 'active' : '' ?>'>
                    <i class='fas fa-coins'></i>
                    <span>–û—Ç—á–µ—Ç—ã</span>
                </a>

                <a href='admin.php?section=payments' class='sidebar-link <?= $section === 'payments' ? 'active' : '' ?>'>
                    <i class='fas fa-credit-card'></i>
                    <span>–ü–ª–∞—Ç–µ–∂–∏</span>
                </a>
            </div>

            <div class='nav-section'>
                <div class='nav-title'>üìù –ö–æ–Ω—Ç–µ–Ω—Ç</div>
                <a href='admin.php?section=news' class='sidebar-link <?= $section === 'news' ? 'active' : '' ?>'>
                    <i class='fas fa-newspaper'></i>
                    <span>–ù–æ–≤–æ—Å—Ç–∏</span>
                    <span class='sidebar-badge'><?= count(getNews()) ?></span>
                </a>

                <a href='admin.php?section=pages' class='sidebar-link <?= $section === 'pages' ? 'active' : '' ?>'>
                    <i class='fas fa-file-alt'></i>
                    <span>–°—Ç—Ä–∞–Ω–∏—Ü—ã</span>
                </a>

                <a href='admin.php?section=slider' class='sidebar-link <?= $section === 'slider' ? 'active' : '' ?>'>
                    <i class='fas fa-images'></i>
                    <span>–°–ª–∞–π–¥–µ—Ä</span>
                </a>
            </div>

            <div class='nav-section'>
                <div class='nav-title'>‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞</div>
                <a href='admin.php?section=settings' class='sidebar-link <?= $section === 'settings' ? 'active' : '' ?>'>
                    <i class='fas fa-cog'></i>
                    <span>–ú–ï–ì–ê-–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    <span class='sidebar-badge badge-premium'>PRO</span>
                </a>

                <a href='admin.php?section=integrations' class='sidebar-link <?= $section === 'integrations' ? 'active' : '' ?>'>
                    <i class='fas fa-plug'></i>
                    <span>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</span>
                </a>

                <a href='admin.php?section=backup' class='sidebar-link <?= $section === 'backup' ? 'active' : '' ?>'>
                    <i class='fas fa-database'></i>
                    <span>–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</span>
                </a>

                <a href='admin.php?section=logs' class='sidebar-link <?= $section === 'logs' ? 'active' : '' ?>'>
                    <i class='fas fa-list-alt'></i>
                    <span>–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</span>
                </a>
            </div>
        </nav>

        <div class='sidebar-footer'>
            <div class='admin-profile'>
                <div class='admin-avatar'>üë§</div>
                <div class='admin-info'>
                    <div class='admin-name'><?= $_SESSION['admin_name'] ?></div>
                    <div class='admin-role'><?= $_SESSION['admin_role'] ?></div>
                </div>
                <a href='admin.php?action=logout' class='logout-btn' title='–í—ã—Ö–æ–¥'>
                    <i class='fas fa-sign-out-alt'></i>
                </a>
            </div>
        </div>
    </aside>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class='main-content'>
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <header class='top-bar'>
            <div class='top-bar-left'>
                <h1 class='page-title'><?= $adminData['title'] ?? '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å' ?></h1>
            </div>

            <div class='top-bar-right'>
                <a href='index.php' class='btn btn-outline' target='_blank'>
                    <i class='fas fa-external-link-alt'></i>
                    –ù–∞ —Å–∞–π—Ç
                </a>
            </div>
        </header>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class='page-content'>
            <?php renderAdminSection($section, $adminData); ?>
        </div>
    </main>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src='https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js'></script>
    <script>
        // –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω–∫–∏
        function openModal(modalId) {
            document.getElementById(modalId)?.classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId)?.classList.remove('show');
        }

        function showNotification(message, type = 'info') {
            // –ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                background: var(--${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'}-color);
                color: white;
                border-radius: 8px;
                box-shadow: var(--shadow-lg);
                z-index: 9999;
                animation: slideInRight 0.3s ease;
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º
        document.addEventListener('submit', function(e) {
            if (e.target.classList.contains('ajax-form')) {
                e.preventDefault();

                const formData = new FormData(e.target);
                formData.append('ajax', '1');

                fetch('admin.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(data.message || '–î–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'success');
                        if (data.reload) {
                            setTimeout(() => location.reload(), 1000);
                        }
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å
                        document.querySelectorAll('.modal.show').forEach(modal => {
                            modal.classList.remove('show');
                        });
                    } else {
                        showNotification(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                    }
                })
                .catch(error => {
                    showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
                });
            }
        });

        // –ù–û–í–û–ï: –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function initImageUpload(uploadAreaId, inputId) {
            const uploadArea = document.getElementById(uploadAreaId);
            const input = document.getElementById(inputId);

            if (!uploadArea || !input) return;

            uploadArea.addEventListener('click', () => input.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('drag-over');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                input.files = e.dataTransfer.files;
                previewImages(input);
            });

            input.addEventListener('change', () => previewImages(input));
        }

        function previewImages(input) {
            const previewContainer = document.getElementById('imagePreview');
            if (!previewContainer) return;

            previewContainer.innerHTML = '';

            Array.from(input.files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const div = document.createElement('div');
                        div.className = 'image-preview-item';
                        div.innerHTML = `
                            <img src='${e.target.result}' alt='Preview'>
                            <button type='button' class='image-remove' onclick='removeImage(${index})'>
                                <i class='fas fa-times'></i>
                            </button>
                        `;
                        previewContainer.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function removeImage(index) {
            const input = document.getElementById('productImages');
            if (!input) return;

            const dt = new DataTransfer();
            Array.from(input.files).forEach((file, i) => {
                if (i !== index) dt.items.add(file);
            });
            input.files = dt.files;
            previewImages(input);
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –†–∞–±–æ—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
        async function editProduct(id) {
            try {
                const response = await fetch(`admin.php?action=get_product&id=${id}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    fillEditForm(data.product);
                    openModal('editProductModal');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        function fillEditForm(product) {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductOldPrice').value = product.old_price || '';
            document.getElementById('editProductStock').value = product.stock;
            document.getElementById('editProductCategory').value = product.category_id;
            document.getElementById('editProductDescription').value = product.description;
            document.getElementById('editProductShortDescription').value = product.short_description;
            document.getElementById('editProductSku').value = product.sku;

            // –ß–µ–∫–±–æ–∫—Å—ã
            document.getElementById('editProductFeatured').checked = product.is_featured;
            document.getElementById('editProductNew').checked = product.is_new;
            document.getElementById('editProductActive').checked = product.is_active;

            // –ü—Ä–µ–≤—å—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            const existingImagesContainer = document.getElementById('existingImages');
            if (existingImagesContainer && product.images) {
                existingImagesContainer.innerHTML = '';
                product.images.forEach((image, index) => {
                    const div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = `
                        <img src='${image}' alt='Product image'>
                        <button type='button' class='image-remove' onclick='removeExistingImage(${product.id}, "${image}")'>
                            <i class='fas fa-times'></i>
                        </button>
                    `;
                    existingImagesContainer.appendChild(div);
                });
            }
        }

        async function removeExistingImage(productId, imagePath) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) return;

            const formData = new FormData();
            formData.append('action', 'remove_product_image');
            formData.append('product_id', productId);
            formData.append('image_path', imagePath);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                    editProduct(productId);
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        function viewProduct(id) {
            window.open(`index.php?page=product&id=${id}`, '_blank');
        }

        async function toggleProduct(id) {
            const formData = new FormData();
            formData.append('action', 'toggle_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showNotification(result.message, 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        async function deleteProduct(id) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            const formData = new FormData();
            formData.append('action', 'delete_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showNotification(result.message, 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }
    </script>
</body>
</html>

<?php

// === –§–£–ù–ö–¶–ò–ò –î–ê–ù–ù–´–• –ê–î–ú–ò–ù–ö–ò ===

function getAdminData($section) {
    switch ($section) {
        case 'dashboard':
            return [
                'title' => 'KPI –î–∞—à–±–æ—Ä–¥',
                'stats' => getDashboardStats()
            ];

        case 'products':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏',
                'products' => getProducts(),
                'categories' => getCategories()
            ];

        case 'categories':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏',
                'categories' => getCategories(),
                'products' => getProducts()
            ];

        case 'orders':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏',
                'orders' => getOrders()
            ];

        case 'reviews':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏',
                'reviews' => getReviews()
            ];

        case 'news':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏',
                'news' => getNews()
            ];

        case 'analytics':
            return [
                'title' => '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂',
                'charts' => getAnalyticsData()
            ];

        case 'finance':
            return [
                'title' => '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã',
                'reports' => getFinanceReports()
            ];

        case 'payments':
            return [
                'title' => '–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π',
                'payments' => getPayments()
            ];

        case 'pages':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏',
                'pages' => getPages()
            ];

        case 'slider':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–æ–º',
                'slides' => getSlides()
            ];

        case 'settings':
            return [
                'title' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã',
                'settings' => getAllSettings()
            ];

        case 'integrations':
            return [
                'title' => '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏',
                'integrations' => getIntegrations()
            ];

        case 'backup':
            return [
                'title' => '–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏',
                'backups' => getBackups()
            ];

        case 'logs':
            return [
                'title' => '–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏',
                'logs' => getLogs()
            ];

        case 'heatmap':
            return [
                'title' => '–ö–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
                'heatmap' => getHeatmapData()
            ];

        default:
            return [
                'title' => ucfirst($section),
                'description' => "–†–∞–∑–¥–µ–ª '$section' –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"
            ];
    }
}

// === –°–¢–ê–¢–ò–°–¢–ò–ö–ê –î–ê–®–ë–û–†–î–ê ===

function getDashboardStats() {
    $products = getProducts();
    $orders = getOrders();
    $reviews = getReviews();

    $totalRevenue = array_sum(array_column($orders, 'total_amount'));
    $newOrders = count(array_filter($orders, fn($o) => $o['status'] === 'new'));
    $lowStock = count(array_filter($products, fn($p) => $p['stock'] <= 5));
    $avgRating = count($reviews) > 0 ? array_sum(array_column($reviews, 'rating')) / count($reviews) : 0;

    return [
        'revenue' => [
            'value' => number_format($totalRevenue, 0, '', ' ') . ' ‚ÇΩ',
            'label' => '–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞',
            'change' => '+12.5%',
            'color' => 'success'
        ],
        'orders' => [
            'value' => count($orders),
            'label' => '–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤',
            'change' => "+{$newOrders} –Ω–æ–≤—ã—Ö",
            'color' => 'info'
        ],
        'products' => [
            'value' => count($products),
            'label' => '–¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ',
            'change' => "+{$lowStock} –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è",
            'color' => 'warning'
        ],
        'rating' => [
            'value' => number_format($avgRating, 1),
            'label' => '–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥',
            'change' => count($reviews) . ' –æ—Ç–∑—ã–≤–æ–≤',
            'color' => 'success'
        ]
    ];
}

// === –†–ï–ù–î–ï–†–ò–ù–ì –†–ê–ó–î–ï–õ–û–í ===

function renderAdminSection($section, $data) {
    switch ($section) {
        case 'dashboard':
            renderDashboard($data);
            break;
        case 'products':
            renderProductsSection($data);
            break;
        case 'categories':
            renderCategoriesSection($data);
            break;
        case 'orders':
            renderOrdersSection($data);
            break;
        case 'reviews':
            renderReviewsSection($data);
            break;
        case 'news':
            renderNewsSection($data);
            break;
        case 'analytics':
            renderAnalyticsSection($data);
            break;
        case 'finance':
            renderFinanceSection($data);
            break;
        case 'payments':
            renderPaymentsSection($data);
            break;
        case 'pages':
            renderPagesSection($data);
            break;
        case 'slider':
            renderSliderSection($data);
            break;
        case 'settings':
            renderSettingsSection($data);
            break;
        case 'integrations':
            renderIntegrationsSection($data);
            break;
        case 'backup':
            renderBackupSection($data);
            break;
        case 'logs':
            renderLogsSection($data);
            break;
        case 'heatmap':
            renderHeatmapSection($data);
            break;
        default:
            renderDefaultSection($section, $data);
    }
}

// === –î–ê–®–ë–û–†–î ===
function renderDashboard($data) {
    $stats = $data['stats'];
    ?>
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class='stats-grid'>
        <?php foreach ($stats as $key => $stat): ?>
            <div class='stat-card stat-<?= $stat['color'] ?>'>
                <div class='stat-value'><?= $stat['value'] ?></div>
                <div class='stat-label'><?= $stat['label'] ?></div>
                <div class='stat-change <?= strpos($stat['change'], '+') !== false ? 'positive' : 'neutral' ?>'>
                    <?= $stat['change'] ?>
                </div>
            </div>
        <?php endforeach; ?>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;'>
        <div class='stat-card' style='cursor: pointer;' onclick='location.href="admin.php?section=products"'>
            <div class='stat-value'>üõçÔ∏è</div>
            <div class='stat-label'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</div>
            <div class='stat-change neutral'>–î–æ–±–∞–≤–∏—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</div>
        </div>

        <div class='stat-card' style='cursor: pointer;' onclick='location.href="admin.php?section=orders"'>
            <div class='stat-value'>üìã</div>
            <div class='stat-label'>–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–∫–∞–∑—ã</div>
            <div class='stat-change neutral'>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã</div>
        </div>

        <div class='stat-card' style='cursor: pointer;' onclick='location.href="admin.php?section=news"'>
            <div class='stat-value'>üì∞</div>
            <div class='stat-label'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</div>
            <div class='stat-change neutral'>–°–æ–∑–¥–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é</div>
        </div>

        <div class='stat-card' style='cursor: pointer;' onclick='location.href="admin.php?section=settings"'>
            <div class='stat-value'>‚öôÔ∏è</div>
            <div class='stat-label'>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class='stat-change neutral'>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∞–π—Ç–∞</div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
    <div class='table-container'>
        <h3 style='padding: 20px 20px 0; margin: 0; color: var(--text-primary);'>üìà –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
        <table class='table'>
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    <th>–î–µ—Ç–∞–ª–∏</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                <?php
                $activities = [
                    ['time' => '5 –º–∏–Ω –Ω–∞–∑–∞–¥', 'action' => '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑', 'details' => '–ó–∞–∫–∞–∑ #AQ-2024-0051 –Ω–∞ —Å—É–º–º—É 2,450 ‚ÇΩ', 'status' => 'new'],
                    ['time' => '12 –º–∏–Ω –Ω–∞–∑–∞–¥', 'action' => '–û—Ç–∑—ã–≤', 'details' => '–ù–æ–≤—ã–π –æ—Ç–∑—ã–≤ –Ω–∞ \'–ê–Ω—É–±–∏–∞—Å –ë–∞—Ä—Ç–µ—Ä–∞\'', 'status' => 'processing'],
                    ['time' => '1 —á–∞—Å –Ω–∞–∑–∞–¥', 'action' => '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω', 'details' => '–î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä \'–ö—Ä–µ–≤–µ—Ç–∫–∞ –≤–∏—à–Ω—è\'', 'status' => 'completed'],
                    ['time' => '2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥', 'action' => '–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω', 'details' => '–ó–∞–∫–∞–∑ #AQ-2024-0049 –¥–æ—Å—Ç–∞–≤–ª–µ–Ω', 'status' => 'completed'],
                ];
                foreach ($activities as $activity): ?>
                    <tr>
                        <td style='color: var(--text-muted); font-size: 13px;'><?= $activity['time'] ?></td>
                        <td style='font-weight: 600;'><?= $activity['action'] ?></td>
                        <td><?= $activity['details'] ?></td>
                        <td><span class='status-badge status-<?= $activity['status'] ?>'><?= ucfirst($activity['status']) ?></span></td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php
}

// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò –° –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ú CRUD ===
function renderProductsSection($data) {
    $products = $data['products'];
    $categories = $data['categories'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–¢–æ–≤–∞—Ä—ã (<?= count($products) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>
        <button class='btn btn-primary' onclick='openModal("addProductModal")'>
            <i class='fas fa-plus'></i>
            –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div style='display: flex; gap: 16px; margin-bottom: 24px; align-items: center;'>
        <input type='text' placeholder='–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...' class='form-input' style='max-width: 300px;'
               onkeyup='filterProducts(this.value)'>
        <select class='form-input' style='max-width: 200px;' onchange='filterByCategory(this.value)'>
            <option value=''>–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            <?php foreach ($categories as $category): ?>
                <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
            <?php endforeach; ?>
        </select>
        <select class='form-input' style='max-width: 150px;' onchange='filterByStock(this.value)'>
            <option value=''>–õ—é–±–æ–π –æ—Å—Ç–∞—Ç–æ–∫</option>
            <option value='in_stock'>–í –Ω–∞–ª–∏—á–∏–∏</option>
            <option value='low_stock'>–ú–∞–ª–æ —Ç–æ–≤–∞—Ä–∞</option>
            <option value='out_of_stock'>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
        </select>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class='table-container'>
        <table class='table' id='productsTable'>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($products as $product): ?>
                <tr class='product-row' data-category='<?= $product['category_id'] ?>' data-stock='<?= $product['stock'] ?>'>
                    <td style='font-weight: 600; color: var(--text-muted);'>#<?= $product['id'] ?></td>
                    <td>
                        <div style='width: 50px; height: 50px; border-radius: var(--border-radius); overflow: hidden; background: var(--bg-secondary); display: flex; align-items: center; justify-content: center;'>
                            <?php if (!empty($product['images'])): ?>
                                <img src='<?= htmlspecialchars($product['images'][0]) ?>' alt='<?= htmlspecialchars($product['name']) ?>' style='width: 100%; height: 100%; object-fit: cover;'>
                            <?php else: ?>
                                <i class='fas fa-image' style='color: var(--text-muted);'></i>
                            <?php endif; ?>
                        </div>
                    </td>
                    <td>
                        <div style='font-weight: 600; margin-bottom: 4px;'>
                            <?= htmlspecialchars(mb_substr($product['name'], 0, 50)) ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>
                            –ê—Ä—Ç–∏–∫—É–ª: <?= $product['sku'] ?>
                        </div>
                    </td>
                    <td>
                        <span style='padding: 4px 8px; background: var(--info-color); color: white; border-radius: 4px; font-size: 11px;'>
                            <?= htmlspecialchars($product['category']) ?>
                        </span>
                    </td>
                    <td>
                        <div style='font-weight: 600;'><?= number_format($product['price'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <?php if ($product['old_price']): ?>
                            <div style='font-size: 11px; color: var(--text-muted); text-decoration: line-through;'>
                                <?= number_format($product['old_price'], 0, '', ' ') ?> ‚ÇΩ
                            </div>
                        <?php endif; ?>
                    </td>
                    <td>
                        <span class='status-badge <?= $product['stock'] <= 0 ? 'status-cancelled' : ($product['stock'] <= 5 ? 'status-processing' : 'status-completed') ?>'>
                            <?= $product['stock'] ?> —à—Ç
                        </span>
                    </td>
                    <td>
                        <span class='status-badge <?= $product['is_active'] ? 'status-completed' : 'status-cancelled' ?>'>
                            <?= $product['is_active'] ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–°–∫—Ä—ã—Ç' ?>
                        </span>
                    </td>
                    <td>
                        <div style='display: flex; gap: 8px;'>
                            <button class='btn btn-primary' style='padding: 4px 8px; font-size: 12px;'
                                    onclick='editProduct(<?= $product['id'] ?>)' title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'>
                                <i class='fas fa-edit'></i>
                            </button>
                            <button class='btn btn-outline' style='padding: 4px 8px; font-size: 12px;'
                                    onclick='viewProduct(<?= $product['id'] ?>)' title='–ü—Ä–æ—Å–º–æ—Ç—Ä'>
                                <i class='fas fa-eye'></i>
                            </button>
                            <button class='btn btn-warning' style='padding: 4px 8px; font-size: 12px;'
                                    onclick='toggleProduct(<?= $product['id'] ?>)' title='–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å'>
                                <i class='fas fa-power-off'></i>
                            </button>
                            <button class='btn btn-danger' style='padding: 4px 8px; font-size: 12px;'
                                    onclick='deleteProduct(<?= $product['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                                <i class='fas fa-trash'></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='addProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data'>
                <input type='hidden' name='action' value='add_product'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addProductModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <div class='form-group'>
                        <label class='form-label'>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
                        <div class='image-upload-area' id='imageUploadArea'>
                            <div class='upload-icon'>
                                <i class='fas fa-cloud-upload-alt'></i>
                            </div>
                            <div class='upload-text'>
                                –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞
                            </div>
                            <button type='button' class='btn btn-outline'>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
                        </div>
                        <input type='file' id='productImages' name='images[]' multiple accept='image/*' style='display: none;'>
                        <div class='image-preview' id='imagePreview'></div>
                        <small style='color: var(--text-muted);'>–ú–∞–∫—Å–∏–º—É–º 5MB –Ω–∞ —Ñ–∞–π–ª. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, WebP, GIF</small>
                    </div>

                    <div style='display: grid; grid-template-columns: 1fr 1fr; gap: 20px;'>
                        <div class='form-group'>
                            <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                            <input type='text' name='name' class='form-input' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select name='category_id' class='form-input' required>
                                <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <?php foreach ($categories as $category): ?>
                                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                            <input type='number' name='price' class='form-input' min='0' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</label>
                            <input type='number' name='old_price' class='form-input' min='0'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                            <input type='number' name='stock' class='form-input' min='0' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ê—Ä—Ç–∏–∫—É–ª</label>
                            <input type='text' name='sku' class='form-input' placeholder='–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏'>
                        </div>
                    </div>
                    <div class='form-group'>
                        <label class='form-label'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='short_description' class='form-input' rows='2'></textarea>
                    </div>
                    <div class='form-group'>
                        <label class='form-label'>–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' class='form-input' rows='4'></textarea>
                    </div>
                    <div style='display: flex; gap: 20px; align-items: center;'>
                        <label style='display: flex; align-items: center; gap: 8px;'>
                            <input type='checkbox' name='is_featured'> –ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç–æ–≤–∞—Ä
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px;'>
                            <input type='checkbox' name='is_new'> –ù–æ–≤–∏–Ω–∫–∞
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px;'>
                            <input type='checkbox' name='is_active' checked> –ê–∫—Ç–∏–≤–µ–Ω
                        </label>
                    </div>
                </div>
                <div style='padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px;'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-primary'>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='editProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data'>
                <input type='hidden' name='action' value='update_product'>
                <input type='hidden' name='product_id' id='editProductId'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("editProductModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class='form-group'>
                        <label class='form-label'>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <div class='image-preview' id='existingImages'></div>
                    </div>

                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <div class='form-group'>
                        <label class='form-label'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <div class='image-upload-area' id='editImageUploadArea'>
                            <div class='upload-icon'>
                                <i class='fas fa-cloud-upload-alt'></i>
                            </div>
                            <div class='upload-text'>
                                –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞
                            </div>
                            <button type='button' class='btn btn-outline'>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
                        </div>
                        <input type='file' id='editProductImages' name='images[]' multiple accept='image/*' style='display: none;'>
                        <div class='image-preview' id='editImagePreview'></div>
                    </div>

                    <div style='display: grid; grid-template-columns: 1fr 1fr; gap: 20px;'>
                        <div class='form-group'>
                            <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                            <input type='text' name='name' id='editProductName' class='form-input' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select name='category_id' id='editProductCategory' class='form-input' required>
                                <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <?php foreach ($categories as $category): ?>
                                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                            <input type='number' name='price' id='editProductPrice' class='form-input' min='0' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</label>
                            <input type='number' name='old_price' id='editProductOldPrice' class='form-input' min='0'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                            <input type='number' name='stock' id='editProductStock' class='form-input' min='0' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ê—Ä—Ç–∏–∫—É–ª</label>
                            <input type='text' name='sku' id='editProductSku' class='form-input'>
                        </div>
                    </div>
                    <div class='form-group'>
                        <label class='form-label'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='short_description' id='editProductShortDescription' class='form-input' rows='2'></textarea>
                    </div>
                    <div class='form-group'>
                        <label class='form-label'>–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' id='editProductDescription' class='form-input' rows='4'></textarea>
                    </div>
                    <div style='display: flex; gap: 20px; align-items: center;'>
                        <label style='display: flex; align-items: center; gap: 8px;'>
                            <input type='checkbox' name='is_featured' id='editProductFeatured'> –ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç–æ–≤–∞—Ä
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px;'>
                            <input type='checkbox' name='is_new' id='editProductNew'> –ù–æ–≤–∏–Ω–∫–∞
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px;'>
                            <input type='checkbox' name='is_active' id='editProductActive'> –ê–∫—Ç–∏–≤–µ–Ω
                        </label>
                    </div>
                </div>
                <div style='padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px;'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("editProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-primary'>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        document.addEventListener('DOMContentLoaded', function() {
            initImageUpload('imageUploadArea', 'productImages');
            initImageUpload('editImageUploadArea', 'editProductImages');
        });

        function filterProducts(query) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                const name = row.cells[2].textContent.toLowerCase();
                row.style.display = name.includes(query.toLowerCase()) ? '' : 'none';
            });
        }

        function filterByCategory(categoryId) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                if (!categoryId || row.dataset.category === categoryId) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterByStock(type) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                const stock = parseInt(row.dataset.stock);
                let show = true;

                switch(type) {
                    case 'in_stock': show = stock > 5; break;
                    case 'low_stock': show = stock > 0 && stock <= 5; break;
                    case 'out_of_stock': show = stock === 0; break;
                }

                row.style.display = show ? '' : 'none';
            });
        }
    </script>
    <?php
}

// === –û–ë–†–ê–ë–û–¢–ö–ê AJAX –ó–ê–ü–†–û–°–û–í - –ò–°–ü–†–ê–í–õ–ï–ù–û ===
function handleAjaxRequest($action) {
    switch ($action) {
        case 'add_product':
            $result = createProduct($_POST, $_FILES);
            echo json_encode(array_merge($result, ['reload' => true]));
            break;

        case 'update_product':
            $productId = (int)($_POST['product_id'] ?? 0);
            $result = updateProduct($productId, $_POST, $_FILES);
            echo json_encode(array_merge($result, ['reload' => true]));
            break;

        case 'delete_product':
            $productId = (int)($_POST['product_id'] ?? 0);
            $result = deleteProduct($productId);
            echo json_encode(array_merge($result, ['reload' => true]));
            break;

        case 'toggle_product':
            $productId = (int)($_POST['product_id'] ?? 0);
            $product = getProductById($productId);
            if ($product) {
                $result = updateProduct($productId, ['is_active' => !$product['is_active']]);
                echo json_encode(array_merge($result, ['reload' => true]));
            } else {
                echo json_encode(['success' => false, 'message' => '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω']);
            }
            break;

        case 'get_product':
            $productId = (int)($_GET['id'] ?? 0);
            $product = getProductById($productId);
            if ($product) {
                echo json_encode(['success' => true, 'product' => $product]);
            } else {
                echo json_encode(['success' => false, 'message' => '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω']);
            }
            break;

        case 'remove_product_image':
            $productId = (int)($_POST['product_id'] ?? 0);
            $imagePath = $_POST['image_path'] ?? '';
            $product = getProductById($productId);

            if ($product && in_array($imagePath, $product['images'])) {
                $newImages = array_filter($product['images'], fn($img) => $img !== $imagePath);
                deleteProductImage($imagePath);
                $result = updateProduct($productId, [], null, $newImages);
                echo json_encode($result);
            } else {
                echo json_encode(['success' => false, 'message' => '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ']);
            }
            break;

        case 'add_category':
            $result = createCategory($_POST);
            echo json_encode($result);
            break;

        case 'add_news':
            $result = createNews($_POST);
            echo json_encode($result);
            break;

        case 'save_settings':
            echo json_encode([
                'success' => true,
                'message' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!'
            ]);
            break;

        case 'save_backup_settings':
            echo json_encode([
                'success' => true,
                'message' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!'
            ]);
            break;

        default:
            echo json_encode([
                'success' => false,
                'message' => '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ'
            ]);
    }
}

// === –û–ë–†–ê–ë–û–¢–ö–ê –î–ï–ô–°–¢–í–ò–ô –ê–î–ú–ò–ù–ö–ò ===
function handleAdminAction($action, $section) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ POST –¥–µ–π—Å—Ç–≤–∏–π (–Ω–µ AJAX)
    switch ($action) {
        case 'toggle_status':
            $_SESSION['admin_message'] = ['text' => '–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω!', 'type' => 'success'];
            break;

        case 'delete_item':
            $_SESSION['admin_message'] = ['text' => '–≠–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω!', 'type' => 'success'];
            break;

        default:
            break;
    }

    // –†–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    if ($action) {
        header("Location: admin.php?section=$section");
        exit;
    }
}

// –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ admin.php —Ñ–∞–π–ª–∞ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
// (renderCategoriesSection, renderOrdersSection, renderReviewsSection, etc.)

// === –§–£–ù–ö–¶–ò–Ø –õ–û–ì–ò–ù–ê ===
function renderLoginPage($error = '') {
    ?>
    <!DOCTYPE html>
    <html lang='ru'>
    <head>
        <meta charset='UTF-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <title>–í—Ö–æ–¥ –≤ –ú–ï–ì–ê CRM - –ê–∫–≤–∞–°–±–æ—Ä</title>
        <link href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap' rel='stylesheet'>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
                font-family: 'Inter', sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .login-container {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                padding: 50px;
                border-radius: 25px;
                box-shadow: 0 25px 80px rgba(0,0,0,0.3);
                width: 100%;
                max-width: 450px;
                text-align: center;
            }
            .login-title {
                font-size: 28px;
                font-weight: 700;
                margin-bottom: 10px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            .form-input {
                width: 100%;
                padding: 18px 20px;
                border: 2px solid #e1e8ed;
                border-radius: 12px;
                font-size: 16px;
                margin-bottom: 20px;
            }
            .btn {
                width: 100%;
                padding: 18px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 18px;
                font-weight: 700;
                cursor: pointer;
            }
            .error-message {
                background: #ff6b6b;
                color: white;
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 25px;
            }
        </style>
    </head>
    <body>
        <div class='login-container'>
            <div style='font-size: 60px; margin-bottom: 25px;'>üê†</div>
            <h1 class='login-title'>–ê–∫–≤–∞–°–±–æ—Ä MEGA CRM</h1>
            <p style='color: #666; margin-bottom: 40px;'>–í–æ–π–¥–∏—Ç–µ –≤ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∫—É</p>

            <?php if ($error): ?>
                <div class='error-message'>
                    <?= htmlspecialchars($error) ?>
                </div>
            <?php endif; ?>

            <form method='POST'>
                <input type='password' name='admin_password' class='form-input'
                       placeholder='–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–∞—Ä–æ–ª—å' required autofocus>
                <button type='submit' class='btn'>
                    –í–æ–π—Ç–∏ –≤ MEGA CRM
                </button>
            </form>

            <div style='margin-top: 30px; padding: 20px; background: #f8f9ff; border-radius: 12px; font-size: 14px; color: #666;'>
                <strong>üöÄ DEMO –¥–æ—Å—Ç—É–ø:</strong><br>
                –ü–∞—Ä–æ–ª—å: <code style='background: #667eea; color: white; padding: 4px 8px; border-radius: 4px; font-weight: 600;'>admin123</code>
            </div>
        </div>
    </body>
    </html>
    <?php
}

// –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞)
function renderCategoriesSection($data) {
    echo '<div class="empty-state"><h3>–†–∞–∑–¥–µ–ª –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderOrdersSection($data) {
    echo '<div class="empty-state"><h3>–†–∞–∑–¥–µ–ª –∑–∞–∫–∞–∑–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderReviewsSection($data) {
    echo '<div class="empty-state"><h3>–†–∞–∑–¥–µ–ª –æ—Ç–∑—ã–≤–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderNewsSection($data) {
    echo '<div class="empty-state"><h3>–†–∞–∑–¥–µ–ª –Ω–æ–≤–æ—Å—Ç–µ–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderAnalyticsSection($data) {
    echo '<div class="empty-state"><h3>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderFinanceSection($data) {
    echo '<div class="empty-state"><h3>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderPaymentsSection($data) {
    echo '<div class="empty-state"><h3>–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderPagesSection($data) {
    echo '<div class="empty-state"><h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderSliderSection($data) {
    echo '<div class="empty-state"><h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–æ–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderSettingsSection($data) {
    echo '<div class="empty-state"><h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderIntegrationsSection($data) {
    echo '<div class="empty-state"><h3>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderBackupSection($data) {
    echo '<div class="empty-state"><h3>–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderLogsSection($data) {
    echo '<div class="empty-state"><h3>–õ–æ–≥–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderHeatmapSection($data) {
    echo '<div class="empty-state"><h3>Heatmap –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>';
}

function renderDefaultSection($section, $data) {
    echo "<div class='empty-state'><h3>–†–∞–∑–¥–µ–ª '$section' –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3></div>";
}

function getAnalyticsData() {
    return ['sales_chart' => ['labels' => ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä'], 'data' => [65000, 78000, 82000]]];
}

function getFinanceReports() {
    return ['monthly_revenue' => 95000];
}

function getPayments() {
    return getOrders();
}

function getPages() {
    return [
        ['id' => 1, 'title' => '–û –Ω–∞—Å', 'slug' => 'about', 'active' => true],
        ['id' => 2, 'title' => '–ö–æ–Ω—Ç–∞–∫—Ç—ã', 'slug' => 'contact', 'active' => true]
    ];
}

function getSlides() {
    return [
        ['id' => 1, 'title' => '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–∫–≤–∞–°–±–æ—Ä', 'active' => true],
        ['id' => 2, 'title' => '–õ—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –∞–∫–≤–∞—Ä–∏—É–º–∞', 'active' => true]
    ];
}

function getAllSettings() {
    return [
        'site' => [
            'title' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞',
            'settings' => [
                'site_name' => ['type' => 'text', 'value' => '–ê–∫–≤–∞–°–±–æ—Ä', 'label' => '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞'],
                'site_description' => ['type' => 'textarea', 'value' => '–ê–∫–≤–∞—Ä–∏—É–º—ã –∏ –∏—Ö –æ–±–∏—Ç–∞—Ç–µ–ª–∏', 'label' => '–û–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞']
            ]
        ]
    ];
}

function getIntegrations() {
    return [
        ['name' => '–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞', 'status' => 'active'],
        ['name' => 'Google Analytics', 'status' => 'inactive']
    ];
}

function getBackups() {
    return [
        ['id' => 1, 'date' => date('Y-m-d H:i:s'), 'size' => '2.5 MB', 'type' => 'auto'],
        ['id' => 2, 'date' => date('Y-m-d H:i:s', strtotime('-1 day')), 'size' => '2.3 MB', 'type' => 'manual']
    ];
}

function getLogs() {
    return [
        ['time' => date('Y-m-d H:i:s'), 'action' => '–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É', 'user' => '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'],
        ['time' => date('Y-m-d H:i:s', strtotime('-1 hour')), 'action' => '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'user' => '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä']
    ];
}

function getHeatmapData() {
    return ['clicks' => 1250, 'views' => 5600];
}

?>
