<?php
// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û ===
function renderProductsSection($data) {
    $products = $data['products'];
    $categories = $data['categories'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–¢–æ–≤–∞—Ä—ã (<?= count($products) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>
        <div style='display: flex; gap: 12px;'>
            <button class='btn btn-success' onclick='openModal("addProductModal")'>
                <i class='fas fa-plus'></i>
                –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
            </button>
            <button class='btn btn-outline' onclick='exportProducts()'>
                <i class='fas fa-download'></i>
                –≠–∫—Å–ø–æ—Ä—Ç
            </button>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class='filters-bar'>
        <div class='filters-content'>
            <div class='search-box'>
                <input type='text' id='productSearch' class='search-input' placeholder='–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞—Ä—Ç–∏–∫—É–ª—É...'>
                <button class='search-btn' type='button'>
                    <i class='fas fa-search'></i>
                </button>
            </div>
            <select class='form-select' style='max-width: 200px;' onchange='filterByCategory(this.value)'>
                <option value=''>–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <?php foreach ($categories as $category): ?>
                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                <?php endforeach; ?>
            </select>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStock(this.value)'>
                <option value=''>–õ—é–±–æ–π –æ—Å—Ç–∞—Ç–æ–∫</option>
                <option value='in_stock'>–í –Ω–∞–ª–∏—á–∏–∏</option>
                <option value='low_stock'>–ú–∞–ª–æ —Ç–æ–≤–∞—Ä–∞</option>
                <option value='out_of_stock'>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
            </select>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStatus(this.value)'>
                <option value=''>–õ—é–±–æ–π —Å—Ç–∞—Ç—É—Å</option>
                <option value='active'>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value='inactive'>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value='featured'>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                <option value='new'>–ù–æ–≤–∏–Ω–∫–∏</option>
            </select>
        </div>
    </div>

    <!-- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
    <div class='bulk-actions' id='bulkActions'>
        <div style='display: flex; align-items: center; gap: 16px;'>
            <span>–í—ã–±—Ä–∞–Ω–æ: <strong id='selectedCount'>0</strong> —Ç–æ–≤–∞—Ä–æ–≤</span>
            <button class='btn btn-success btn-sm' onclick='bulkAction("activate")'>
                <i class='fas fa-eye'></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class='btn btn-warning btn-sm' onclick='bulkAction("deactivate")'>
                <i class='fas fa-eye-slash'></i> –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class='btn btn-outline btn-sm' onclick='openBulkCategoryModal()'>
                <i class='fas fa-tags'></i> –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </button>
            <button class='btn btn-danger btn-sm' onclick='bulkAction("delete")'>
                <i class='fas fa-trash'></i> –£–¥–∞–ª–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class='table-container'>
        <table class='table' id='productsTable'>
            <thead>
                <tr>
                    <th style='width: 40px;'>
                        <input type='checkbox' class='bulk-checkbox' onchange='toggleAllCheckboxes(this)'>
                    </th>
                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($products as $product): ?>
                <tr class='product-row' data-category='<?= $product['category_id'] ?>' 
                    data-stock='<?= $product['stock'] ?>' data-status='<?= $product['is_active'] ? 'active' : 'inactive' ?>'>
                    <td>
                        <input type='checkbox' class='bulk-checkbox' data-id='<?= $product['id'] ?>' onchange='updateBulkActions()'>
                    </td>
                    <td>
                        <div style='width: 60px; height: 60px; border-radius: var(--border-radius); overflow: hidden; background: var(--bg-secondary); display: flex; align-items: center; justify-content: center;'>
                            <?php if (!empty($product['images'])): ?>
                                <img src='<?= htmlspecialchars($product['images'][0]) ?>' alt='<?= htmlspecialchars($product['name']) ?>' 
                                     style='width: 100%; height: 100%; object-fit: cover;'>
                            <?php else: ?>
                                <i class='fas fa-image' style='color: var(--text-muted); font-size: 20px;'></i>
                            <?php endif; ?>
                        </div>
                    </td>
                    <td>
                        <div>
                            <div style='font-weight: 600; margin-bottom: 4px; cursor: pointer;' onclick='editProduct(<?= $product['id'] ?>)'>
                                <?= htmlspecialchars(mb_substr($product['name'], 0, 50)) ?>
                                <?php if (mb_strlen($product['name']) > 50): ?>...<?php endif; ?>
                            </div>
                            <div style='font-size: 12px; color: var(--text-muted);'>
                                –ê—Ä—Ç–∏–∫—É–ª: <?= $product['sku'] ?> | ID: <?= $product['id'] ?>
                            </div>
                            <div style='display: flex; gap: 4px; margin-top: 4px;'>
                                <?php if ($product['is_featured']): ?>
                                    <span style='background: gold; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;'>üî• –•–ò–¢</span>
                                <?php endif; ?>
                                <?php if ($product['is_new']): ?>
                                    <span style='background: var(--info-color); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;'>‚ú® –ù–û–í–ò–ù–ö–ê</span>
                                <?php endif; ?>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span style='padding: 4px 8px; background: var(--info-color); color: white; border-radius: 4px; font-size: 11px;'>
                            <?= htmlspecialchars($product['category']) ?>
                        </span>
                    </td>
                    <td>
                        <div style='font-weight: 600; color: var(--success-color);'><?= number_format($product['price'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <?php if ($product['old_price']): ?>
                            <div style='font-size: 11px; color: var(--text-muted); text-decoration: line-through;'>
                                <?= number_format($product['old_price'], 0, '', ' ') ?> ‚ÇΩ
                            </div>
                        <?php endif; ?>
                    </td>
                    <td>
                        <span class='status-badge <?= $product['stock'] <= 0 ? 'status-cancelled' : ($product['stock'] <= 5 ? 'status-processing' : 'status-completed') ?>'>
                            <?= $product['stock'] ?> —à—Ç
                        </span>
                    </td>
                    <td>
                        <label style='display: flex; align-items: center; cursor: pointer;'>
                            <input type='checkbox' <?= $product['is_active'] ? 'checked' : '' ?> 
                                   onchange='toggleProductStatus(<?= $product['id'] ?>, this.checked)' 
                                   style='margin-right: 8px;'>
                            <span class='status-badge <?= $product['is_active'] ? 'status-completed' : 'status-cancelled' ?>'>
                                <?= $product['is_active'] ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–°–∫—Ä—ã—Ç' ?>
                            </span>
                        </label>
                    </td>
                    <td>
                        <div style='display: flex; gap: 4px;'>
                            <button class='btn btn-primary btn-sm' onclick='editProduct(<?= $product['id'] ?>)' title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'>
                                <i class='fas fa-edit'></i>
                            </button>
                            <button class='btn btn-outline btn-sm' onclick='duplicateProduct(<?= $product['id'] ?>)' title='–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å'>
                                <i class='fas fa-copy'></i>
                            </button>
                            <button class='btn btn-outline btn-sm' onclick='viewProduct(<?= $product['id'] ?>)' title='–ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ —Å–∞–π—Ç–µ'>
                                <i class='fas fa-eye'></i>
                            </button>
                            <button class='btn btn-danger btn-sm' onclick='deleteProduct(<?= $product['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                                <i class='fas fa-trash'></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='addProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data'>
                <input type='hidden' name='action' value='add_product'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addProductModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                            <input type='text' name='name' class='form-input' required 
                                   placeholder='–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ê—Ä—Ç–∏–∫—É–ª</label>
                            <input type='text' name='sku' class='form-input' 
                                   placeholder='–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'>
                        </div>
                    </div>

                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select name='category_id' class='form-select' required>
                                <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <?php foreach ($categories as $category): ?>
                                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                            <input type='number' name='stock' class='form-input' min='0' required value='1'>
                        </div>
                    </div>

                    <!-- –¶–µ–Ω—ã -->
                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                            <input type='number' name='price' class='form-input' min='0' step='0.01' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</label>
                            <input type='number' name='old_price' class='form-input' min='0' step='0.01' 
                                   placeholder='–î–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫–∏–¥–∫–∏'>
                        </div>
                    </div>

                    <!-- –û–ø–∏—Å–∞–Ω–∏—è -->
                    <div class='form-group'>
                        <label class='form-label'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='short_description' class='form-textarea' rows='2' 
                                  placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞'></textarea>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' class='form-textarea' rows='4' 
                                  placeholder='–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'></textarea>
                    </div>

                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class='form-group'>
                        <label class='form-label'>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
                        <div class='file-upload-area' id='productImageUpload'>
                            <i class='fas fa-cloud-upload-alt' style='font-size: 48px; color: var(--text-muted); margin-bottom: 16px;'></i>
                            <p style='margin: 0 0 16px; color: var(--text-muted);'>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                            <button type='button' class='btn btn-outline'>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
                            <input type='file' name='images[]' accept='image/*' multiple style='display: none;' id='productImageInput'>
                        </div>
                        <div class='uploaded-images' id='productImagePreview'></div>
                        <small style='color: var(--text-muted);'>–ú–∞–∫—Å–∏–º—É–º 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ 10MB –∫–∞–∂–¥–æ–µ. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, WEBP, GIF</small>
                    </div>

                    <!-- –†–∞–∑–º–µ—Ä—ã –∏ –≤–µ—Å -->
                    <div class='form-row-3'>
                        <div class='form-group'>
                            <label class='form-label'>–î–ª–∏–Ω–∞ (—Å–º)</label>
                            <input type='number' name='length' class='form-input' min='0' value='10'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–®–∏—Ä–∏–Ω–∞ (—Å–º)</label>
                            <input type='number' name='width' class='form-input' min='0' value='10'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–í—ã—Å–æ—Ç–∞ (—Å–º)</label>
                            <input type='number' name='height' class='form-input' min='0' value='10'>
                        </div>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–í–µ—Å (–≥)</label>
                        <input type='number' name='weight' class='form-input' min='0' value='100'>
                    </div>

                    <!-- SEO -->
                    <details style='margin: 20px 0;'>
                        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
                        <div class='form-group'>
                            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type='text' name='meta_title' class='form-input' 
                                   placeholder='–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name='meta_description' class='form-textarea' rows='2' 
                                      placeholder='–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'></textarea>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
                            <input type='text' name='meta_keywords' class='form-input' 
                                   placeholder='–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ, –µ—â–µ —Å–ª–æ–≤–æ'>
                        </div>
                    </details>

                    <!-- –°—Ç–∞—Ç—É—Å—ã -->
                    <div style='display: flex; gap: 20px; align-items: center; margin-top: 20px;'>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_featured'> 
                            <span>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç–æ–≤–∞—Ä</span>
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_new'> 
                            <span>‚ú® –ù–æ–≤–∏–Ω–∫–∞</span>
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_active' checked> 
                            <span>üëÅÔ∏è –ê–∫—Ç–∏–≤–µ–Ω</span>
                        </label>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='editProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data' id='editProductForm'>
                <input type='hidden' name='action' value='edit_product'>
                <input type='hidden' name='product_id' id='editProductId'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("editProductModal")'>&times;</button>
                </div>
                <div class='modal-body' id='editProductContent'>
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("editProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='bulkCategoryModal'>
        <div class='modal-dialog'>
            <div class='modal-header'>
                <h3 class='modal-title'>–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <button type='button' class='modal-close' onclick='closeModal("bulkCategoryModal")'>&times;</button>
            </div>
            <div class='modal-body'>
                <div class='form-group'>
                    <label class='form-label'>–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                    <select class='form-select' id='bulkCategorySelect' required>
                        <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <?php foreach ($categories as $category): ?>
                            <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-outline' onclick='closeModal("bulkCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                <button type='button' class='btn btn-primary' onclick='applyBulkCategory()'>
                    <i class='fas fa-check'></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            initSearch('productSearch', (query) => {
                filterTable('productsTable', query, [2, 3]); // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
            initFileUpload('productImageUpload', 'productImageInput');
        });

        // === –§–£–ù–ö–¶–ò–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò ===
        function filterByCategory(categoryId) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                if (!categoryId || row.dataset.category === categoryId) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterByStock(type) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                const stock = parseInt(row.dataset.stock);
                let show = true;

                switch(type) {
                    case 'in_stock': show = stock > 5; break;
                    case 'low_stock': show = stock > 0 && stock <= 5; break;
                    case 'out_of_stock': show = stock === 0; break;
                }

                row.style.display = show ? '' : 'none';
            });
        }

        function filterByStatus(status) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                let show = true;

                switch(status) {
                    case 'active': show = row.dataset.status === 'active'; break;
                    case 'inactive': show = row.dataset.status === 'inactive'; break;
                    case 'featured': show = row.querySelector('.fa-fire') !== null; break;
                    case 'new': show = row.querySelector('.fa-star') !== null; break;
                }

                row.style.display = show ? '' : 'none';
            });
        }

        // === –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –¢–û–í–ê–†–ê–ú–ò ===
        async function editProduct(id) {
            showLoading();

            try {
                const response = await fetch(`admin.php?action=get_product&id=${id}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('editProductId').value = id;
                    document.getElementById('editProductContent').innerHTML = data.html;
                    openModal('editProductModal');

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    if (document.getElementById('editProductImageUpload')) {
                        initFileUpload('editProductImageUpload', 'editProductImageInput');
                    }
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–∞', 'error');
            } finally {
                hideLoading();
            }
        }

        async function duplicateProduct(id) {
            if (!confirm('–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é —Ç–æ–≤–∞—Ä–∞?')) return;

            showLoading();

            const formData = new FormData();
            formData.append('action', 'duplicate_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–¢–æ–≤–∞—Ä —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        async function deleteProduct(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            showLoading();

            const formData = new FormData();
            formData.append('action', 'delete_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        function viewProduct(id) {
            window.open(`index.php?page=product&id=${id}`, '_blank');
        }

        async function toggleProductStatus(id, isActive) {
            const formData = new FormData();
            formData.append('action', 'toggle_product_status');
            formData.append('product_id', id);
            formData.append('is_active', isActive ? '1' : '0');
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω', 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        // === –ú–ê–°–°–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò ===
        function openBulkCategoryModal() {
            const selectedIds = getSelectedIds();
            if (selectedIds.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
                return;
            }
            openModal('bulkCategoryModal');
        }

        function applyBulkCategory() {
            const categoryId = document.getElementById('bulkCategorySelect').value;
            if (!categoryId) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }

            bulkAction('update_category', { category_id: categoryId });
            closeModal('bulkCategoryModal');
        }

        // === –≠–ö–°–ü–û–†–¢ ===
        function exportProducts() {
            const link = document.createElement('a');
            link.href = 'admin.php?action=export_products';
            link.download = 'products_export.csv';
            link.click();
            showNotification('–≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞—á–∞—Ç', 'info');
        }

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é bulkAction –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
        window.originalBulkAction = window.bulkAction;
        window.bulkAction = async function(action, additionalData = {}) {
            const selectedIds = getSelectedIds();

            if (selectedIds.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
                return;
            }

            let confirmMessage = `–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ "${action}" –¥–ª—è ${selectedIds.length} —Ç–æ–≤–∞—Ä–æ–≤?`;
            if (action === 'delete') {
                confirmMessage = `–í–ù–ò–ú–ê–ù–ò–ï! –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å ${selectedIds.length} —Ç–æ–≤–∞—Ä–æ–≤. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`;
            }

            if (!confirm(confirmMessage)) {
                return;
            }

            showLoading();

            const formData = new FormData();
            formData.append('action', 'bulk_products');
            formData.append('bulk_action', action);
            formData.append('ids', JSON.stringify(selectedIds));
            formData.append('ajax', '1');

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            Object.entries(additionalData).forEach(([key, value]) => {
                formData.append(key, value);
            });

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                console.error('Bulk Action Error:', error);
                showNotification('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
            } finally {
                hideLoading();
            }
        };
    </script>
    <?php
}

// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò - –ò–°–ü–†–ê–í–õ–ï–ù–û ===
function renderCategoriesSection($data) {
    $categories = $data['categories'];
    $products = $data['products'];

    // –ü–æ–¥—Å—á–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    $categoryStats = [];
    foreach ($categories as $category) {
        $categoryStats[$category['id']] = count(array_filter($products, fn($p) => $p['category_id'] == $category['id']));
    }
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (<?= count($categories) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>
        <button class='btn btn-success' onclick='openModal("addCategoryModal")'>
            <i class='fas fa-plus'></i>
            –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </button>
    </div>

    <!-- –°–µ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;'>
        <?php foreach ($categories as $category): ?>
            <div class='stat-card' style='position: relative; cursor: pointer;' onclick='editCategory(<?= $category['id'] ?>)'>
                <div style='display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;'>
                    <div style='display: flex; align-items: center; gap: 12px;'>
                        <div style='font-size: 48px;'><?= $category['icon'] ?></div>
                        <div>
                            <h3 style='margin: 0; font-size: 20px;'><?= htmlspecialchars($category['name']) ?></h3>
                            <p style='margin: 4px 0 0; color: var(--text-muted); font-size: 12px;'>
                                ID: <?= $category['id'] ?> | Slug: <?= $category['slug'] ?>
                            </p>
                        </div>
                    </div>
                    <div style='display: flex; flex-direction: column; align-items: end; gap: 8px;'>
                        <span class='status-badge <?= $category['active'] ? 'status-completed' : 'status-cancelled' ?>'>
                            <?= $category['active'] ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–°–∫—Ä—ã—Ç–∞' ?>
                        </span>
                        <div style='font-size: 12px; color: var(--text-muted);'>
                            –ü–æ—Ä—è–¥–æ–∫: <?= $category['sort_order'] ?>
                        </div>
                    </div>
                </div>

                <p style='color: var(--text-secondary); margin-bottom: 16px; font-size: 14px; line-height: 1.4;'>
                    <?= htmlspecialchars($category['description']) ?>
                </p>

                <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: var(--border-radius);'>
                    <div style='text-align: center;'>
                        <div style='font-size: 24px; font-weight: 700; color: var(--primary-color);'>
                            <?= $categoryStats[$category['id']] ?? 0 ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>—Ç–æ–≤–∞—Ä–æ–≤</div>
                    </div>
                    <div style='text-align: center;'>
                        <div style='font-size: 16px; font-weight: 600; color: var(--success-color);'>
                            <?= array_sum(array_column(array_filter($products, fn($p) => $p['category_id'] == $category['id']), 'views')) ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                    </div>
                    <div style='text-align: center;'>
                        <div style='font-size: 16px; font-weight: 600; color: var(--warning-color);'>
                            <?= array_sum(array_column(array_filter($products, fn($p) => $p['category_id'] == $category['id']), 'sales')) ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>–ø—Ä–æ–¥–∞–∂</div>
                    </div>
                </div>

                <div style='display: flex; gap: 8px;' onclick='event.stopPropagation()'>
                    <button class='btn btn-primary btn-sm' style='flex: 1;' onclick='editCategory(<?= $category['id'] ?>)'>
                        <i class='fas fa-edit'></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class='btn btn-outline btn-sm' onclick='viewCategoryProducts(<?= $category['id'] ?>)' title='–¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'>
                        <i class='fas fa-eye'></i>
                    </button>
                    <button class='btn btn-warning btn-sm' onclick='toggleCategory(<?= $category['id'] ?>)' title='–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å'>
                        <i class='fas fa-power-off'></i>
                    </button>
                    <?php if (($categoryStats[$category['id']] ?? 0) == 0): ?>
                        <button class='btn btn-danger btn-sm' onclick='deleteCategory(<?= $category['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                            <i class='fas fa-trash'></i>
                        </button>
                    <?php endif; ?>
                </div>
            </div>
        <?php endforeach; ?>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='addCategoryModal'>
        <div class='modal-dialog'>
            <form class='ajax-form' method='POST'>
                <input type='hidden' name='action' value='add_category'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addCategoryModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <div class='form-group'>
                        <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                        <input type='text' name='name' class='form-input' required 
                               placeholder='–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'>
                    </div>

                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ò–∫–æ–Ω–∫–∞ (emoji)</label>
                            <input type='text' name='icon' class='form-input' placeholder='üê†' maxlength='4'
                                   style='text-align: center; font-size: 24px;'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                            <input type='number' name='sort_order' class='form-input' min='1' value='<?= count($categories) + 1 ?>'>
                        </div>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' class='form-textarea' rows='3' 
                                  placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'></textarea>
                    </div>

                    <!-- SEO -->
                    <details style='margin: 20px 0;'>
                        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
                        <div class='form-group'>
                            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type='text' name='seo_title' class='form-input' 
                                   placeholder='–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name='seo_description' class='form-textarea' rows='2' 
                                      placeholder='–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'></textarea>
                        </div>
                    </details>

                    <div class='form-group'>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='active' checked> 
                            <span>–ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                        </label>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='editCategoryModal'>
        <div class='modal-dialog'>
            <form class='ajax-form' method='POST' id='editCategoryForm'>
                <input type='hidden' name='action' value='edit_category'>
                <input type='hidden' name='category_id' id='editCategoryId'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                    <button type='button' class='modal-close' onclick='closeModal("editCategoryModal")'>&times;</button>
                </div>
                <div class='modal-body' id='editCategoryContent'>
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("editCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        async function editCategory(id) {
            showLoading();

            try {
                const response = await fetch(`admin.php?action=get_category&id=${id}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('editCategoryId').value = id;
                    document.getElementById('editCategoryContent').innerHTML = data.html;
                    openModal('editCategoryModal');
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        function viewCategoryProducts(id) {
            location.href = `admin.php?section=products&category=${id}`;
        }

        async function toggleCategory(id) {
            const formData = new FormData();
            formData.append('action', 'toggle_category_status');
            formData.append('category_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–°—Ç–∞—Ç—É—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        async function deleteCategory(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            const formData = new FormData();
            formData.append('action', 'delete_category');
            formData.append('category_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }
    </script>
    <?php
}
<?php
// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û ===
function renderProductsSection($data) {
    $products = $data['products'];
    $categories = $data['categories'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–¢–æ–≤–∞—Ä—ã (<?= count($products) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>
        <div style='display: flex; gap: 12px;'>
            <button class='btn btn-success' onclick='openModal("addProductModal")'>
                <i class='fas fa-plus'></i>
                –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
            </button>
            <button class='btn btn-outline' onclick='exportProducts()'>
                <i class='fas fa-download'></i>
                –≠–∫—Å–ø–æ—Ä—Ç
            </button>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class='filters-bar'>
        <div class='filters-content'>
            <div class='search-box'>
                <input type='text' id='productSearch' class='search-input' placeholder='–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞—Ä—Ç–∏–∫—É–ª—É...'>
                <button class='search-btn' type='button'>
                    <i class='fas fa-search'></i>
                </button>
            </div>
            <select class='form-select' style='max-width: 200px;' onchange='filterByCategory(this.value)'>
                <option value=''>–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <?php foreach ($categories as $category): ?>
                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                <?php endforeach; ?>
            </select>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStock(this.value)'>
                <option value=''>–õ—é–±–æ–π –æ—Å—Ç–∞—Ç–æ–∫</option>
                <option value='in_stock'>–í –Ω–∞–ª–∏—á–∏–∏</option>
                <option value='low_stock'>–ú–∞–ª–æ —Ç–æ–≤–∞—Ä–∞</option>
                <option value='out_of_stock'>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
            </select>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStatus(this.value)'>
                <option value=''>–õ—é–±–æ–π —Å—Ç–∞—Ç—É—Å</option>
                <option value='active'>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value='inactive'>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value='featured'>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                <option value='new'>–ù–æ–≤–∏–Ω–∫–∏</option>
            </select>
        </div>
    </div>

    <!-- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
    <div class='bulk-actions' id='bulkActions'>
        <div style='display: flex; align-items: center; gap: 16px;'>
            <span>–í—ã–±—Ä–∞–Ω–æ: <strong id='selectedCount'>0</strong> —Ç–æ–≤–∞—Ä–æ–≤</span>
            <button class='btn btn-success btn-sm' onclick='bulkAction("activate")'>
                <i class='fas fa-eye'></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class='btn btn-warning btn-sm' onclick='bulkAction("deactivate")'>
                <i class='fas fa-eye-slash'></i> –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class='btn btn-outline btn-sm' onclick='openBulkCategoryModal()'>
                <i class='fas fa-tags'></i> –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </button>
            <button class='btn btn-danger btn-sm' onclick='bulkAction("delete")'>
                <i class='fas fa-trash'></i> –£–¥–∞–ª–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class='table-container'>
        <table class='table' id='productsTable'>
            <thead>
                <tr>
                    <th style='width: 40px;'>
                        <input type='checkbox' class='bulk-checkbox' onchange='toggleAllCheckboxes(this)'>
                    </th>
                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($products as $product): ?>
                <tr class='product-row' data-category='<?= $product['category_id'] ?>' 
                    data-stock='<?= $product['stock'] ?>' data-status='<?= $product['is_active'] ? 'active' : 'inactive' ?>'>
                    <td>
                        <input type='checkbox' class='bulk-checkbox' data-id='<?= $product['id'] ?>' onchange='updateBulkActions()'>
                    </td>
                    <td>
                        <div style='width: 60px; height: 60px; border-radius: var(--border-radius); overflow: hidden; background: var(--bg-secondary); display: flex; align-items: center; justify-content: center;'>
                            <?php if (!empty($product['images'])): ?>
                                <img src='<?= htmlspecialchars($product['images'][0]) ?>' alt='<?= htmlspecialchars($product['name']) ?>' 
                                     style='width: 100%; height: 100%; object-fit: cover;'>
                            <?php else: ?>
                                <i class='fas fa-image' style='color: var(--text-muted); font-size: 20px;'></i>
                            <?php endif; ?>
                        </div>
                    </td>
                    <td>
                        <div>
                            <div style='font-weight: 600; margin-bottom: 4px; cursor: pointer;' onclick='editProduct(<?= $product['id'] ?>)'>
                                <?= htmlspecialchars(mb_substr($product['name'], 0, 50)) ?>
                                <?php if (mb_strlen($product['name']) > 50): ?>...<?php endif; ?>
                            </div>
                            <div style='font-size: 12px; color: var(--text-muted);'>
                                –ê—Ä—Ç–∏–∫—É–ª: <?= $product['sku'] ?> | ID: <?= $product['id'] ?>
                            </div>
                            <div style='display: flex; gap: 4px; margin-top: 4px;'>
                                <?php if ($product['is_featured']): ?>
                                    <span style='background: gold; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;'>üî• –•–ò–¢</span>
                                <?php endif; ?>
                                <?php if ($product['is_new']): ?>
                                    <span style='background: var(--info-color); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;'>‚ú® –ù–û–í–ò–ù–ö–ê</span>
                                <?php endif; ?>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span style='padding: 4px 8px; background: var(--info-color); color: white; border-radius: 4px; font-size: 11px;'>
                            <?= htmlspecialchars($product['category']) ?>
                        </span>
                    </td>
                    <td>
                        <div style='font-weight: 600; color: var(--success-color);'><?= number_format($product['price'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <?php if ($product['old_price']): ?>
                            <div style='font-size: 11px; color: var(--text-muted); text-decoration: line-through;'>
                                <?= number_format($product['old_price'], 0, '', ' ') ?> ‚ÇΩ
                            </div>
                        <?php endif; ?>
                    </td>
                    <td>
                        <span class='status-badge <?= $product['stock'] <= 0 ? 'status-cancelled' : ($product['stock'] <= 5 ? 'status-processing' : 'status-completed') ?>'>
                            <?= $product['stock'] ?> —à—Ç
                        </span>
                    </td>
                    <td>
                        <label style='display: flex; align-items: center; cursor: pointer;'>
                            <input type='checkbox' <?= $product['is_active'] ? 'checked' : '' ?> 
                                   onchange='toggleProductStatus(<?= $product['id'] ?>, this.checked)' 
                                   style='margin-right: 8px;'>
                            <span class='status-badge <?= $product['is_active'] ? 'status-completed' : 'status-cancelled' ?>'>
                                <?= $product['is_active'] ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–°–∫—Ä—ã—Ç' ?>
                            </span>
                        </label>
                    </td>
                    <td>
                        <div style='display: flex; gap: 4px;'>
                            <button class='btn btn-primary btn-sm' onclick='editProduct(<?= $product['id'] ?>)' title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'>
                                <i class='fas fa-edit'></i>
                            </button>
                            <button class='btn btn-outline btn-sm' onclick='duplicateProduct(<?= $product['id'] ?>)' title='–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å'>
                                <i class='fas fa-copy'></i>
                            </button>
                            <button class='btn btn-outline btn-sm' onclick='viewProduct(<?= $product['id'] ?>)' title='–ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ —Å–∞–π—Ç–µ'>
                                <i class='fas fa-eye'></i>
                            </button>
                            <button class='btn btn-danger btn-sm' onclick='deleteProduct(<?= $product['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                                <i class='fas fa-trash'></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='addProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data'>
                <input type='hidden' name='action' value='add_product'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addProductModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                            <input type='text' name='name' class='form-input' required 
                                   placeholder='–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ê—Ä—Ç–∏–∫—É–ª</label>
                            <input type='text' name='sku' class='form-input' 
                                   placeholder='–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'>
                        </div>
                    </div>

                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select name='category_id' class='form-select' required>
                                <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <?php foreach ($categories as $category): ?>
                                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                            <input type='number' name='stock' class='form-input' min='0' required value='1'>
                        </div>
                    </div>

                    <!-- –¶–µ–Ω—ã -->
                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                            <input type='number' name='price' class='form-input' min='0' step='0.01' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</label>
                            <input type='number' name='old_price' class='form-input' min='0' step='0.01' 
                                   placeholder='–î–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫–∏–¥–∫–∏'>
                        </div>
                    </div>

                    <!-- –û–ø–∏—Å–∞–Ω–∏—è -->
                    <div class='form-group'>
                        <label class='form-label'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='short_description' class='form-textarea' rows='2' 
                                  placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞'></textarea>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' class='form-textarea' rows='4' 
                                  placeholder='–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'></textarea>
                    </div>

                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class='form-group'>
                        <label class='form-label'>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
                        <div class='file-upload-area' id='productImageUpload'>
                            <i class='fas fa-cloud-upload-alt' style='font-size: 48px; color: var(--text-muted); margin-bottom: 16px;'></i>
                            <p style='margin: 0 0 16px; color: var(--text-muted);'>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                            <button type='button' class='btn btn-outline'>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
                            <input type='file' name='images[]' accept='image/*' multiple style='display: none;' id='productImageInput'>
                        </div>
                        <div class='uploaded-images' id='productImagePreview'></div>
                        <small style='color: var(--text-muted);'>–ú–∞–∫—Å–∏–º—É–º 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ 10MB –∫–∞–∂–¥–æ–µ. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, WEBP, GIF</small>
                    </div>

                    <!-- –†–∞–∑–º–µ—Ä—ã –∏ –≤–µ—Å -->
                    <div class='form-row-3'>
                        <div class='form-group'>
                            <label class='form-label'>–î–ª–∏–Ω–∞ (—Å–º)</label>
                            <input type='number' name='length' class='form-input' min='0' value='10'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–®–∏—Ä–∏–Ω–∞ (—Å–º)</label>
                            <input type='number' name='width' class='form-input' min='0' value='10'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–í—ã—Å–æ—Ç–∞ (—Å–º)</label>
                            <input type='number' name='height' class='form-input' min='0' value='10'>
                        </div>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–í–µ—Å (–≥)</label>
                        <input type='number' name='weight' class='form-input' min='0' value='100'>
                    </div>

                    <!-- SEO -->
                    <details style='margin: 20px 0;'>
                        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
                        <div class='form-group'>
                            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type='text' name='meta_title' class='form-input' 
                                   placeholder='–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name='meta_description' class='form-textarea' rows='2' 
                                      placeholder='–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'></textarea>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
                            <input type='text' name='meta_keywords' class='form-input' 
                                   placeholder='–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ, –µ—â–µ —Å–ª–æ–≤–æ'>
                        </div>
                    </details>

                    <!-- –°—Ç–∞—Ç—É—Å—ã -->
                    <div style='display: flex; gap: 20px; align-items: center; margin-top: 20px;'>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_featured'> 
                            <span>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç–æ–≤–∞—Ä</span>
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_new'> 
                            <span>‚ú® –ù–æ–≤–∏–Ω–∫–∞</span>
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_active' checked> 
                            <span>üëÅÔ∏è –ê–∫—Ç–∏–≤–µ–Ω</span>
                        </label>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='editProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data' id='editProductForm'>
                <input type='hidden' name='action' value='edit_product'>
                <input type='hidden' name='product_id' id='editProductId'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("editProductModal")'>&times;</button>
                </div>
                <div class='modal-body' id='editProductContent'>
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("editProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='bulkCategoryModal'>
        <div class='modal-dialog'>
            <div class='modal-header'>
                <h3 class='modal-title'>–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <button type='button' class='modal-close' onclick='closeModal("bulkCategoryModal")'>&times;</button>
            </div>
            <div class='modal-body'>
                <div class='form-group'>
                    <label class='form-label'>–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                    <select class='form-select' id='bulkCategorySelect' required>
                        <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <?php foreach ($categories as $category): ?>
                            <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-outline' onclick='closeModal("bulkCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                <button type='button' class='btn btn-primary' onclick='applyBulkCategory()'>
                    <i class='fas fa-check'></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            initSearch('productSearch', (query) => {
                filterTable('productsTable', query, [2, 3]); // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
            initFileUpload('productImageUpload', 'productImageInput');
        });

        // === –§–£–ù–ö–¶–ò–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò ===
        function filterByCategory(categoryId) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                if (!categoryId || row.dataset.category === categoryId) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterByStock(type) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                const stock = parseInt(row.dataset.stock);
                let show = true;

                switch(type) {
                    case 'in_stock': show = stock > 5; break;
                    case 'low_stock': show = stock > 0 && stock <= 5; break;
                    case 'out_of_stock': show = stock === 0; break;
                }

                row.style.display = show ? '' : 'none';
            });
        }

        function filterByStatus(status) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                let show = true;

                switch(status) {
                    case 'active': show = row.dataset.status === 'active'; break;
                    case 'inactive': show = row.dataset.status === 'inactive'; break;
                    case 'featured': show = row.querySelector('.fa-fire') !== null; break;
                    case 'new': show = row.querySelector('.fa-star') !== null; break;
                }

                row.style.display = show ? '' : 'none';
            });
        }

        // === –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –¢–û–í–ê–†–ê–ú–ò ===
        async function editProduct(id) {
            showLoading();

            try {
                const response = await fetch(`admin.php?action=get_product&id=${id}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('editProductId').value = id;
                    document.getElementById('editProductContent').innerHTML = data.html;
                    openModal('editProductModal');

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    if (document.getElementById('editProductImageUpload')) {
                        initFileUpload('editProductImageUpload', 'editProductImageInput');
                    }
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–∞', 'error');
            } finally {
                hideLoading();
            }
        }

        async function duplicateProduct(id) {
            if (!confirm('–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é —Ç–æ–≤–∞—Ä–∞?')) return;

            showLoading();

            const formData = new FormData();
            formData.append('action', 'duplicate_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–¢–æ–≤–∞—Ä —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        async function deleteProduct(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            showLoading();

            const formData = new FormData();
            formData.append('action', 'delete_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        function viewProduct(id) {
            window.open(`index.php?page=product&id=${id}`, '_blank');
        }

        async function toggleProductStatus(id, isActive) {
            const formData = new FormData();
            formData.append('action', 'toggle_product_status');
            formData.append('product_id', id);
            formData.append('is_active', isActive ? '1' : '0');
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω', 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        // === –ú–ê–°–°–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò ===
        function openBulkCategoryModal() {
            const selectedIds = getSelectedIds();
            if (selectedIds.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
                return;
            }
            openModal('bulkCategoryModal');
        }

        function applyBulkCategory() {
            const categoryId = document.getElementById('bulkCategorySelect').value;
            if (!categoryId) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }

            bulkAction('update_category', { category_id: categoryId });
            closeModal('bulkCategoryModal');
        }

        // === –≠–ö–°–ü–û–†–¢ ===
        function exportProducts() {
            const link = document.createElement('a');
            link.href = 'admin.php?action=export_products';
            link.download = 'products_export.csv';
            link.click();
            showNotification('–≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞—á–∞—Ç', 'info');
        }

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é bulkAction –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
        window.originalBulkAction = window.bulkAction;
        window.bulkAction = async function(action, additionalData = {}) {
            const selectedIds = getSelectedIds();

            if (selectedIds.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
                return;
            }

            let confirmMessage = `–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ "${action}" –¥–ª—è ${selectedIds.length} —Ç–æ–≤–∞—Ä–æ–≤?`;
            if (action === 'delete') {
                confirmMessage = `–í–ù–ò–ú–ê–ù–ò–ï! –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å ${selectedIds.length} —Ç–æ–≤–∞—Ä–æ–≤. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`;
            }

            if (!confirm(confirmMessage)) {
                return;
            }

            showLoading();

            const formData = new FormData();
            formData.append('action', 'bulk_products');
            formData.append('bulk_action', action);
            formData.append('ids', JSON.stringify(selectedIds));
            formData.append('ajax', '1');

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            Object.entries(additionalData).forEach(([key, value]) => {
                formData.append(key, value);
            });

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                console.error('Bulk Action Error:', error);
                showNotification('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
            } finally {
                hideLoading();
            }
        };
    </script>
    <?php
}

// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò - –ò–°–ü–†–ê–í–õ–ï–ù–û ===
function renderCategoriesSection($data) {
    $categories = $data['categories'];
    $products = $data['products'];

    // –ü–æ–¥—Å—á–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    $categoryStats = [];
    foreach ($categories as $category) {
        $categoryStats[$category['id']] = count(array_filter($products, fn($p) => $p['category_id'] == $category['id']));
    }
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (<?= count($categories) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>
        <button class='btn btn-success' onclick='openModal("addCategoryModal")'>
            <i class='fas fa-plus'></i>
            –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </button>
    </div>

    <!-- –°–µ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;'>
        <?php foreach ($categories as $category): ?>
            <div class='stat-card' style='position: relative; cursor: pointer;' onclick='editCategory(<?= $category['id'] ?>)'>
                <div style='display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;'>
                    <div style='display: flex; align-items: center; gap: 12px;'>
                        <div style='font-size: 48px;'><?= $category['icon'] ?></div>
                        <div>
                            <h3 style='margin: 0; font-size: 20px;'><?= htmlspecialchars($category['name']) ?></h3>
                            <p style='margin: 4px 0 0; color: var(--text-muted); font-size: 12px;'>
                                ID: <?= $category['id'] ?> | Slug: <?= $category['slug'] ?>
                            </p>
                        </div>
                    </div>
                    <div style='display: flex; flex-direction: column; align-items: end; gap: 8px;'>
                        <span class='status-badge <?= $category['active'] ? 'status-completed' : 'status-cancelled' ?>'>
                            <?= $category['active'] ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–°–∫—Ä—ã—Ç–∞' ?>
                        </span>
                        <div style='font-size: 12px; color: var(--text-muted);'>
                            –ü–æ—Ä—è–¥–æ–∫: <?= $category['sort_order'] ?>
                        </div>
                    </div>
                </div>

                <p style='color: var(--text-secondary); margin-bottom: 16px; font-size: 14px; line-height: 1.4;'>
                    <?= htmlspecialchars($category['description']) ?>
                </p>

                <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: var(--border-radius);'>
                    <div style='text-align: center;'>
                        <div style='font-size: 24px; font-weight: 700; color: var(--primary-color);'>
                            <?= $categoryStats[$category['id']] ?? 0 ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>—Ç–æ–≤–∞—Ä–æ–≤</div>
                    </div>
                    <div style='text-align: center;'>
                        <div style='font-size: 16px; font-weight: 600; color: var(--success-color);'>
                            <?= array_sum(array_column(array_filter($products, fn($p) => $p['category_id'] == $category['id']), 'views')) ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                    </div>
                    <div style='text-align: center;'>
                        <div style='font-size: 16px; font-weight: 600; color: var(--warning-color);'>
                            <?= array_sum(array_column(array_filter($products, fn($p) => $p['category_id'] == $category['id']), 'sales')) ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>–ø—Ä–æ–¥–∞–∂</div>
                    </div>
                </div>

                <div style='display: flex; gap: 8px;' onclick='event.stopPropagation()'>
                    <button class='btn btn-primary btn-sm' style='flex: 1;' onclick='editCategory(<?= $category['id'] ?>)'>
                        <i class='fas fa-edit'></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class='btn btn-outline btn-sm' onclick='viewCategoryProducts(<?= $category['id'] ?>)' title='–¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'>
                        <i class='fas fa-eye'></i>
                    </button>
                    <button class='btn btn-warning btn-sm' onclick='toggleCategory(<?= $category['id'] ?>)' title='–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å'>
                        <i class='fas fa-power-off'></i>
                    </button>
                    <?php if (($categoryStats[$category['id']] ?? 0) == 0): ?>
                        <button class='btn btn-danger btn-sm' onclick='deleteCategory(<?= $category['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                            <i class='fas fa-trash'></i>
                        </button>
                    <?php endif; ?>
                </div>
            </div>
        <?php endforeach; ?>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='addCategoryModal'>
        <div class='modal-dialog'>
            <form class='ajax-form' method='POST'>
                <input type='hidden' name='action' value='add_category'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addCategoryModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <div class='form-group'>
                        <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                        <input type='text' name='name' class='form-input' required 
                               placeholder='–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'>
                    </div>

                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ò–∫–æ–Ω–∫–∞ (emoji)</label>
                            <input type='text' name='icon' class='form-input' placeholder='üê†' maxlength='4'
                                   style='text-align: center; font-size: 24px;'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                            <input type='number' name='sort_order' class='form-input' min='1' value='<?= count($categories) + 1 ?>'>
                        </div>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' class='form-textarea' rows='3' 
                                  placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'></textarea>
                    </div>

                    <!-- SEO -->
                    <details style='margin: 20px 0;'>
                        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
                        <div class='form-group'>
                            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type='text' name='seo_title' class='form-input' 
                                   placeholder='–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name='seo_description' class='form-textarea' rows='2' 
                                      placeholder='–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'></textarea>
                        </div>
                    </details>

                    <div class='form-group'>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='active' checked> 
                            <span>–ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                        </label>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='editCategoryModal'>
        <div class='modal-dialog'>
            <form class='ajax-form' method='POST' id='editCategoryForm'>
                <input type='hidden' name='action' value='edit_category'>
                <input type='hidden' name='category_id' id='editCategoryId'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                    <button type='button' class='modal-close' onclick='closeModal("editCategoryModal")'>&times;</button>
                </div>
                <div class='modal-body' id='editCategoryContent'>
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("editCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        async function editCategory(id) {
            showLoading();

            try {
                const response = await fetch(`admin.php?action=get_category&id=${id}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('editCategoryId').value = id;
                    document.getElementById('editCategoryContent').innerHTML = data.html;
                    openModal('editCategoryModal');
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        function viewCategoryProducts(id) {
            location.href = `admin.php?section=products&category=${id}`;
        }

        async function toggleCategory(id) {
            const formData = new FormData();
            formData.append('action', 'toggle_category_status');
            formData.append('category_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–°—Ç–∞—Ç—É—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        async function deleteCategory(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            const formData = new FormData();
            formData.append('action', 'delete_category');
            formData.append('category_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }
    </script>
    <?php
}
