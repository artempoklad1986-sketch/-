<?php  
// ‚Üê –ù–ï–¢ –ø—Ä–æ–±–µ–ª–æ–≤/–ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –ø–µ—Ä–µ–¥ <?php
session_start(); // ‚Üê –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –°–†–ê–ó–£ –ø–æ—Å–ª–µ <?php
require_once 'data.php';

// –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
if (!isset($_SESSION['admin_logged_in'])) {
    if (($_POST['admin_password'] ?? '') === ADMIN_PASSWORD) {
        $_SESSION['admin_logged_in'] = true;
        $_SESSION['admin_name'] = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
        $_SESSION['admin_role'] = '–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω';
        header('Location: admin.php');
        exit;
    } elseif (!empty($_POST['admin_password'])) {
        $login_error = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
    }
}

// –í—ã—Ö–æ–¥
if (($_GET['action'] ?? '') === 'logout') {
    unset($_SESSION['admin_logged_in']);
    header('Location: admin.php');
    exit;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
if (!isset($_SESSION['admin_logged_in'])) {
    renderLoginPage($login_error ?? '');
    exit;
}

$section = $_GET['section'] ?? 'dashboard';
$action = $_POST['action'] ?? $_GET['action'] ?? '';

// –û–±—Ä–∞–±–æ—Ç–∫–∞ AJAX –∑–∞–ø—Ä–æ—Å–æ–≤ - –ò–°–ü–†–ê–í–õ–ï–ù–û
if (isset($_POST['ajax']) || isset($_GET['ajax'])) {
    header('Content-Type: application/json');
    echo json_encode(handleAjaxRequest($action));
    exit;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ - –ù–û–í–û–ï
if (isset($_FILES) && !empty($_FILES)) {
    $response = handleFileUpload($action);
    if (isset($_POST['ajax'])) {
        header('Content-Type: application/json');
        echo json_encode($response);
        exit;
    } else {
        $_SESSION['admin_message'] = [
            'text' => $response['message'],
            'type' => $response['success'] ? 'success' : 'error'
        ];
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
if ($action && !isset($_POST['ajax'])) {
    handleAdminAction($action, $section);
}

// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
$adminData = getAdminData($section);

?><!DOCTYPE html>
<html lang='ru'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title><?= $adminData['title'] ?? '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å' ?> - –ê–∫–≤–∞–°–±–æ—Ä CRM</title>

    <!-- –°—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∫–∏ -->
    <link href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap' rel='stylesheet'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ - —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --text-muted: #95a5a6;
            --border-color: #dee2e6;
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 25px rgba(0,0,0,0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .admin-panel {
            display: flex;
            min-height: 100vh;
        }

        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é - —É–ª—É—á—à–µ–Ω–æ */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 32px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        .logo-title {
            font-size: 20px;
            font-weight: 700;
        }

        .logo-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-title {
            padding: 0 20px 10px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            font-weight: 600;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
        }

        .sidebar-link:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            padding-left: 25px;
        }

        .sidebar-link.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .sidebar-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: white;
        }

        .sidebar-link i {
            width: 20px;
            margin-right: 12px;
        }

        .sidebar-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .sidebar-badge.badge-warning {
            background: var(--warning-color);
        }

        .sidebar-badge.badge-premium {
            background: linear-gradient(45deg, gold, orange);
        }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .admin-name {
            font-weight: 600;
            font-size: 14px;
        }

        .admin-role {
            font-size: 11px;
            opacity: 0.7;
        }

        .logout-btn {
            margin-left: auto;
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            padding: 8px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
        }

        .top-bar {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn-lg {
            padding: 12px 24px;
            font-size: 16px;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü */
        .page-content {
            padding: 24px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ - —É–ª—É—á—à–µ–Ω—ã */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 24px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05));
            transform: rotate(45deg);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card:hover::before {
            top: -25%;
            right: -25%;
        }

        .stat-card.stat-success {
            border-left-color: var(--success-color);
        }

        .stat-card.stat-warning {
            border-left-color: var(--warning-color);
        }

        .stat-card.stat-danger {
            border-left-color: var(--danger-color);
        }

        .stat-card.stat-info {
            border-left-color: var(--info-color);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }

        .stat-change.negative {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }

        .stat-change.neutral {
            background: rgba(149, 165, 166, 0.1);
            color: var(--text-muted);
        }

        /* –¢–∞–±–ª–∏—Ü—ã - —É–ª—É—á—à–µ–Ω—ã */
        .table-container {
            background: var(--bg-primary);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--bg-secondary);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .table tr:hover {
            background: var(--bg-secondary);
        }

        .table tr.selected {
            background: rgba(102, 126, 234, 0.1);
        }

        /* –ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π */
        .bulk-checkbox {
            width: 18px;
            height: 18px;
            margin: 0;
        }

        .bulk-actions {
            display: none;
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            margin-bottom: 16px;
            border-radius: var(--border-radius);
            align-items: center;
            gap: 16px;
        }

        .bulk-actions.show {
            display: flex;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ - —É–ª—É—á—à–µ–Ω—ã */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-dialog {
            background: var(--bg-primary);
            border-radius: var(--border-radius-lg);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-muted);
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* –§–æ—Ä–º—ã - —É–ª—É—á—à–µ–Ω—ã */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        /* –§–∞–π–ª–æ–≤—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--success-color);
            background: rgba(46, 204, 113, 0.05);
        }

        .uploaded-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .uploaded-image {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            aspect-ratio: 1;
            border: 2px solid var(--border-color);
        }

        .uploaded-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –°—Ç–∞—Ç—É—Å –±–µ–π–¥–∂–∏ - —É–ª—É—á—à–µ–Ω—ã */
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .status-new {
            background: rgba(52, 152, 219, 0.1);
            color: var(--info-color);
        }

        .status-processing {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }

        .status-completed {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }

        .status-cancelled {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }

        /* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ */
        .filters-bar {
            background: var(--bg-primary);
            padding: 16px;
            border-radius: var(--border-radius-lg);
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }

        .filters-content {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 200px;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
        }

        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
        }

        /* –ü—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
        }

        .notification-success {
            background: var(--success-color);
            color: white;
        }

        .notification-error {
            background: var(--danger-color);
            color: white;
        }

        .notification-info {
            background: var(--info-color);
            color: white;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* –õ–æ–∞–¥–µ—Ä */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            border: 4px solid var(--bg-secondary);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }

            .filters-content {
                flex-direction: column;
                align-items: stretch;
            }

            .modal-dialog {
                width: 95%;
                margin: 10px;
            }
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - –ù–û–í–û–ï */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1e1e1e;
                --bg-secondary: #2d2d2d;
                --text-primary: #ffffff;
                --text-secondary: #cccccc;
                --text-muted: #999999;
                --border-color: #404040;
            }
        }
    </style>
</head>
<body class='admin-panel'>
    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <aside class='sidebar' id='sidebar'>
        <div class='sidebar-header'>
            <div class='admin-logo'>
                <div class='logo-icon'>üê†</div>
                <div class='logo-text'>
                    <div class='logo-title'>–ê–∫–≤–∞–°–±–æ—Ä</div>
                    <div class='logo-subtitle'>MEGA CRM v3.0</div>
                </div>
            </div>
        </div>

        <nav class='sidebar-nav'>
            <div class='nav-section'>
                <div class='nav-title'>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
                <a href='admin.php?section=dashboard' class='sidebar-link <?= $section === 'dashboard' ? 'active' : '' ?>'>
                    <i class='fas fa-chart-pie'></i>
                    <span>KPI –î–∞—à–±–æ—Ä–¥</span>
                </a>
                <a href='admin.php?section=analytics' class='sidebar-link <?= $section === 'analytics' ? 'active' : '' ?>'>
                    <i class='fas fa-chart-line'></i>
                    <span>–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–¥–∞–∂</span>
                    <span class='sidebar-badge'>LIVE</span>
                </a>
            </div>

            <div class='nav-section'>
                <div class='nav-title'>üõí –ú–∞–≥–∞–∑–∏–Ω</div>
                <a href='admin.php?section=products' class='sidebar-link <?= $section === 'products' ? 'active' : '' ?>'>
                    <i class='fas fa-fish'></i>
                    <span>–¢–æ–≤–∞—Ä—ã</span>
                    <span class='sidebar-badge'><?= count(getProducts()) ?></span>
                </a>
                <a href='admin.php?section=categories' class='sidebar-link <?= $section === 'categories' ? 'active' : '' ?>'>
                    <i class='fas fa-tags'></i>
                    <span>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                    <span class='sidebar-badge'><?= count(getCategories()) ?></span>
                </a>
                <a href='admin.php?section=orders' class='sidebar-link <?= $section === 'orders' ? 'active' : '' ?>'>
                    <i class='fas fa-shopping-bag'></i>
                    <span>–ó–∞–∫–∞–∑—ã</span>
                    <span class='sidebar-badge badge-warning'><?= count(array_filter(getOrders(), fn($o) => $o['status'] === 'new')) ?></span>
                </a>
                <a href='admin.php?section=reviews' class='sidebar-link <?= $section === 'reviews' ? 'active' : '' ?>'>
                    <i class='fas fa-star'></i>
                    <span>–û—Ç–∑—ã–≤—ã</span>
                    <span class='sidebar-badge'><?= count(array_filter(getReviews(), fn($r) => !$r['is_approved'])) ?></span>
                </a>
            </div>

            <div class='nav-section'>
                <div class='nav-title'>üìù –ö–æ–Ω—Ç–µ–Ω—Ç</div>
                <a href='admin.php?section=news' class='sidebar-link <?= $section === 'news' ? 'active' : '' ?>'>
                    <i class='fas fa-newspaper'></i>
                    <span>–ù–æ–≤–æ—Å—Ç–∏</span>
                    <span class='sidebar-badge'><?= count(getNews()) ?></span>
                </a>
                <a href='admin.php?section=pages' class='sidebar-link <?= $section === 'pages' ? 'active' : '' ?>'>
                    <i class='fas fa-file-alt'></i>
                    <span>–°—Ç—Ä–∞–Ω–∏—Ü—ã</span>
                </a>
            </div>

            <div class='nav-section'>
                <div class='nav-title'>‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞</div>
                <a href='admin.php?section=settings' class='sidebar-link <?= $section === 'settings' ? 'active' : '' ?>'>
                    <i class='fas fa-cog'></i>
                    <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    <span class='sidebar-badge badge-premium'>PRO</span>
                </a>
                <a href='admin.php?section=logs' class='sidebar-link <?= $section === 'logs' ? 'active' : '' ?>'>
                    <i class='fas fa-list-alt'></i>
                    <span>–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</span>
                </a>
            </div>
        </nav>

        <div class='sidebar-footer'>
            <div class='admin-profile'>
                <div class='admin-avatar'>üë§</div>
                <div class='admin-info'>
                    <div class='admin-name'><?= $_SESSION['admin_name'] ?></div>
                    <div class='admin-role'><?= $_SESSION['admin_role'] ?></div>
                </div>
                <a href='admin.php?action=logout' class='logout-btn' title='–í—ã—Ö–æ–¥'>
                    <i class='fas fa-sign-out-alt'></i>
                </a>
            </div>
        </div>
    </aside>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class='main-content'>
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <header class='top-bar'>
            <div class='top-bar-left'>
                <h1 class='page-title'><?= $adminData['title'] ?? '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å' ?></h1>
            </div>

            <div class='top-bar-right'>
                <button class='btn btn-outline' onclick='toggleSidebar()' id='sidebarToggle'>
                    <i class='fas fa-bars'></i>
                </button>
                <a href='index.php' class='btn btn-outline' target='_blank'>
                    <i class='fas fa-external-link-alt'></i>
                    –ù–∞ —Å–∞–π—Ç
                </a>
            </div>
        </header>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class='page-content'>
            <?php if (isset($_SESSION['admin_message'])): ?>
                <div class='notification notification-<?= $_SESSION['admin_message']['type'] ?>' id='adminNotification'>
                    <?= htmlspecialchars($_SESSION['admin_message']['text']) ?>
                </div>
                <?php unset($_SESSION['admin_message']); ?>
            <?php endif; ?>

            <?php renderAdminSection($section, $adminData); ?>
        </div>
    </main>

    <!-- –õ–æ–∞–¥–µ—Ä -->
    <div class='loading-overlay' id='loadingOverlay'>
        <div class='spinner'></div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script>
        // === –ë–ê–ó–û–í–´–ï –§–£–ù–ö–¶–ò–ò –ê–î–ú–ò–ù–ö–ò ===

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function showNotification(message, type = 'info') {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            document.querySelectorAll('.notification').forEach(n => n.remove());

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class='fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}'></i>
                ${message}
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // === –û–ë–†–ê–ë–û–¢–ß–ò–ö –§–û–†–ú ===
        document.addEventListener('submit', function(e) {
            if (e.target.classList.contains('ajax-form')) {
                e.preventDefault();
                handleAjaxForm(e.target);
            }
        });

        async function handleAjaxForm(form) {
            showLoading();

            const formData = new FormData(form);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–î–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ', 'success');

                    if (data.reload) {
                        setTimeout(() => location.reload(), 1500);
                    }

                    if (data.close_modal) {
                        Object.keys(data.close_modal === true ? {'modal': true} : data.close_modal).forEach(modalId => {
                            closeModal(modalId);
                        });
                    }

                    if (data.callback) {
                        window[data.callback](data);
                    }
                } else {
                    showNotification(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                console.error('AJAX Error:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–ê–ë–õ–ò–¶ ===

        function toggleAllCheckboxes(masterCheckbox) {
            const checkboxes = document.querySelectorAll('.bulk-checkbox[data-id]');
            checkboxes.forEach(cb => {
                cb.checked = masterCheckbox.checked;
                toggleRowSelection(cb);
            });
            updateBulkActions();
        }

        function toggleRowSelection(checkbox) {
            const row = checkbox.closest('tr');
            if (checkbox.checked) {
                row.classList.add('selected');
            } else {
                row.classList.remove('selected');
            }
        }

        function updateBulkActions() {
            const selectedCheckboxes = document.querySelectorAll('.bulk-checkbox[data-id]:checked');
            const bulkActions = document.querySelector('.bulk-actions');
            const selectedCount = document.getElementById('selectedCount');

            if (selectedCheckboxes.length > 0) {
                bulkActions?.classList.add('show');
                if (selectedCount) {
                    selectedCount.textContent = selectedCheckboxes.length;
                }
            } else {
                bulkActions?.classList.remove('show');
            }
        }

        function getSelectedIds() {
            const selectedCheckboxes = document.querySelectorAll('.bulk-checkbox[data-id]:checked');
            return Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-id'));
        }

        async function bulkAction(action, additionalData = {}) {
            const selectedIds = getSelectedIds();

            if (selectedIds.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
                return;
            }

            if (!confirm(`–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ "${action}" –¥–ª—è ${selectedIds.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤?`)) {
                return;
            }

            showLoading();

            const formData = new FormData();
            formData.append('action', 'bulk_action');
            formData.append('bulk_action', action);
            formData.append('ids', JSON.stringify(selectedIds));
            formData.append('ajax', '1');

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            Object.entries(additionalData).forEach(([key, value]) => {
                formData.append(key, value);
            });

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                console.error('Bulk Action Error:', error);
                showNotification('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
            } finally {
                hideLoading();
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –§–ê–ô–õ–û–í ===

        function initFileUpload(uploadAreaId, inputId) {
            const uploadArea = document.getElementById(uploadAreaId);
            const fileInput = document.getElementById(inputId);

            if (!uploadArea || !fileInput) return;

            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleFileSelection(files, inputId);
            });

            fileInput.addEventListener('change', (e) => {
                handleFileSelection(e.target.files, inputId);
            });
        }

        function handleFileSelection(files, inputId) {
            const previewContainer = document.getElementById(inputId.replace('Input', 'Preview'));
            if (!previewContainer) return;

            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageDiv = document.createElement('div');
                        imageDiv.className = 'uploaded-image';
                        imageDiv.innerHTML = `
                            <img src='${e.target.result}' alt='Preview'>
                            <button type='button' class='image-remove' onclick='removePreviewImage(this)'>
                                <i class='fas fa-times'></i>
                            </button>
                        `;
                        previewContainer.appendChild(imageDiv);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function removePreviewImage(button) {
            button.parentElement.remove();
        }

        // === –§–ò–õ–¨–¢–†–´ –ò –ü–û–ò–°–ö ===

        let searchTimeout;
        function initSearch(inputId, callback) {
            const searchInput = document.getElementById(inputId);
            if (!searchInput) return;

            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    callback(e.target.value);
                }, 300);
            });
        }

        function filterTable(tableId, searchTerm, columns = []) {
            const table = document.getElementById(tableId);
            if (!table) return;

            const rows = table.querySelectorAll('tbody tr');
            const term = searchTerm.toLowerCase();

            rows.forEach(row => {
                let match = false;

                if (columns.length > 0) {
                    columns.forEach(colIndex => {
                        const cell = row.cells[colIndex];
                        if (cell && cell.textContent.toLowerCase().includes(term)) {
                            match = true;
                        }
                    });
                } else {
                    // –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Å—Ç–æ–ª–±—Ü–∞–º
                    if (row.textContent.toLowerCase().includes(term)) {
                        match = true;
                    }
                }

                row.style.display = match ? '' : 'none';
            });
        }

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', function() {
            // –°–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            const notification = document.getElementById('adminNotification');
            if (notification) {
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–≤ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏—Ö
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    closeModal(e.target.id);
                }
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('bulk-checkbox')) {
                    if (e.target.hasAttribute('data-id')) {
                        toggleRowSelection(e.target);
                        updateBulkActions();
                    } else {
                        // –≠—Ç–æ master checkbox
                        toggleAllCheckboxes(e.target);
                    }
                }
            });
        });

        // === CSS –ê–ù–ò–ú–ê–¶–ò–ò ===
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

<?php

// === –§–£–ù–ö–¶–ò–ò –î–ê–ù–ù–´–• –ê–î–ú–ò–ù–ö–ò ===

function getAdminData($section) {
    switch ($section) {
        case 'dashboard':
            return [
                'title' => 'KPI –î–∞—à–±–æ—Ä–¥',
                'stats' => getDashboardStats()
            ];

        case 'products':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏',
                'products' => getProducts(),
                'categories' => getCategories()
            ];

        case 'categories':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏',
                'categories' => getCategories(),
                'products' => getProducts()
            ];

        case 'orders':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏',
                'orders' => getOrders()
            ];

        case 'reviews':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏',
                'reviews' => getReviews()
            ];

        case 'news':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏',
                'news' => getNews()
            ];

        case 'analytics':
            return [
                'title' => '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂',
                'charts' => getAnalyticsData()
            ];

        case 'settings':
            return [
                'title' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã',
                'settings' => getSiteSettings()
            ];

        case 'logs':
            return [
                'title' => '–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏',
                'logs' => getLogs()
            ];

        case 'pages':
            return [
                'title' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏',
                'pages' => getPages()
            ];

        default:
            return [
                'title' => ucfirst($section),
                'description' => "–†–∞–∑–¥–µ–ª '$section' –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"
            ];
    }
}

// === –°–¢–ê–¢–ò–°–¢–ò–ö–ê –î–ê–®–ë–û–†–î–ê ===

function getDashboardStats() {
    $products = getProducts();
    $orders = getOrders();
    $reviews = getReviews();
    $categories = getCategories();

    $totalRevenue = array_sum(array_column($orders, 'total_amount'));
    $newOrders = count(array_filter($orders, fn($o) => $o['status'] === 'new'));
    $lowStock = count(array_filter($products, fn($p) => $p['stock'] <= 5));
    $avgRating = count($reviews) > 0 ? array_sum(array_column($reviews, 'rating')) / count($reviews) : 0;
    $activeProducts = count(array_filter($products, fn($p) => $p['is_active']));
    $pendingReviews = count(array_filter($reviews, fn($r) => !$r['is_approved']));

    // –î–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
    $monthAgo = date('Y-m-d', strtotime('-30 days'));
    $monthlyOrders = array_filter($orders, fn($o) => $o['created_at'] >= $monthAgo);
    $monthlyRevenue = array_sum(array_column($monthlyOrders, 'total_amount'));

    // –†–æ—Å—Ç –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –º–µ—Å—è—Ü–µ–º
    $twoMonthsAgo = date('Y-m-d', strtotime('-60 days'));
    $prevMonthOrders = array_filter($orders, function($o) use ($monthAgo, $twoMonthsAgo) {
        return $o['created_at'] >= $twoMonthsAgo && $o['created_at'] < $monthAgo;
    });
    $prevMonthRevenue = array_sum(array_column($prevMonthOrders, 'total_amount'));

    $revenueGrowth = $prevMonthRevenue > 0 ? 
        round((($monthlyRevenue - $prevMonthRevenue) / $prevMonthRevenue) * 100, 1) : 0;

    return [
        'revenue' => [
            'value' => number_format($totalRevenue, 0, '', ' ') . ' ‚ÇΩ',
            'label' => '–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞',
            'change' => ($revenueGrowth > 0 ? '+' : '') . $revenueGrowth . '%',
            'color' => 'success',
            'trend' => $revenueGrowth > 0 ? 'up' : ($revenueGrowth < 0 ? 'down' : 'neutral')
        ],
        'orders' => [
            'value' => count($orders),
            'label' => '–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤',
            'change' => '+' . $newOrders . ' –Ω–æ–≤—ã—Ö',
            'color' => 'info',
            'trend' => 'up'
        ],
        'products' => [
            'value' => $activeProducts,
            'label' => '–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤',
            'change' => $lowStock . ' –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è',
            'color' => $lowStock > 10 ? 'warning' : 'success',
            'trend' => $lowStock > 10 ? 'down' : 'neutral'
        ],
        'rating' => [
            'value' => number_format($avgRating, 1),
            'label' => '–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥',
            'change' => count($reviews) . ' –æ—Ç–∑—ã–≤–æ–≤',
            'color' => $avgRating >= 4 ? 'success' : ($avgRating >= 3 ? 'warning' : 'danger'),
            'trend' => 'neutral'
        ],
        'categories' => [
            'value' => count(array_filter($categories, fn($c) => $c['active'])),
            'label' => '–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π',
            'change' => '–∏–∑ ' . count($categories),
            'color' => 'info',
            'trend' => 'neutral'
        ],
        'pending_reviews' => [
            'value' => $pendingReviews,
            'label' => '–û–∂–∏–¥–∞—é—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏',
            'change' => '–æ—Ç–∑—ã–≤–æ–≤',
            'color' => $pendingReviews > 5 ? 'warning' : 'success',
            'trend' => $pendingReviews > 5 ? 'up' : 'neutral'
        ]
    ];
}

// === –†–ï–ù–î–ï–†–ò–ù–ì –†–ê–ó–î–ï–õ–û–í ===

function renderAdminSection($section, $data) {
    switch ($section) {
        case 'dashboard':
            renderDashboard($data);
            break;
        case 'products':
            renderProductsSection($data);
            break;
        case 'categories':
            renderCategoriesSection($data);
            break;
        case 'orders':
            renderOrdersSection($data);
            break;
        case 'reviews':
            renderReviewsSection($data);
            break;
        case 'news':
            renderNewsSection($data);
            break;
        case 'analytics':
            renderAnalyticsSection($data);
            break;
        case 'settings':
            renderSettingsSection($data);
            break;
        case 'logs':
            renderLogsSection($data);
            break;
        case 'pages':
            renderPagesSection($data);
            break;
        default:
            renderDefaultSection($section, $data);
    }
}

// === –î–ê–®–ë–û–†–î ===
function renderDashboard($data) {
    $stats = $data['stats'];
    ?>
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class='stats-grid'>
        <?php foreach ($stats as $key => $stat): ?>
            <div class='stat-card stat-<?= $stat['color'] ?>'>
                <div style='display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;'>
                    <div class='stat-value'><?= $stat['value'] ?></div>
                    <div style='color: var(--<?= $stat['color'] ?>-color);'>
                        <i class='fas fa-<?= $stat['trend'] === 'up' ? 'arrow-up' : ($stat['trend'] === 'down' ? 'arrow-down' : 'minus') ?>'></i>
                    </div>
                </div>
                <div class='stat-label'><?= $stat['label'] ?></div>
                <div class='stat-change <?= $stat['trend'] === 'up' ? 'positive' : ($stat['trend'] === 'down' ? 'negative' : 'neutral') ?>'>
                    <?= $stat['change'] ?>
                </div>
            </div>
        <?php endforeach; ?>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;'>
        <div class='stat-card' style='cursor: pointer; border-left-color: var(--primary-color);' onclick='location.href="admin.php?section=products"'>
            <div style='display: flex; align-items: center; gap: 16px;'>
                <div style='font-size: 3em; color: var(--primary-color);'>üõçÔ∏è</div>
                <div>
                    <div class='stat-label'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</div>
                    <div style='font-size: 14px; color: var(--text-secondary);'>–î–æ–±–∞–≤–∏—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</div>
                </div>
            </div>
        </div>

        <div class='stat-card' style='cursor: pointer; border-left-color: var(--warning-color);' onclick='location.href="admin.php?section=orders"'>
            <div style='display: flex; align-items: center; gap: 16px;'>
                <div style='font-size: 3em; color: var(--warning-color);'>üìã</div>
                <div>
                    <div class='stat-label'>–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–∫–∞–∑—ã</div>
                    <div style='font-size: 14px; color: var(--text-secondary);'>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                </div>
            </div>
        </div>

        <div class='stat-card' style='cursor: pointer; border-left-color: var(--success-color);' onclick='location.href="admin.php?section=news"'>
            <div style='display: flex; align-items: center; gap: 16px;'>
                <div style='font-size: 3em; color: var(--success-color);'>üì∞</div>
                <div>
                    <div class='stat-label'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</div>
                    <div style='font-size: 14px; color: var(--text-secondary);'>–°–æ–∑–¥–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é</div>
                </div>
            </div>
        </div>

        <div class='stat-card' style='cursor: pointer; border-left-color: var(--info-color);' onclick='location.href="admin.php?section=settings"'>
            <div style='display: flex; align-items: center; gap: 16px;'>
                <div style='font-size: 3em; color: var(--info-color);'>‚öôÔ∏è</div>
                <div>
                    <div class='stat-label'>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                    <div style='font-size: 14px; color: var(--text-secondary);'>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
    <div class='table-container'>
        <div style='padding: 20px 20px 0; display: flex; justify-content: space-between; align-items: center;'>
            <h3 style='margin: 0; color: var(--text-primary);'>üìà –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
            <button class='btn btn-outline btn-sm' onclick='location.reload()'>
                <i class='fas fa-sync-alt'></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
        <table class='table'>
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    <th>–î–µ—Ç–∞–ª–∏</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                <?php
                $activities = [
                    ['time' => '2 –º–∏–Ω –Ω–∞–∑–∞–¥', 'action' => '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑', 'details' => '–ó–∞–∫–∞–∑ #AQ-2024-0051 –Ω–∞ —Å—É–º–º—É 2,450 ‚ÇΩ', 'status' => 'new', 'icon' => 'shopping-bag'],
                    ['time' => '8 –º–∏–Ω –Ω–∞–∑–∞–¥', 'action' => '–ù–æ–≤—ã–π –æ—Ç–∑—ã–≤', 'details' => '–û—Ç–∑—ã–≤ –Ω–∞ —Ç–æ–≤–∞—Ä "–ê–Ω—É–±–∏–∞—Å –ë–∞—Ä—Ç–µ—Ä–∞ –Ω–∞–Ω–∞"', 'status' => 'processing', 'icon' => 'star'],
                    ['time' => '23 –º–∏–Ω –Ω–∞–∑–∞–¥', 'action' => '–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω', 'details' => '–û–±–Ω–æ–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä "–°–∫–∞–ª—è—Ä–∏—è —Å–µ—Ä–µ–±—Ä–∏—Å—Ç–∞—è"', 'status' => 'completed', 'icon' => 'edit'],
                    ['time' => '1 —á–∞—Å –Ω–∞–∑–∞–¥', 'action' => '–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω', 'details' => '–ó–∞–∫–∞–∑ #AQ-2024-0049 —É—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω', 'status' => 'completed', 'icon' => 'truck'],
                    ['time' => '2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥', 'action' => '–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è', 'details' => '–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ú–æ—Ä—Å–∫–∏–µ —Ä—ã–±–∫–∏"', 'status' => 'completed', 'icon' => 'plus']
                ];
                foreach ($activities as $activity): ?>
                    <tr>
                        <td style='color: var(--text-muted); font-size: 13px;'><?= $activity['time'] ?></td>
                        <td>
                            <div style='display: flex; align-items: center; gap: 8px;'>
                                <i class='fas fa-<?= $activity['icon'] ?>' style='color: var(--primary-color);'></i>
                                <span style='font-weight: 600;'><?= $activity['action'] ?></span>
                            </div>
                        </td>
                        <td><?= $activity['details'] ?></td>
                        <td>
                            <span class='status-badge status-<?= $activity['status'] ?>'>
                                <?= $activity['status'] === 'new' ? '–ù–æ–≤–æ–µ' : ($activity['status'] === 'processing' ? '–û–±—Ä–∞–±–æ—Ç–∫–∞' : '–í—ã–ø–æ–ª–Ω–µ–Ω–æ') ?>
                            </span>
                        </td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php
}
<?php
// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û ===
function renderProductsSection($data) {
    $products = $data['products'];
    $categories = $data['categories'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–¢–æ–≤–∞—Ä—ã (<?= count($products) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>
        <div style='display: flex; gap: 12px;'>
            <button class='btn btn-success' onclick='openModal("addProductModal")'>
                <i class='fas fa-plus'></i>
                –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
            </button>
            <button class='btn btn-outline' onclick='exportProducts()'>
                <i class='fas fa-download'></i>
                –≠–∫—Å–ø–æ—Ä—Ç
            </button>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class='filters-bar'>
        <div class='filters-content'>
            <div class='search-box'>
                <input type='text' id='productSearch' class='search-input' placeholder='–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞—Ä—Ç–∏–∫—É–ª—É...'>
                <button class='search-btn' type='button'>
                    <i class='fas fa-search'></i>
                </button>
            </div>
            <select class='form-select' style='max-width: 200px;' onchange='filterByCategory(this.value)'>
                <option value=''>–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <?php foreach ($categories as $category): ?>
                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                <?php endforeach; ?>
            </select>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStock(this.value)'>
                <option value=''>–õ—é–±–æ–π –æ—Å—Ç–∞—Ç–æ–∫</option>
                <option value='in_stock'>–í –Ω–∞–ª–∏—á–∏–∏</option>
                <option value='low_stock'>–ú–∞–ª–æ —Ç–æ–≤–∞—Ä–∞</option>
                <option value='out_of_stock'>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
            </select>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStatus(this.value)'>
                <option value=''>–õ—é–±–æ–π —Å—Ç–∞—Ç—É—Å</option>
                <option value='active'>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value='inactive'>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value='featured'>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                <option value='new'>–ù–æ–≤–∏–Ω–∫–∏</option>
            </select>
        </div>
    </div>

    <!-- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
    <div class='bulk-actions' id='bulkActions'>
        <div style='display: flex; align-items: center; gap: 16px;'>
            <span>–í—ã–±—Ä–∞–Ω–æ: <strong id='selectedCount'>0</strong> —Ç–æ–≤–∞—Ä–æ–≤</span>
            <button class='btn btn-success btn-sm' onclick='bulkAction("activate")'>
                <i class='fas fa-eye'></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class='btn btn-warning btn-sm' onclick='bulkAction("deactivate")'>
                <i class='fas fa-eye-slash'></i> –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class='btn btn-outline btn-sm' onclick='openBulkCategoryModal()'>
                <i class='fas fa-tags'></i> –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </button>
            <button class='btn btn-danger btn-sm' onclick='bulkAction("delete")'>
                <i class='fas fa-trash'></i> –£–¥–∞–ª–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class='table-container'>
        <table class='table' id='productsTable'>
            <thead>
                <tr>
                    <th style='width: 40px;'>
                        <input type='checkbox' class='bulk-checkbox' onchange='toggleAllCheckboxes(this)'>
                    </th>
                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($products as $product): ?>
                <tr class='product-row' data-category='<?= $product['category_id'] ?>' 
                    data-stock='<?= $product['stock'] ?>' data-status='<?= $product['is_active'] ? 'active' : 'inactive' ?>'>
                    <td>
                        <input type='checkbox' class='bulk-checkbox' data-id='<?= $product['id'] ?>' onchange='updateBulkActions()'>
                    </td>
                    <td>
                        <div style='width: 60px; height: 60px; border-radius: var(--border-radius); overflow: hidden; background: var(--bg-secondary); display: flex; align-items: center; justify-content: center;'>
                            <?php if (!empty($product['images'])): ?>
                                <img src='<?= htmlspecialchars($product['images'][0]) ?>' alt='<?= htmlspecialchars($product['name']) ?>' 
                                     style='width: 100%; height: 100%; object-fit: cover;'>
                            <?php else: ?>
                                <i class='fas fa-image' style='color: var(--text-muted); font-size: 20px;'></i>
                            <?php endif; ?>
                        </div>
                    </td>
                    <td>
                        <div>
                            <div style='font-weight: 600; margin-bottom: 4px; cursor: pointer;' onclick='editProduct(<?= $product['id'] ?>)'>
                                <?= htmlspecialchars(mb_substr($product['name'], 0, 50)) ?>
                                <?php if (mb_strlen($product['name']) > 50): ?>...<?php endif; ?>
                            </div>
                            <div style='font-size: 12px; color: var(--text-muted);'>
                                –ê—Ä—Ç–∏–∫—É–ª: <?= $product['sku'] ?> | ID: <?= $product['id'] ?>
                            </div>
                            <div style='display: flex; gap: 4px; margin-top: 4px;'>
                                <?php if ($product['is_featured']): ?>
                                    <span style='background: gold; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;'>üî• –•–ò–¢</span>
                                <?php endif; ?>
                                <?php if ($product['is_new']): ?>
                                    <span style='background: var(--info-color); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;'>‚ú® –ù–û–í–ò–ù–ö–ê</span>
                                <?php endif; ?>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span style='padding: 4px 8px; background: var(--info-color); color: white; border-radius: 4px; font-size: 11px;'>
                            <?= htmlspecialchars($product['category']) ?>
                        </span>
                    </td>
                    <td>
                        <div style='font-weight: 600; color: var(--success-color);'><?= number_format($product['price'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <?php if ($product['old_price']): ?>
                            <div style='font-size: 11px; color: var(--text-muted); text-decoration: line-through;'>
                                <?= number_format($product['old_price'], 0, '', ' ') ?> ‚ÇΩ
                            </div>
                        <?php endif; ?>
                    </td>
                    <td>
                        <span class='status-badge <?= $product['stock'] <= 0 ? 'status-cancelled' : ($product['stock'] <= 5 ? 'status-processing' : 'status-completed') ?>'>
                            <?= $product['stock'] ?> —à—Ç
                        </span>
                    </td>
                    <td>
                        <label style='display: flex; align-items: center; cursor: pointer;'>
                            <input type='checkbox' <?= $product['is_active'] ? 'checked' : '' ?> 
                                   onchange='toggleProductStatus(<?= $product['id'] ?>, this.checked)' 
                                   style='margin-right: 8px;'>
                            <span class='status-badge <?= $product['is_active'] ? 'status-completed' : 'status-cancelled' ?>'>
                                <?= $product['is_active'] ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–°–∫—Ä—ã—Ç' ?>
                            </span>
                        </label>
                    </td>
                    <td>
                        <div style='display: flex; gap: 4px;'>
                            <button class='btn btn-primary btn-sm' onclick='editProduct(<?= $product['id'] ?>)' title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'>
                                <i class='fas fa-edit'></i>
                            </button>
                            <button class='btn btn-outline btn-sm' onclick='duplicateProduct(<?= $product['id'] ?>)' title='–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å'>
                                <i class='fas fa-copy'></i>
                            </button>
                            <button class='btn btn-outline btn-sm' onclick='viewProduct(<?= $product['id'] ?>)' title='–ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ —Å–∞–π—Ç–µ'>
                                <i class='fas fa-eye'></i>
                            </button>
                            <button class='btn btn-danger btn-sm' onclick='deleteProduct(<?= $product['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                                <i class='fas fa-trash'></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='addProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data'>
                <input type='hidden' name='action' value='add_product'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addProductModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                            <input type='text' name='name' class='form-input' required 
                                   placeholder='–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ê—Ä—Ç–∏–∫—É–ª</label>
                            <input type='text' name='sku' class='form-input' 
                                   placeholder='–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'>
                        </div>
                    </div>

                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select name='category_id' class='form-select' required>
                                <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <?php foreach ($categories as $category): ?>
                                    <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                            <input type='number' name='stock' class='form-input' min='0' required value='1'>
                        </div>
                    </div>

                    <!-- –¶–µ–Ω—ã -->
                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                            <input type='number' name='price' class='form-input' min='0' step='0.01' required>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</label>
                            <input type='number' name='old_price' class='form-input' min='0' step='0.01' 
                                   placeholder='–î–ª—è –ø–æ–∫–∞–∑–∞ —Å–∫–∏–¥–∫–∏'>
                        </div>
                    </div>

                    <!-- –û–ø–∏—Å–∞–Ω–∏—è -->
                    <div class='form-group'>
                        <label class='form-label'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='short_description' class='form-textarea' rows='2' 
                                  placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞'></textarea>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' class='form-textarea' rows='4' 
                                  placeholder='–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'></textarea>
                    </div>

                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class='form-group'>
                        <label class='form-label'>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
                        <div class='file-upload-area' id='productImageUpload'>
                            <i class='fas fa-cloud-upload-alt' style='font-size: 48px; color: var(--text-muted); margin-bottom: 16px;'></i>
                            <p style='margin: 0 0 16px; color: var(--text-muted);'>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                            <button type='button' class='btn btn-outline'>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
                            <input type='file' name='images[]' accept='image/*' multiple style='display: none;' id='productImageInput'>
                        </div>
                        <div class='uploaded-images' id='productImagePreview'></div>
                        <small style='color: var(--text-muted);'>–ú–∞–∫—Å–∏–º—É–º 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ 10MB –∫–∞–∂–¥–æ–µ. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, WEBP, GIF</small>
                    </div>

                    <!-- –†–∞–∑–º–µ—Ä—ã –∏ –≤–µ—Å -->
                    <div class='form-row-3'>
                        <div class='form-group'>
                            <label class='form-label'>–î–ª–∏–Ω–∞ (—Å–º)</label>
                            <input type='number' name='length' class='form-input' min='0' value='10'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–®–∏—Ä–∏–Ω–∞ (—Å–º)</label>
                            <input type='number' name='width' class='form-input' min='0' value='10'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–í—ã—Å–æ—Ç–∞ (—Å–º)</label>
                            <input type='number' name='height' class='form-input' min='0' value='10'>
                        </div>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–í–µ—Å (–≥)</label>
                        <input type='number' name='weight' class='form-input' min='0' value='100'>
                    </div>

                    <!-- SEO -->
                    <details style='margin: 20px 0;'>
                        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
                        <div class='form-group'>
                            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type='text' name='meta_title' class='form-input' 
                                   placeholder='–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name='meta_description' class='form-textarea' rows='2' 
                                      placeholder='–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'></textarea>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
                            <input type='text' name='meta_keywords' class='form-input' 
                                   placeholder='–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ, –µ—â–µ —Å–ª–æ–≤–æ'>
                        </div>
                    </details>

                    <!-- –°—Ç–∞—Ç—É—Å—ã -->
                    <div style='display: flex; gap: 20px; align-items: center; margin-top: 20px;'>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_featured'> 
                            <span>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç–æ–≤–∞—Ä</span>
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_new'> 
                            <span>‚ú® –ù–æ–≤–∏–Ω–∫–∞</span>
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_active' checked> 
                            <span>üëÅÔ∏è –ê–∫—Ç–∏–≤–µ–Ω</span>
                        </label>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class='modal' id='editProductModal'>
        <div class='modal-dialog' style='max-width: 900px;'>
            <form class='ajax-form' method='POST' enctype='multipart/form-data' id='editProductForm'>
                <input type='hidden' name='action' value='edit_product'>
                <input type='hidden' name='product_id' id='editProductId'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
                    <button type='button' class='modal-close' onclick='closeModal("editProductModal")'>&times;</button>
                </div>
                <div class='modal-body' id='editProductContent'>
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("editProductModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='bulkCategoryModal'>
        <div class='modal-dialog'>
            <div class='modal-header'>
                <h3 class='modal-title'>–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <button type='button' class='modal-close' onclick='closeModal("bulkCategoryModal")'>&times;</button>
            </div>
            <div class='modal-body'>
                <div class='form-group'>
                    <label class='form-label'>–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                    <select class='form-select' id='bulkCategorySelect' required>
                        <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <?php foreach ($categories as $category): ?>
                            <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-outline' onclick='closeModal("bulkCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                <button type='button' class='btn btn-primary' onclick='applyBulkCategory()'>
                    <i class='fas fa-check'></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            initSearch('productSearch', (query) => {
                filterTable('productsTable', query, [2, 3]); // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
            initFileUpload('productImageUpload', 'productImageInput');
        });

        // === –§–£–ù–ö–¶–ò–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò ===
        function filterByCategory(categoryId) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                if (!categoryId || row.dataset.category === categoryId) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterByStock(type) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                const stock = parseInt(row.dataset.stock);
                let show = true;

                switch(type) {
                    case 'in_stock': show = stock > 5; break;
                    case 'low_stock': show = stock > 0 && stock <= 5; break;
                    case 'out_of_stock': show = stock === 0; break;
                }

                row.style.display = show ? '' : 'none';
            });
        }

        function filterByStatus(status) {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                let show = true;

                switch(status) {
                    case 'active': show = row.dataset.status === 'active'; break;
                    case 'inactive': show = row.dataset.status === 'inactive'; break;
                    case 'featured': show = row.querySelector('.fa-fire') !== null; break;
                    case 'new': show = row.querySelector('.fa-star') !== null; break;
                }

                row.style.display = show ? '' : 'none';
            });
        }

        // === –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –¢–û–í–ê–†–ê–ú–ò ===
        async function editProduct(id) {
            showLoading();

            try {
                const response = await fetch(`admin.php?action=get_product&id=${id}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('editProductId').value = id;
                    document.getElementById('editProductContent').innerHTML = data.html;
                    openModal('editProductModal');

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    if (document.getElementById('editProductImageUpload')) {
                        initFileUpload('editProductImageUpload', 'editProductImageInput');
                    }
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–∞', 'error');
            } finally {
                hideLoading();
            }
        }

        async function duplicateProduct(id) {
            if (!confirm('–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é —Ç–æ–≤–∞—Ä–∞?')) return;

            showLoading();

            const formData = new FormData();
            formData.append('action', 'duplicate_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–¢–æ–≤–∞—Ä —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        async function deleteProduct(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            showLoading();

            const formData = new FormData();
            formData.append('action', 'delete_product');
            formData.append('product_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        function viewProduct(id) {
            window.open(`index.php?page=product&id=${id}`, '_blank');
        }

        async function toggleProductStatus(id, isActive) {
            const formData = new FormData();
            formData.append('action', 'toggle_product_status');
            formData.append('product_id', id);
            formData.append('is_active', isActive ? '1' : '0');
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω', 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        // === –ú–ê–°–°–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò ===
        function openBulkCategoryModal() {
            const selectedIds = getSelectedIds();
            if (selectedIds.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
                return;
            }
            openModal('bulkCategoryModal');
        }

        function applyBulkCategory() {
            const categoryId = document.getElementById('bulkCategorySelect').value;
            if (!categoryId) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }

            bulkAction('update_category', { category_id: categoryId });
            closeModal('bulkCategoryModal');
        }

        // === –≠–ö–°–ü–û–†–¢ ===
        function exportProducts() {
            const link = document.createElement('a');
            link.href = 'admin.php?action=export_products';
            link.download = 'products_export.csv';
            link.click();
            showNotification('–≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞—á–∞—Ç', 'info');
        }

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é bulkAction –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
        window.originalBulkAction = window.bulkAction;
        window.bulkAction = async function(action, additionalData = {}) {
            const selectedIds = getSelectedIds();

            if (selectedIds.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
                return;
            }

            let confirmMessage = `–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ "${action}" –¥–ª—è ${selectedIds.length} —Ç–æ–≤–∞—Ä–æ–≤?`;
            if (action === 'delete') {
                confirmMessage = `–í–ù–ò–ú–ê–ù–ò–ï! –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å ${selectedIds.length} —Ç–æ–≤–∞—Ä–æ–≤. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`;
            }

            if (!confirm(confirmMessage)) {
                return;
            }

            showLoading();

            const formData = new FormData();
            formData.append('action', 'bulk_products');
            formData.append('bulk_action', action);
            formData.append('ids', JSON.stringify(selectedIds));
            formData.append('ajax', '1');

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            Object.entries(additionalData).forEach(([key, value]) => {
                formData.append(key, value);
            });

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                console.error('Bulk Action Error:', error);
                showNotification('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
            } finally {
                hideLoading();
            }
        };
    </script>
    <?php
}

// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò - –ò–°–ü–†–ê–í–õ–ï–ù–û ===
function renderCategoriesSection($data) {
    $categories = $data['categories'];
    $products = $data['products'];

    // –ü–æ–¥—Å—á–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    $categoryStats = [];
    foreach ($categories as $category) {
        $categoryStats[$category['id']] = count(array_filter($products, fn($p) => $p['category_id'] == $category['id']));
    }
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (<?= count($categories) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>
        <button class='btn btn-success' onclick='openModal("addCategoryModal")'>
            <i class='fas fa-plus'></i>
            –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </button>
    </div>

    <!-- –°–µ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;'>
        <?php foreach ($categories as $category): ?>
            <div class='stat-card' style='position: relative; cursor: pointer;' onclick='editCategory(<?= $category['id'] ?>)'>
                <div style='display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;'>
                    <div style='display: flex; align-items: center; gap: 12px;'>
                        <div style='font-size: 48px;'><?= $category['icon'] ?></div>
                        <div>
                            <h3 style='margin: 0; font-size: 20px;'><?= htmlspecialchars($category['name']) ?></h3>
                            <p style='margin: 4px 0 0; color: var(--text-muted); font-size: 12px;'>
                                ID: <?= $category['id'] ?> | Slug: <?= $category['slug'] ?>
                            </p>
                        </div>
                    </div>
                    <div style='display: flex; flex-direction: column; align-items: end; gap: 8px;'>
                        <span class='status-badge <?= $category['active'] ? 'status-completed' : 'status-cancelled' ?>'>
                            <?= $category['active'] ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–°–∫—Ä—ã—Ç–∞' ?>
                        </span>
                        <div style='font-size: 12px; color: var(--text-muted);'>
                            –ü–æ—Ä—è–¥–æ–∫: <?= $category['sort_order'] ?>
                        </div>
                    </div>
                </div>

                <p style='color: var(--text-secondary); margin-bottom: 16px; font-size: 14px; line-height: 1.4;'>
                    <?= htmlspecialchars($category['description']) ?>
                </p>

                <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: var(--border-radius);'>
                    <div style='text-align: center;'>
                        <div style='font-size: 24px; font-weight: 700; color: var(--primary-color);'>
                            <?= $categoryStats[$category['id']] ?? 0 ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>—Ç–æ–≤–∞—Ä–æ–≤</div>
                    </div>
                    <div style='text-align: center;'>
                        <div style='font-size: 16px; font-weight: 600; color: var(--success-color);'>
                            <?= array_sum(array_column(array_filter($products, fn($p) => $p['category_id'] == $category['id']), 'views')) ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                    </div>
                    <div style='text-align: center;'>
                        <div style='font-size: 16px; font-weight: 600; color: var(--warning-color);'>
                            <?= array_sum(array_column(array_filter($products, fn($p) => $p['category_id'] == $category['id']), 'sales')) ?>
                        </div>
                        <div style='font-size: 12px; color: var(--text-muted);'>–ø—Ä–æ–¥–∞–∂</div>
                    </div>
                </div>

                <div style='display: flex; gap: 8px;' onclick='event.stopPropagation()'>
                    <button class='btn btn-primary btn-sm' style='flex: 1;' onclick='editCategory(<?= $category['id'] ?>)'>
                        <i class='fas fa-edit'></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class='btn btn-outline btn-sm' onclick='viewCategoryProducts(<?= $category['id'] ?>)' title='–¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'>
                        <i class='fas fa-eye'></i>
                    </button>
                    <button class='btn btn-warning btn-sm' onclick='toggleCategory(<?= $category['id'] ?>)' title='–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å'>
                        <i class='fas fa-power-off'></i>
                    </button>
                    <?php if (($categoryStats[$category['id']] ?? 0) == 0): ?>
                        <button class='btn btn-danger btn-sm' onclick='deleteCategory(<?= $category['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                            <i class='fas fa-trash'></i>
                        </button>
                    <?php endif; ?>
                </div>
            </div>
        <?php endforeach; ?>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='addCategoryModal'>
        <div class='modal-dialog'>
            <form class='ajax-form' method='POST'>
                <input type='hidden' name='action' value='add_category'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addCategoryModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <div class='form-group'>
                        <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                        <input type='text' name='name' class='form-input' required 
                               placeholder='–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'>
                    </div>

                    <div class='form-row'>
                        <div class='form-group'>
                            <label class='form-label'>–ò–∫–æ–Ω–∫–∞ (emoji)</label>
                            <input type='text' name='icon' class='form-input' placeholder='üê†' maxlength='4'
                                   style='text-align: center; font-size: 24px;'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                            <input type='number' name='sort_order' class='form-input' min='1' value='<?= count($categories) + 1 ?>'>
                        </div>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name='description' class='form-textarea' rows='3' 
                                  placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'></textarea>
                    </div>

                    <!-- SEO -->
                    <details style='margin: 20px 0;'>
                        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
                        <div class='form-group'>
                            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type='text' name='seo_title' class='form-input' 
                                   placeholder='–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name='seo_description' class='form-textarea' rows='2' 
                                      placeholder='–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º'></textarea>
                        </div>
                    </details>

                    <div class='form-group'>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='active' checked> 
                            <span>–ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                        </label>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class='modal' id='editCategoryModal'>
        <div class='modal-dialog'>
            <form class='ajax-form' method='POST' id='editCategoryForm'>
                <input type='hidden' name='action' value='edit_category'>
                <input type='hidden' name='category_id' id='editCategoryId'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                    <button type='button' class='modal-close' onclick='closeModal("editCategoryModal")'>&times;</button>
                </div>
                <div class='modal-body' id='editCategoryContent'>
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("editCategoryModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        async function editCategory(id) {
            showLoading();

            try {
                const response = await fetch(`admin.php?action=get_category&id=${id}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('editCategoryId').value = id;
                    document.getElementById('editCategoryContent').innerHTML = data.html;
                    openModal('editCategoryModal');
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        function viewCategoryProducts(id) {
            location.href = `admin.php?section=products&category=${id}`;
        }

        async function toggleCategory(id) {
            const formData = new FormData();
            formData.append('action', 'toggle_category_status');
            formData.append('category_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–°—Ç–∞—Ç—É—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        async function deleteCategory(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            const formData = new FormData();
            formData.append('action', 'delete_category');
            formData.append('category_id', id);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }
    </script>
    <?php
}
?>

<!-- === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê–ú–ò === -->
<?php
function renderOrdersSection($data) {
    $orders = $data['orders'];
    $products = $data['products'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–ó–∞–∫–∞–∑—ã (<?= count($orders) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
        </div>
        <div style='display: flex; gap: 12px;'>
            <button class='btn btn-outline' onclick='exportOrders()'>
                <i class='fas fa-download'></i>
                –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤
            </button>
            <button class='btn btn-primary' onclick='refreshOrders()'>
                <i class='fas fa-sync'></i>
                –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤ -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;'>
        <?php
        $statusCounts = array_count_values(array_column($orders, 'status'));
        $totalAmount = array_sum(array_column($orders, 'total_amount'));
        $todayOrders = count(array_filter($orders, fn($o) => date('Y-m-d', strtotime($o['created_at'])) === date('Y-m-d')));
        ?>
        <div class='stat-card'>
            <div class='stat-value'><?= count($orders) ?></div>
            <div class='stat-label'>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= $todayOrders ?></div>
            <div class='stat-label'>–°–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= number_format($totalAmount, 0, '', ' ') ?> ‚ÇΩ</div>
            <div class='stat-label'>–û–±—â–∞—è —Å—É–º–º–∞</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= $statusCounts['new'] ?? 0 ?></div>
            <div class='stat-label'>–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</div>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class='filters-bar'>
        <div class='filters-content'>
            <div class='search-box'>
                <input type='text' id='orderSearch' class='search-input' placeholder='–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –∫–ª–∏–µ–Ω—Ç—É, email...'>
                <button class='search-btn' type='button'>
                    <i class='fas fa-search'></i>
                </button>
            </div>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStatus(this.value)'>
                <option value=''>–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                <option value='new'>–ù–æ–≤—ã–µ</option>
                <option value='processing'>–û–±—Ä–∞–±–æ—Ç–∫–∞</option>
                <option value='shipped'>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
                <option value='delivered'>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                <option value='cancelled'>–û—Ç–º–µ–Ω–µ–Ω</option>
            </select>
            <input type='date' class='form-input' style='max-width: 150px;' onchange='filterByDate(this.value)'>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ -->
    <div class='table-container'>
        <table class='table' id='ordersTable'>
            <thead>
                <tr>
                    <th>‚Ññ –ó–∞–∫–∞–∑–∞</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–û–ø–ª–∞—Ç–∞</th>
                    <th>–î–æ—Å—Ç–∞–≤–∫–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($orders as $order): ?>
                <tr class='order-row' data-status='<?= $order['status'] ?>' data-date='<?= date('Y-m-d', strtotime($order['created_at'])) ?>'>
                    <td>
                        <div style='font-weight: 600; color: var(--primary-color);'><?= $order['order_number'] ?></div>
                        <div style='font-size: 12px; color: var(--text-muted);'>ID: <?= $order['id'] ?></div>
                    </td>
                    <td>
                        <div style='font-weight: 600;'><?= htmlspecialchars($order['customer_name']) ?></div>
                        <div style='font-size: 12px; color: var(--text-muted);'><?= htmlspecialchars($order['customer_email']) ?></div>
                        <div style='font-size: 12px; color: var(--text-muted);'><?= htmlspecialchars($order['customer_phone']) ?></div>
                    </td>
                    <td>
                        <div><?= date('d.m.Y', strtotime($order['created_at'])) ?></div>
                        <div style='font-size: 12px; color: var(--text-muted);'><?= date('H:i', strtotime($order['created_at'])) ?></div>
                    </td>
                    <td>
                        <div style='font-weight: 600; color: var(--success-color);'><?= number_format($order['total_amount'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <div style='font-size: 12px; color: var(--text-muted);'><?= $order['items_count'] ?> —Ç–æ–≤–∞—Ä–æ–≤</div>
                    </td>
                    <td>
                        <select class='form-select status-select' style='padding: 4px 8px; font-size: 12px;' 
                                onchange='updateOrderStatus(<?= $order['id'] ?>, this.value)'>
                            <option value='new' <?= $order['status'] === 'new' ? 'selected' : '' ?>>–ù–æ–≤—ã–π</option>
                            <option value='processing' <?= $order['status'] === 'processing' ? 'selected' : '' ?>>–û–±—Ä–∞–±–æ—Ç–∫–∞</option>
                            <option value='shipped' <?= $order['status'] === 'shipped' ? 'selected' : '' ?>>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
                            <option value='delivered' <?= $order['status'] === 'delivered' ? 'selected' : '' ?>>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                            <option value='cancelled' <?= $order['status'] === 'cancelled' ? 'selected' : '' ?>>–û—Ç–º–µ–Ω–µ–Ω</option>
                        </select>
                    </td>
                    <td>
                        <span class='status-badge status-<?= $order['payment_method'] === 'card' ? 'completed' : 'processing' ?>'>
                            <?= $order['payment_method'] === 'card' ? '–ö–∞—Ä—Ç–∞' : '–ù–∞–ª–∏—á–Ω—ã–µ' ?>
                        </span>
                    </td>
                    <td>
                        <span class='status-badge status-info'>
                            <?= $order['delivery_method'] === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑' ?>
                        </span>
                    </td>
                    <td>
                        <div style='display: flex; gap: 4px;'>
                            <button class='btn btn-primary btn-sm' onclick='viewOrder(<?= $order['id'] ?>)' title='–ü—Ä–æ—Å–º–æ—Ç—Ä'>
                                <i class='fas fa-eye'></i>
                            </button>
                            <button class='btn btn-outline btn-sm' onclick='printOrder(<?= $order['id'] ?>)' title='–ü–µ—á–∞—Ç—å'>
                                <i class='fas fa-print'></i>
                            </button>
                            <?php if ($order['status'] === 'new'): ?>
                            <button class='btn btn-danger btn-sm' onclick='cancelOrder(<?= $order['id'] ?>)' title='–û—Ç–º–µ–Ω–∏—Ç—å'>
                                <i class='fas fa-times'></i>
                            </button>
                            <?php endif; ?>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–∫–∞–∑–∞ -->
    <div class='modal' id='viewOrderModal'>
        <div class='modal-dialog' style='max-width: 800px;'>
            <div class='modal-header'>
                <h3 class='modal-title'>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
                <button type='button' class='modal-close' onclick='closeModal("viewOrderModal")'>&times;</button>
            </div>
            <div class='modal-body' id='orderDetails'>
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-outline' onclick='closeModal("viewOrderModal")'>–ó–∞–∫—Ä—ã—Ç—å</button>
                <button type='button' class='btn btn-primary' onclick='printOrderFromModal()'>
                    <i class='fas fa-print'></i> –ü–µ—á–∞—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initSearch('orderSearch', (query) => {
                filterTable('ordersTable', query, [0, 1, 2]); // –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –∫–ª–∏–µ–Ω—Ç—É, –¥–∞—Ç–µ
            });
        });

        function filterByStatus(status) {
            const rows = document.querySelectorAll('.order-row');
            rows.forEach(row => {
                if (!status || row.dataset.status === status) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterByDate(date) {
            const rows = document.querySelectorAll('.order-row');
            rows.forEach(row => {
                if (!date || row.dataset.date === date) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        async function updateOrderStatus(orderId, newStatus) {
            const formData = new FormData();
            formData.append('action', 'update_order_status');
            formData.append('order_id', orderId);
            formData.append('status', newStatus);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        async function viewOrder(orderId) {
            showLoading();
            try {
                const response = await fetch(`admin.php?action=get_order&id=${orderId}&ajax=1`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('orderDetails').innerHTML = data.html;
                    openModal('viewOrderModal');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                hideLoading();
            }
        }

        function printOrder(orderId) {
            window.open(`admin.php?action=print_order&id=${orderId}`, '_blank');
        }

        function printOrderFromModal() {
            window.print();
        }

        function exportOrders() {
            const link = document.createElement('a');
            link.href = 'admin.php?action=export_orders';
            link.download = 'orders_export.csv';
            link.click();
            showNotification('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤ –Ω–∞—á–∞—Ç', 'info');
        }

        function refreshOrders() {
            location.reload();
        }

        async function cancelOrder(orderId) {
            if (!confirm('–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?')) return;
            await updateOrderStatus(orderId, 'cancelled');
        }
    </script>
    <?php
}

// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–¢–ó–´–í–ê–ú–ò ===
function renderReviewsSection($data) {
    $reviews = $data['reviews'];
    $products = $data['products'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–û—Ç–∑—ã–≤—ã (<?= count($reviews) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;'>
        <?php
        $approvedCount = count(array_filter($reviews, fn($r) => $r['is_approved']));
        $pendingCount = count($reviews) - $approvedCount;
        $averageRating = $reviews ? array_sum(array_column($reviews, 'rating')) / count($reviews) : 0;
        ?>
        <div class='stat-card'>
            <div class='stat-value'><?= count($reviews) ?></div>
            <div class='stat-label'>–í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= $approvedCount ?></div>
            <div class='stat-label'>–û–¥–æ–±—Ä–µ–Ω–æ</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= $pendingCount ?></div>
            <div class='stat-label'>–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= number_format($averageRating, 1) ?></div>
            <div class='stat-label'>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class='filters-bar'>
        <div class='filters-content'>
            <div class='search-box'>
                <input type='text' id='reviewSearch' class='search-input' placeholder='–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –æ—Ç–∑—ã–≤–∞, –∫–ª–∏–µ–Ω—Ç—É...'>
                <button class='search-btn' type='button'>
                    <i class='fas fa-search'></i>
                </button>
            </div>
            <select class='form-select' style='max-width: 150px;' onchange='filterByApproval(this.value)'>
                <option value=''>–í—Å–µ –æ—Ç–∑—ã–≤—ã</option>
                <option value='approved'>–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</option>
                <option value='pending'>–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</option>
            </select>
            <select class='form-select' style='max-width: 120px;' onchange='filterByRating(this.value)'>
                <option value=''>–í—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏</option>
                <option value='5'>5 –∑–≤–µ–∑–¥</option>
                <option value='4'>4 –∑–≤–µ–∑–¥—ã</option>
                <option value='3'>3 –∑–≤–µ–∑–¥—ã</option>
                <option value='2'>2 –∑–≤–µ–∑–¥—ã</option>
                <option value='1'>1 –∑–≤–µ–∑–¥–∞</option>
            </select>
        </div>
    </div>

    <!-- –°–µ—Ç–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ -->
    <div style='display: grid; gap: 20px;' id='reviewsGrid'>
        <?php foreach ($reviews as $review): ?>
        <div class='stat-card review-card' data-approved='<?= $review['is_approved'] ? 'approved' : 'pending' ?>' 
             data-rating='<?= $review['rating'] ?>'>
            <div style='display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;'>
                <div style='flex: 1;'>
                    <div style='display: flex; align-items: center; gap: 12px; margin-bottom: 8px;'>
                        <div style='font-weight: 600;'><?= htmlspecialchars($review['customer_name']) ?></div>
                        <div style='color: gold;'>
                            <?= str_repeat('‚òÖ', $review['rating']) . str_repeat('‚òÜ', 5 - $review['rating']) ?>
                        </div>
                        <span class='status-badge <?= $review['is_approved'] ? 'status-completed' : 'status-processing' ?>'>
                            <?= $review['is_approved'] ? '–û–¥–æ–±—Ä–µ–Ω' : '–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏' ?>
                        </span>
                    </div>
                    <div style='font-size: 12px; color: var(--text-muted); margin-bottom: 8px;'>
                        –¢–æ–≤–∞—Ä: <?= htmlspecialchars($review['product_name']) ?>
                    </div>
                    <div style='font-size: 12px; color: var(--text-muted);'>
                        <?= date('d.m.Y H:i', strtotime($review['created_at'])) ?>
                    </div>
                </div>
                <div style='display: flex; gap: 8px;'>
                    <?php if (!$review['is_approved']): ?>
                    <button class='btn btn-success btn-sm' onclick='approveReview(<?= $review['id'] ?>)' title='–û–¥–æ–±—Ä–∏—Ç—å'>
                        <i class='fas fa-check'></i>
                    </button>
                    <?php endif; ?>
                    <button class='btn btn-danger btn-sm' onclick='deleteReview(<?= $review['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                        <i class='fas fa-trash'></i>
                    </button>
                </div>
            </div>

            <?php if ($review['title']): ?>
            <h4 style='margin: 0 0 8px 0; font-size: 16px;'><?= htmlspecialchars($review['title']) ?></h4>
            <?php endif; ?>

            <p style='margin: 0; line-height: 1.5; color: var(--text-secondary);'>
                <?= nl2br(htmlspecialchars($review['text'])) ?>
            </p>
        </div>
        <?php endforeach; ?>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initSearch('reviewSearch', (query) => {
                const cards = document.querySelectorAll('.review-card');
                cards.forEach(card => {
                    const text = card.textContent.toLowerCase();
                    card.style.display = text.includes(query.toLowerCase()) ? '' : 'none';
                });
            });
        });

        function filterByApproval(status) {
            const cards = document.querySelectorAll('.review-card');
            cards.forEach(card => {
                if (!status || card.dataset.approved === status) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function filterByRating(rating) {
            const cards = document.querySelectorAll('.review-card');
            cards.forEach(card => {
                if (!rating || card.dataset.rating === rating) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function approveReview(reviewId) {
            const formData = new FormData();
            formData.append('action', 'approve_review');
            formData.append('review_id', reviewId);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    showNotification('–û—Ç–∑—ã–≤ –æ–¥–æ–±—Ä–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }

        async function deleteReview(reviewId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤?')) return;

            const formData = new FormData();
            formData.append('action', 'delete_review');
            formData.append('review_id', reviewId);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    showNotification('–û—Ç–∑—ã–≤ —É–¥–∞–ª–µ–Ω', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            }
        }
    </script>
    <?php
}

// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–°–¢–Ø–ú–ò ===
function renderNewsSection($data) {
    $news = $data['news'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–ù–æ–≤–æ—Å—Ç–∏ (<?= count($news) ?>)</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏ –∏ —Å—Ç–∞—Ç—å—è–º–∏</p>
        </div>
        <button class='btn btn-success' onclick='openModal("addNewsModal")'>
            <i class='fas fa-plus'></i>
            –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å
        </button>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;'>
        <?php
        $publishedCount = count(array_filter($news, fn($n) => $n['is_published']));
        $draftCount = count($news) - $publishedCount;
        $totalViews = array_sum(array_column($news, 'views'));
        ?>
        <div class='stat-card'>
            <div class='stat-value'><?= count($news) ?></div>
            <div class='stat-label'>–í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= $publishedCount ?></div>
            <div class='stat-label'>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= $draftCount ?></div>
            <div class='stat-label'>–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</div>
        </div>
        <div class='stat-card'>
            <div class='stat-value'><?= $totalViews ?></div>
            <div class='stat-label'>–í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class='filters-bar'>
        <div class='filters-content'>
            <div class='search-box'>
                <input type='text' id='newsSearch' class='search-input' placeholder='–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π...'>
                <button class='search-btn' type='button'>
                    <i class='fas fa-search'></i>
                </button>
            </div>
            <select class='form-select' style='max-width: 150px;' onchange='filterByStatus(this.value)'>
                <option value=''>–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</option>
                <option value='published'>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ</option>
                <option value='draft'>–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</option>
                <option value='featured'>–í–∞–∂–Ω—ã–µ</option>
            </select>
        </div>
    </div>

    <!-- –°–µ—Ç–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
    <div style='display: grid; gap: 20px;' id='newsGrid'>
        <?php foreach ($news as $item): ?>
        <div class='stat-card news-card' data-status='<?= $item['is_published'] ? 'published' : 'draft' ?>'>
            <div style='display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;'>
                <div style='flex: 1;'>
                    <div style='display: flex; align-items: center; gap: 12px; margin-bottom: 8px;'>
                        <h3 style='margin: 0; font-size: 18px; cursor: pointer;' onclick='editNews(<?= $item['id'] ?>)'>
                            <?= htmlspecialchars($item['title']) ?>
                        </h3>
                        <span class='status-badge <?= $item['is_published'] ? 'status-completed' : 'status-processing' ?>'>
                            <?= $item['is_published'] ? '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞' : '–ß–µ—Ä–Ω–æ–≤–∏–∫' ?>
                        </span>
                        <?php if ($item['is_featured']): ?>
                        <span class='status-badge' style='background: gold; color: white;'>–í–∞–∂–Ω–∞—è</span>
                        <?php endif; ?>
                    </div>
                    <div style='font-size: 12px; color: var(--text-muted); margin-bottom: 8px;'>
                        <?= date('d.m.Y H:i', strtotime($item['created_at'])) ?> | –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: <?= $item['views'] ?>
                    </div>
                </div>
                <div style='display: flex; gap: 8px;'>
                    <button class='btn btn-primary btn-sm' onclick='editNews(<?= $item['id'] ?>)' title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'>
                        <i class='fas fa-edit'></i>
                    </button>
                    <button class='btn btn-outline btn-sm' onclick='viewNews(<?= $item['id'] ?>)' title='–ü—Ä–æ—Å–º–æ—Ç—Ä'>
                        <i class='fas fa-eye'></i>
                    </button>
                    <button class='btn btn-warning btn-sm' onclick='toggleNews(<?= $item['id'] ?>)' title='–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å'>
                        <i class='fas fa-power-off'></i>
                    </button>
                    <button class='btn btn-danger btn-sm' onclick='deleteNews(<?= $item['id'] ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                        <i class='fas fa-trash'></i>
                    </button>
                </div>
            </div>

            <p style='margin: 0 0 12px 0; color: var(--text-secondary); line-height: 1.5;'>
                <?= htmlspecialchars($item['excerpt']) ?>
            </p>
        </div>
        <?php endforeach; ?>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏ -->
    <div class='modal' id='addNewsModal'>
        <div class='modal-dialog' style='max-width: 800px;'>
            <form class='ajax-form' method='POST'>
                <input type='hidden' name='action' value='add_news'>
                <div class='modal-header'>
                    <h3 class='modal-title'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h3>
                    <button type='button' class='modal-close' onclick='closeModal("addNewsModal")'>&times;</button>
                </div>
                <div class='modal-body'>
                    <div class='form-group'>
                        <label class='form-label'>–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
                        <input type='text' name='title' class='form-input' required>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ *</label>
                        <textarea name='excerpt' class='form-textarea' rows='2' required></textarea>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç *</label>
                        <textarea name='content' class='form-textarea' rows='8' required></textarea>
                    </div>

                    <div class='form-group'>
                        <label class='form-label'>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (URL)</label>
                        <input type='url' name='image' class='form-input' placeholder='https://example.com/image.jpg'>
                    </div>

                    <!-- SEO -->
                    <details style='margin: 20px 0;'>
                        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
                        <div class='form-group'>
                            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type='text' name='meta_title' class='form-input'>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea name='meta_description' class='form-textarea' rows='2'></textarea>
                        </div>
                    </details>

                    <div style='display: flex; gap: 20px; align-items: center;'>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_published' checked>
                            <span>–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</span>
                        </label>
                        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                            <input type='checkbox' name='is_featured'>
                            <span>–í–∞–∂–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å</span>
                        </label>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-outline' onclick='closeModal("addNewsModal")'>–û—Ç–º–µ–Ω–∞</button>
                    <button type='submit' class='btn btn-success'>
                        <i class='fas fa-save'></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initSearch('newsSearch', (query) => {
                const cards = document.querySelectorAll('.news-card');
                cards.forEach(card => {
                    const text = card.textContent.toLowerCase();
                    card.style.display = text.includes(query.toLowerCase()) ? '' : 'none';
                });
            });
        });

        function filterByStatus(status) {
            const cards = document.querySelectorAll('.news-card');
            cards.forEach(card => {
                if (!status || card.dataset.status === status) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function editNews(id) {
            // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ editProduct
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function viewNews(id) {
            window.open(`index.php?page=news&id=${id}`, '_blank');
        }

        async function toggleNews(id) {
            // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ toggleCategory
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        async function deleteNews(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å?')) return;
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
    </script>
    <?php
}

// === –ù–ê–°–¢–†–û–ô–ö–ò –°–ê–ô–¢–ê ===
function renderSettingsSection($data) {
    $settings = $data['settings'];
    ?>
    <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;'>
        <div>
            <h2 style='margin: 0; color: var(--text-primary);'>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞</h2>
            <p style='margin: 5px 0 0; color: var(--text-secondary);'>–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞</p>
        </div>
    </div>

    <form class='ajax-form' method='POST' style='max-width: 800px;'>
        <input type='hidden' name='action' value='update_settings'>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class='stat-card' style='margin-bottom: 30px;'>
            <h3 style='margin: 0 0 20px 0;'>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

            <div class='form-row'>
                <div class='form-group'>
                    <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞</label>
                    <input type='text' name='site_name' class='form-input' 
                           value='<?= htmlspecialchars($settings['site_name']) ?>'>
                </div>
                <div class='form-group'>
                    <label class='form-label'>–í–∞–ª—é—Ç–∞</label>
                    <input type='text' name='currency' class='form-input' 
                           value='<?= htmlspecialchars($settings['currency']) ?>'>
                </div>
            </div>

            <div class='form-group'>
                <label class='form-label'>–û–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞</label>
                <textarea name='site_description' class='form-textarea' rows='2'><?= htmlspecialchars($settings['site_description']) ?></textarea>
            </div>

            <div class='form-group'>
                <label class='form-label'>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
                <input type='text' name='site_keywords' class='form-input' 
                       value='<?= htmlspecialchars($settings['site_keywords']) ?>'>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
        <div class='stat-card' style='margin-bottom: 30px;'>
            <h3 style='margin: 0 0 20px 0;'>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

            <div class='form-row'>
                <div class='form-group'>
                    <label class='form-label'>Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                    <input type='email' name='admin_email' class='form-input' 
                           value='<?= htmlspecialchars($settings['admin_email']) ?>'>
                </div>
                <div class='form-group'>
                    <label class='form-label'>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type='text' name='phone' class='form-input' 
                           value='<?= htmlspecialchars($settings['phone']) ?>'>
                </div>
            </div>

            <div class='form-group'>
                <label class='form-label'>–ê–¥—Ä–µ—Å</label>
                <input type='text' name='address' class='form-input' 
                       value='<?= htmlspecialchars($settings['address']) ?>'>
            </div>

            <div class='form-group'>
                <label class='form-label'>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã</label>
                <input type='text' name='working_hours' class='form-input' 
                       value='<?= htmlspecialchars($settings['working_hours']) ?>'>
            </div>
        </div>

        <!-- –ú–∞–≥–∞–∑–∏–Ω -->
        <div class='stat-card' style='margin-bottom: 30px;'>
            <h3 style='margin: 0 0 20px 0;'>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞</h3>

            <div class='form-row-3'>
                <div class='form-group'>
                    <label class='form-label'>–¢–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É</label>
                    <input type='number' name='products_per_page' class='form-input' min='1' max='100'
                           value='<?= $settings['products_per_page'] ?>'>
                </div>
                <div class='form-group'>
                    <label class='form-label'>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (‚ÇΩ)</label>
                    <input type='number' name='min_order_amount' class='form-input' min='0'
                           value='<?= $settings['min_order_amount'] ?>'>
                </div>
                <div class='form-group'>
                    <label class='form-label'>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –æ—Ç (‚ÇΩ)</label>
                    <input type='number' name='free_shipping_from' class='form-input' min='0'
                           value='<?= $settings['free_shipping_from'] ?>'>
                </div>
            </div>
        </div>

        <!-- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ -->
        <div class='stat-card' style='margin-bottom: 30px;'>
            <h3 style='margin: 0 0 20px 0;'>–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</h3>

            <div class='form-row'>
                <div class='form-group'>
                    <label class='form-label'>–í–ö–æ–Ω—Ç–∞–∫—Ç–µ</label>
                    <input type='url' name='social_vk' class='form-input' 
                           value='<?= htmlspecialchars($settings['social_vk']) ?>' placeholder='https://vk.com/...'>
                </div>
                <div class='form-group'>
                    <label class='form-label'>Telegram</label>
                    <input type='url' name='social_telegram' class='form-input' 
                           value='<?= htmlspecialchars($settings['social_telegram']) ?>' placeholder='https://t.me/...'>
                </div>
            </div>

            <div class='form-row'>
                <div class='form-group'>
                    <label class='form-label'>Instagram</label>
                    <input type='url' name='social_instagram' class='form-input' 
                           value='<?= htmlspecialchars($settings['social_instagram']) ?>' placeholder='https://instagram.com/...'>
                </div>
                <div class='form-group'>
                    <label class='form-label'>YouTube</label>
                    <input type='url' name='social_youtube' class='form-input' 
                           value='<?= htmlspecialchars($settings['social_youtube']) ?>' placeholder='https://youtube.com/...'>
                </div>
            </div>
        </div>

        <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
        <div class='stat-card' style='margin-bottom: 30px;'>
            <h3 style='margin: 0 0 20px 0;'>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ SEO</h3>

            <div class='form-row'>
                <div class='form-group'>
                    <label class='form-label'>Google Analytics ID</label>
                    <input type='text' name='google_analytics' class='form-input' 
                           value='<?= htmlspecialchars($settings['google_analytics']) ?>' placeholder='GA-XXXXXXXXX-X'>
                </div>
                <div class='form-group'>
                    <label class='form-label'>–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ ID</label>
                    <input type='text' name='yandex_metrika' class='form-input' 
                           value='<?= htmlspecialchars($settings['yandex_metrika']) ?>' placeholder='12345678'>
                </div>
            </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
        <div class='stat-card' style='margin-bottom: 30px;'>
            <h3 style='margin: 0 0 20px 0;'>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

            <div class='form-group'>
                <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
                    <input type='checkbox' name='maintenance_mode' <?= $settings['maintenance_mode'] ? 'checked' : '' ?>>
                    <span>–†–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (—Å–∞–π—Ç –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π)</span>
                </label>
            </div>
        </div>

        <div style='text-align: center;'>
            <button type='submit' class='btn btn-success btn-lg'>
                <i class='fas fa-save'></i>
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </div>
    </form>
    <?php
}

// === –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø (DASHBOARD) ===
function renderDashboardSection($data) {
    $products = $data['products'];
    $orders = $data['orders'];
    $reviews = $data['reviews'];
    ?>
    <div style='margin-bottom: 24px;'>
        <h2 style='margin: 0; color: var(--text-primary);'>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
        <p style='margin: 5px 0 0; color: var(--text-secondary);'>–û–±–∑–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞</p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;'>
        <?php
        $totalOrders = count($orders);
        $totalRevenue = array_sum(array_column($orders, 'total_amount'));
        $totalProducts = count($products);
        $totalReviews = count($reviews);
        $todayOrders = count(array_filter($orders, fn($o) => date('Y-m-d', strtotime($o['created_at'])) === date('Y-m-d')));
        ?>
        <div class='stat-card'>
            <div class='stat-icon' style='color: var(--primary-color);'><i class='fas fa-shopping-cart'></i></div>
            <div class='stat-content'>
                <div class='stat-value'><?= $totalOrders ?></div>
                <div class='stat-label'>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                <div class='stat-change'>+<?= $todayOrders ?> —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
        </div>

        <div class='stat-card'>
            <div class='stat-icon' style='color: var(--success-color);'><i class='fas fa-ruble-sign'></i></div>
            <div class='stat-content'>
                <div class='stat-value'><?= number_format($totalRevenue, 0, '', ' ') ?> ‚ÇΩ</div>
                <div class='stat-label'>–û–±—â–∏–π –¥–æ—Ö–æ–¥</div>
                <div class='stat-change'>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: <?= $totalOrders ? number_format($totalRevenue / $totalOrders, 0, '', ' ') : 0 ?> ‚ÇΩ</div>
            </div>
        </div>

        <div class='stat-card'>
            <div class='stat-icon' style='color: var(--info-color);'><i class='fas fa-box'></i></div>
            <div class='stat-content'>
                <div class='stat-value'><?= $totalProducts ?></div>
                <div class='stat-label'>–¢–æ–≤–∞—Ä–æ–≤</div>
                <div class='stat-change'><?= count(array_filter($products, fn($p) => $p['is_active'])) ?> –∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
        </div>

        <div class='stat-card'>
            <div class='stat-icon' style='color: var(--warning-color);'><i class='fas fa-star'></i></div>
            <div class='stat-content'>
                <div class='stat-value'><?= $totalReviews ?></div>
                <div class='stat-label'>–û—Ç–∑—ã–≤–æ–≤</div>
                <div class='stat-change'><?= count(array_filter($reviews, fn($r) => !$r['is_approved'])) ?> –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
            </div>
        </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã (–∑–∞–≥–ª—É—à–∫–∏) -->
    <div style='display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px;'>
        <div class='stat-card'>
            <h3 style='margin: 0 0 20px 0;'>–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</h3>
            <div style='height: 300px; background: var(--bg-secondary); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center; color: var(--text-muted);'>
                <div style='text-align: center;'>
                    <i class='fas fa-chart-line' style='font-size: 48px; margin-bottom: 16px;'></i>
                    <p>–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂</p>
                </div>
            </div>
        </div>

        <div class='stat-card'>
            <h3 style='margin: 0 0 20px 0;'>–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <div style='height: 300px; background: var(--bg-secondary); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center; color: var(--text-muted);'>
                <div style='text-align: center;'>
                    <i class='fas fa-chart-pie' style='font-size: 48px; margin-bottom: 16px;'></i>
                    <p>–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã -->
    <div class='stat-card' style='margin-bottom: 30px;'>
        <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;'>
            <h3 style='margin: 0;'>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
            <a href='?section=orders' class='btn btn-outline btn-sm'>–í—Å–µ –∑–∞–∫–∞–∑—ã</a>
        </div>

        <div class='table-container'>
            <table class='table'>
                <thead>
                    <tr>
                        <th>–ó–∞–∫–∞–∑</th>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach (array_slice($orders, -10) as $order): ?>
                    <tr>
                        <td><?= $order['order_number'] ?></td>
                        <td><?= htmlspecialchars($order['customer_name']) ?></td>
                        <td><?= date('d.m.Y H:i', strtotime($order['created_at'])) ?></td>
                        <td><?= number_format($order['total_amount'], 0, '', ' ') ?> ‚ÇΩ</td>
                        <td>
                            <span class='status-badge status-<?= $order['status'] === 'delivered' ? 'completed' : ($order['status'] === 'cancelled' ? 'cancelled' : 'processing') ?>'>
                                <?= $order['status_label'] ?>
                            </span>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>

    <!-- –¢–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º -->
    <div class='stat-card'>
        <div style='display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;'>
            <h3 style='margin: 0;'>–¢–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º</h3>
            <a href='?section=products' class='btn btn-outline btn-sm'>–í—Å–µ —Ç–æ–≤–∞—Ä—ã</a>
        </div>

        <div style='display: grid; gap: 12px;'>
            <?php 
            $lowStockProducts = array_filter($products, fn($p) => $p['stock'] <= 5);
            foreach (array_slice($lowStockProducts, 0, 5) as $product): 
            ?>
            <div style='display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--border-radius);'>
                <div>
                    <div style='font-weight: 600;'><?= htmlspecialchars(mb_substr($product['name'], 0, 40)) ?><?= mb_strlen($product['name']) > 40 ? '...' : '' ?></div>
                    <div style='font-size: 12px; color: var(--text-muted);'>–ê—Ä—Ç–∏–∫—É–ª: <?= $product['sku'] ?></div>
                </div>
                <span class='status-badge status-<?= $product['stock'] === 0 ? 'cancelled' : 'processing' ?>'>
                    <?= $product['stock'] ?> —à—Ç
                </span>
            </div>
            <?php endforeach; ?>
        </div>
    </div>
    <?php
}
// === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò AJAX –ó–ê–ü–†–û–°–û–í ===

// –û–±—Ä–∞–±–æ—Ç–∫–∞ AJAX –∑–∞–ø—Ä–æ—Å–æ–≤
if (isset($_POST['ajax']) || isset($_GET['ajax'])) {
    header('Content-Type: application/json');

    $action = $_POST['action'] ?? $_GET['action'] ?? '';

    try {
        switch ($action) {
            // === –¢–û–í–ê–†–´ ===
            case 'add_product':
                $result = createProduct($_POST, $_FILES);
                echo json_encode($result);
                break;

            case 'edit_product':
                $result = updateProduct($_POST['product_id'], $_POST, $_FILES);
                echo json_encode($result);
                break;

            case 'get_product':
                $product = getProductById($_GET['id']);
                if ($product) {
                    $categories = getCategories();
                    ob_start();
                    renderEditProductForm($product, $categories);
                    $html = ob_get_clean();
                    echo json_encode(['success' => true, 'html' => $html]);
                } else {
                    echo json_encode(['success' => false, 'message' => '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω']);
                }
                break;

            case 'delete_product':
                $result = deleteProduct($_POST['product_id']);
                echo json_encode($result);
                break;

            case 'duplicate_product':
                $result = duplicateProduct($_POST['product_id']);
                echo json_encode($result);
                break;

            case 'toggle_product_status':
                $result = toggleProductStatus($_POST['product_id'], $_POST['is_active']);
                echo json_encode($result);
                break;

            case 'bulk_products':
                $result = bulkProductAction($_POST['bulk_action'], json_decode($_POST['ids'], true), $_POST);
                echo json_encode($result);
                break;

            // === –ö–ê–¢–ï–ì–û–†–ò–ò ===
            case 'add_category':
                $result = createCategory($_POST);
                echo json_encode($result);
                break;

            case 'edit_category':
                $result = updateCategory($_POST['category_id'], $_POST);
                echo json_encode($result);
                break;

            case 'get_category':
                $category = getCategoryById($_GET['id']);
                if ($category) {
                    ob_start();
                    renderEditCategoryForm($category);
                    $html = ob_get_clean();
                    echo json_encode(['success' => true, 'html' => $html]);
                } else {
                    echo json_encode(['success' => false, 'message' => '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞']);
                }
                break;

            case 'delete_category':
                $result = deleteCategory($_POST['category_id']);
                echo json_encode($result);
                break;

            case 'toggle_category_status':
                $result = toggleCategoryStatus($_POST['category_id']);
                echo json_encode($result);
                break;

            // === –ó–ê–ö–ê–ó–´ ===
            case 'update_order_status':
                $result = updateOrderStatus($_POST['order_id'], $_POST['status']);
                echo json_encode($result);
                break;

            case 'get_order':
                $order = getOrderById($_GET['id']);
                if ($order) {
                    ob_start();
                    renderOrderDetails($order);
                    $html = ob_get_clean();
                    echo json_encode(['success' => true, 'html' => $html]);
                } else {
                    echo json_encode(['success' => false, 'message' => '–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω']);
                }
                break;

            // === –û–¢–ó–´–í–´ ===
            case 'approve_review':
                $result = approveReview($_POST['review_id']);
                echo json_encode($result);
                break;

            case 'delete_review':
                $result = deleteReview($_POST['review_id']);
                echo json_encode($result);
                break;

            // === –ù–û–í–û–°–¢–ò ===
            case 'add_news':
                $result = createNews($_POST);
                echo json_encode($result);
                break;

            // === –ù–ê–°–¢–†–û–ô–ö–ò ===
            case 'update_settings':
                $result = updateSiteSettings($_POST);
                echo json_encode($result);
                break;

            default:
                echo json_encode(['success' => false, 'message' => '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ']);
        }
    } catch (Exception $e) {
        echo json_encode(['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()]);
    }
    exit;
}

// === –°–õ–£–ñ–ï–ë–ù–´–ï –§–£–ù–ö–¶–ò–ò ===

function renderEditProductForm($product, $categories) {
    ?>
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class='form-row'>
        <div class='form-group'>
            <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
            <input type='text' name='name' class='form-input' required
                   value='<?= htmlspecialchars($product['name']) ?>'>
        </div>
        <div class='form-group'>
            <label class='form-label'>–ê—Ä—Ç–∏–∫—É–ª</label>
            <input type='text' name='sku' class='form-input'
                   value='<?= htmlspecialchars($product['sku']) ?>'>
        </div>
    </div>

    <div class='form-row'>
        <div class='form-group'>
            <label class='form-label'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
            <select name='category_id' class='form-select' required>
                <?php foreach ($categories as $category): ?>
                    <option value='<?= $category['id'] ?>' <?= $category['id'] == $product['category_id'] ? 'selected' : '' ?>>
                        <?= htmlspecialchars($category['name']) ?>
                    </option>
                <?php endforeach; ?>
            </select>
        </div>
        <div class='form-group'>
            <label class='form-label'>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
            <input type='number' name='stock' class='form-input' min='0' required 
                   value='<?= $product['stock'] ?>'>
        </div>
    </div>

    <!-- –¶–µ–Ω—ã -->
    <div class='form-row'>
        <div class='form-group'>
            <label class='form-label'>–¶–µ–Ω–∞ (‚ÇΩ) *</label>
            <input type='number' name='price' class='form-input' min='0' step='0.01' required
                   value='<?= $product['price'] ?>'>
        </div>
        <div class='form-group'>
            <label class='form-label'>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</label>
            <input type='number' name='old_price' class='form-input' min='0' step='0.01'
                   value='<?= $product['old_price'] ?>'>
        </div>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏—è -->
    <div class='form-group'>
        <label class='form-label'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea name='short_description' class='form-textarea' rows='2'><?= htmlspecialchars($product['short_description']) ?></textarea>
    </div>

    <div class='form-group'>
        <label class='form-label'>–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea name='description' class='form-textarea' rows='4'><?= htmlspecialchars($product['description']) ?></textarea>
    </div>

    <!-- –¢–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <?php if (!empty($product['images'])): ?>
    <div class='form-group'>
        <label class='form-label'>–¢–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
        <div style='display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px;'>
            <?php foreach ($product['images'] as $index => $image): ?>
            <div style='position: relative; width: 100px; height: 100px; border-radius: var(--border-radius); overflow: hidden; border: 2px solid var(--border-color);'>
                <img src='<?= htmlspecialchars($image) ?>' style='width: 100%; height: 100%; object-fit: cover;'>
                <button type='button' onclick='removeProductImage(<?= $product['id'] ?>, <?= $index ?>)' 
                        style='position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: var(--danger-color); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center;'>
                    √ó
                </button>
            </div>
            <?php endforeach; ?>
        </div>
    </div>
    <?php endif; ?>

    <!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <div class='form-group'>
        <label class='form-label'>–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
        <div class='file-upload-area' id='editProductImageUpload'>
            <i class='fas fa-cloud-upload-alt' style='font-size: 48px; color: var(--text-muted); margin-bottom: 16px;'></i>
            <p style='margin: 0 0 16px; color: var(--text-muted);'>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
            <button type='button' class='btn btn-outline'>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
            <input type='file' name='images[]' accept='image/*' multiple style='display: none;' id='editProductImageInput'>
        </div>
    </div>

    <!-- –†–∞–∑–º–µ—Ä—ã –∏ –≤–µ—Å -->
    <div class='form-row-3'>
        <div class='form-group'>
            <label class='form-label'>–î–ª–∏–Ω–∞ (—Å–º)</label>
            <input type='number' name='length' class='form-input' min='0' 
                   value='<?= $product['dimensions']['length'] ?>'>
        </div>
        <div class='form-group'>
            <label class='form-label'>–®–∏—Ä–∏–Ω–∞ (—Å–º)</label>
            <input type='number' name='width' class='form-input' min='0' 
                   value='<?= $product['dimensions']['width'] ?>'>
        </div>
        <div class='form-group'>
            <label class='form-label'>–í—ã—Å–æ—Ç–∞ (—Å–º)</label>
            <input type='number' name='height' class='form-input' min='0' 
                   value='<?= $product['dimensions']['height'] ?>'>
        </div>
    </div>

    <div class='form-group'>
        <label class='form-label'>–í–µ—Å (–≥)</label>
        <input type='number' name='weight' class='form-input' min='0' 
               value='<?= $product['weight'] ?>'>
    </div>

    <!-- SEO -->
    <details style='margin: 20px 0;'>
        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
        <div class='form-group'>
            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
            <input type='text' name='meta_title' class='form-input'
                   value='<?= htmlspecialchars($product['meta_title']) ?>'>
        </div>
        <div class='form-group'>
            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea name='meta_description' class='form-textarea' rows='2'><?= htmlspecialchars($product['meta_description']) ?></textarea>
        </div>
        <div class='form-group'>
            <label class='form-label'>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
            <input type='text' name='meta_keywords' class='form-input'
                   value='<?= htmlspecialchars($product['meta_keywords']) ?>'>
        </div>
    </details>

    <!-- –°—Ç–∞—Ç—É—Å—ã -->
    <div style='display: flex; gap: 20px; align-items: center; margin-top: 20px;'>
        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
            <input type='checkbox' name='is_featured' <?= $product['is_featured'] ? 'checked' : '' ?>>
            <span>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç–æ–≤–∞—Ä</span>
        </label>
        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
            <input type='checkbox' name='is_new' <?= $product['is_new'] ? 'checked' : '' ?>>
            <span>‚ú® –ù–æ–≤–∏–Ω–∫–∞</span>
        </label>
        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
            <input type='checkbox' name='is_active' <?= $product['is_active'] ? 'checked' : '' ?>>
            <span>üëÅÔ∏è –ê–∫—Ç–∏–≤–µ–Ω</span>
        </label>
    </div>
    <?php
}

function renderEditCategoryForm($category) {
    ?>
    <div class='form-group'>
        <label class='form-label'>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
        <input type='text' name='name' class='form-input' required
               value='<?= htmlspecialchars($category['name']) ?>'>
    </div>

    <div class='form-row'>
        <div class='form-group'>
            <label class='form-label'>–ò–∫–æ–Ω–∫–∞ (emoji)</label>
            <input type='text' name='icon' class='form-input' maxlength='4'
                   style='text-align: center; font-size: 24px;'
                   value='<?= htmlspecialchars($category['icon']) ?>'>
        </div>
        <div class='form-group'>
            <label class='form-label'>–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
            <input type='number' name='sort_order' class='form-input' min='1' 
                   value='<?= $category['sort_order'] ?>'>
        </div>
    </div>

    <div class='form-group'>
        <label class='form-label'>–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea name='description' class='form-textarea' rows='3'><?= htmlspecialchars($category['description']) ?></textarea>
    </div>

    <!-- SEO -->
    <details style='margin: 20px 0;'>
        <summary style='cursor: pointer; font-weight: 600; margin-bottom: 16px;'>SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
        <div class='form-group'>
            <label class='form-label'>SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
            <input type='text' name='seo_title' class='form-input'
                   value='<?= htmlspecialchars($category['seo_title']) ?>'>
        </div>
        <div class='form-group'>
            <label class='form-label'>SEO –æ–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea name='seo_description' class='form-textarea' rows='2'><?= htmlspecialchars($category['seo_description']) ?></textarea>
        </div>
    </details>

    <div class='form-group'>
        <label style='display: flex; align-items: center; gap: 8px; cursor: pointer;'>
            <input type='checkbox' name='active' <?= $category['active'] ? 'checked' : '' ?>>
            <span>–ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</span>
        </label>
    </div>
    <?php
}

function renderOrderDetails($order) {
    ?>
    <div style='display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;'>
        <div>
            <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h4>
            <div style='background: var(--bg-secondary); padding: 16px; border-radius: var(--border-radius);'>
                <div style='margin-bottom: 8px;'><strong>–ù–æ–º–µ—Ä:</strong> <?= $order['order_number'] ?></div>
                <div style='margin-bottom: 8px;'><strong>–î–∞—Ç–∞:</strong> <?= date('d.m.Y H:i', strtotime($order['created_at'])) ?></div>
                <div style='margin-bottom: 8px;'><strong>–°—Ç–∞—Ç—É—Å:</strong> <?= $order['status_label'] ?></div>
                <div style='margin-bottom: 8px;'><strong>–°—É–º–º–∞:</strong> <?= number_format($order['total_amount'], 0, '', ' ') ?> ‚ÇΩ</div>
                <div><strong>–¢–æ–≤–∞—Ä–æ–≤:</strong> <?= $order['items_count'] ?></div>
            </div>
        </div>

        <div>
            <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h4>
            <div style='background: var(--bg-secondary); padding: 16px; border-radius: var(--border-radius);'>
                <div style='margin-bottom: 8px;'><strong>–ò–º—è:</strong> <?= htmlspecialchars($order['customer_name']) ?></div>
                <div style='margin-bottom: 8px;'><strong>Email:</strong> <?= htmlspecialchars($order['customer_email']) ?></div>
                <div style='margin-bottom: 8px;'><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <?= htmlspecialchars($order['customer_phone']) ?></div>
                <div style='margin-bottom: 8px;'><strong>–û–ø–ª–∞—Ç–∞:</strong> <?= $order['payment_method'] === 'card' ? '–ö–∞—Ä—Ç–æ–π' : '–ù–∞–ª–∏—á–Ω—ã–º–∏' ?></div>
                <div><strong>–î–æ—Å—Ç–∞–≤–∫–∞:</strong> <?= $order['delivery_method'] === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑' ?></div>
            </div>
        </div>
    </div>

    <div>
        <h4>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h4>
        <div style='background: var(--bg-secondary); padding: 16px; border-radius: var(--border-radius); margin-bottom: 20px;'>
            <?= htmlspecialchars($order['delivery_address']) ?>
        </div>
    </div>

    <?php if ($order['notes']): ?>
    <div>
        <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</h4>
        <div style='background: var(--bg-secondary); padding: 16px; border-radius: var(--border-radius);'>
            <?= nl2br(htmlspecialchars($order['notes'])) ?>
        </div>
    </div>
    <?php endif; ?>
    <?php
}

// === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===

function duplicateProduct($productId) {
    try {
        $product = getProductById($productId);
        if (!$product) {
            return ['success' => false, 'message' => '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω'];
        }

        // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —Ç–æ–≤–∞—Ä–∞
        $newProductData = $product;
        unset($newProductData['id']);
        $newProductData['name'] = $product['name'] . ' (–ö–æ–ø–∏—è)';
        $newProductData['sku'] = $product['sku'] . '-copy';
        $newProductData['is_active'] = false; // –ö–æ–ø–∏–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        $result = createProduct($newProductData);
        if ($result['success']) {
            return ['success' => true, 'message' => '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω'];
        } else {
            return $result;
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

function toggleProductStatus($productId, $isActive) {
    try {
        $dynamicData = initializeDynamicData();
        $products = &$dynamicData['products'];

        $productIndex = array_search($productId, array_column($products, 'id'));
        if ($productIndex === false) {
            return ['success' => false, 'message' => '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω'];
        }

        $products[$productIndex]['is_active'] = (bool)$isActive;
        $products[$productIndex]['updated_at'] = date('Y-m-d H:i:s');
        $dynamicData['last_updated'] = date('Y-m-d H:i:s');

        if (saveDynamicData($dynamicData)) {
            return ['success' => true, 'message' => '–°—Ç–∞—Ç—É—Å —Ç–æ–≤–∞—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω'];
        } else {
            return ['success' => false, 'message' => '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'];
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

function bulkProductAction($action, $ids, $data = []) {
    try {
        if (empty($ids)) {
            return ['success' => false, 'message' => '–ù–µ –≤—ã–±—Ä–∞–Ω—ã —Ç–æ–≤–∞—Ä—ã'];
        }

        $dynamicData = initializeDynamicData();
        $products = &$dynamicData['products'];
        $affectedCount = 0;

        foreach ($ids as $id) {
            $productIndex = array_search($id, array_column($products, 'id'));
            if ($productIndex === false) continue;

            switch ($action) {
                case 'activate':
                    $products[$productIndex]['is_active'] = true;
                    $affectedCount++;
                    break;

                case 'deactivate':
                    $products[$productIndex]['is_active'] = false;
                    $affectedCount++;
                    break;

                case 'update_category':
                    if (isset($data['category_id'])) {
                        $category = getCategoryById($data['category_id']);
                        if ($category) {
                            $products[$productIndex]['category_id'] = (int)$data['category_id'];
                            $products[$productIndex]['category'] = $category['name'];
                            $affectedCount++;
                        }
                    }
                    break;

                case 'delete':
                    // –£–¥–∞–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                    if (!empty($products[$productIndex]['images'])) {
                        foreach ($products[$productIndex]['images'] as $image) {
                            deleteProductImage($image);
                        }
                    }
                    array_splice($products, $productIndex, 1);
                    $affectedCount++;
                    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
                    $products = array_values($products);
                    break;
            }

            if ($action !== 'delete') {
                $products[$productIndex]['updated_at'] = date('Y-m-d H:i:s');
            }
        }

        $dynamicData['last_updated'] = date('Y-m-d H:i:s');

        if (saveDynamicData($dynamicData)) {
            $actionNames = [
                'activate' => '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ',
                'deactivate' => '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ',
                'update_category' => '–∏–∑–º–µ–Ω–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É',
                'delete' => '—É–¥–∞–ª–µ–Ω–æ'
            ];
            $actionName = $actionNames[$action] ?? '–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ';
            return ['success' => true, 'message' => "–£—Å–ø–µ—à–Ω–æ {$actionName} {$affectedCount} —Ç–æ–≤–∞—Ä–æ–≤"];
        } else {
            return ['success' => false, 'message' => '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö'];
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

function deleteCategory($categoryId) {
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        $products = getProducts();
        $categoryProducts = array_filter($products, fn($p) => $p['category_id'] == $categoryId);

        if (!empty($categoryProducts)) {
            return ['success' => false, 'message' => '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å —Ç–æ–≤–∞—Ä–∞–º–∏'];
        }

        $dynamicData = initializeDynamicData();
        $categories = &$dynamicData['categories'];

        $categoryIndex = array_search($categoryId, array_column($categories, 'id'));
        if ($categoryIndex === false) {
            return ['success' => false, 'message' => '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'];
        }

        array_splice($categories, $categoryIndex, 1);
        $dynamicData['last_updated'] = date('Y-m-d H:i:s');

        if (saveDynamicData($dynamicData)) {
            return ['success' => true, 'message' => '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞'];
        } else {
            return ['success' => false, 'message' => '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'];
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

function toggleCategoryStatus($categoryId) {
    try {
        $dynamicData = initializeDynamicData();
        $categories = &$dynamicData['categories'];

        $categoryIndex = array_search($categoryId, array_column($categories, 'id'));
        if ($categoryIndex === false) {
            return ['success' => false, 'message' => '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'];
        }

        $categories[$categoryIndex]['active'] = !$categories[$categoryIndex]['active'];
        $categories[$categoryIndex]['updated_at'] = date('Y-m-d H:i:s');
        $dynamicData['last_updated'] = date('Y-m-d H:i:s');

        if (saveDynamicData($dynamicData)) {
            $status = $categories[$categoryIndex]['active'] ? '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞' : '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞';
            return ['success' => true, 'message' => "–ö–∞—Ç–µ–≥–æ—Ä–∏—è {$status}"];
        } else {
            return ['success' => false, 'message' => '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'];
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

function getOrderById($orderId) {
    $orders = getOrders();
    foreach ($orders as $order) {
        if ($order['id'] == $orderId) {
            return $order;
        }
    }
    return null;
}

function approveReview($reviewId) {
    try {
        $dynamicData = initializeDynamicData();
        $reviews = &$dynamicData['reviews'];

        $reviewIndex = array_search($reviewId, array_column($reviews, 'id'));
        if ($reviewIndex === false) {
            return ['success' => false, 'message' => '–û—Ç–∑—ã–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω'];
        }

        $reviews[$reviewIndex]['is_approved'] = true;
        $dynamicData['last_updated'] = date('Y-m-d H:i:s');

        if (saveDynamicData($dynamicData)) {
            return ['success' => true, 'message' => '–û—Ç–∑—ã–≤ –æ–¥–æ–±—Ä–µ–Ω'];
        } else {
            return ['success' => false, 'message' => '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'];
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

function deleteReview($reviewId) {
    try {
        $dynamicData = initializeDynamicData();
        $reviews = &$dynamicData['reviews'];

        $reviewIndex = array_search($reviewId, array_column($reviews, 'id'));
        if ($reviewIndex === false) {
            return ['success' => false, 'message' => '–û—Ç–∑—ã–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω'];
        }

        array_splice($reviews, $reviewIndex, 1);
        $dynamicData['last_updated'] = date('Y-m-d H:i:s');

        if (saveDynamicData($dynamicData)) {
            return ['success' => true, 'message' => '–û—Ç–∑—ã–≤ —É–¥–∞–ª–µ–Ω'];
        } else {
            return ['success' => false, 'message' => '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'];
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

function updateSiteSettings($data) {
    try {
        $dynamicData = initializeDynamicData();

        $settings = [
            'site_name' => $data['site_name'] ?? '',
            'site_description' => $data['site_description'] ?? '',
            'site_keywords' => $data['site_keywords'] ?? '',
            'admin_email' => $data['admin_email'] ?? '',
            'phone' => $data['phone'] ?? '',
            'address' => $data['address'] ?? '',
            'working_hours' => $data['working_hours'] ?? '',
            'currency' => $data['currency'] ?? '‚ÇΩ',
            'products_per_page' => (int)($data['products_per_page'] ?? 12),
            'min_order_amount' => (int)($data['min_order_amount'] ?? 500),
            'free_shipping_from' => (int)($data['free_shipping_from'] ?? 2000),
            'social_vk' => $data['social_vk'] ?? '',
            'social_telegram' => $data['social_telegram'] ?? '',
            'social_instagram' => $data['social_instagram'] ?? '',
            'social_youtube' => $data['social_youtube'] ?? '',
            'google_analytics' => $data['google_analytics'] ?? '',
            'yandex_metrika' => $data['yandex_metrika'] ?? '',
            'maintenance_mode' => isset($data['maintenance_mode'])
        ];

        $dynamicData['settings'] = $settings;
        $dynamicData['last_updated'] = date('Y-m-d H:i:s');

        if (saveDynamicData($dynamicData)) {
            return ['success' => true, 'message' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã'];
        } else {
            return ['success' => false, 'message' => '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'];
        }
    } catch (Exception $e) {
        return ['success' => false, 'message' => '–û—à–∏–±–∫–∞: ' . $e->getMessage()];
    }
}

// === –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===

function initSearch($inputId, $callback) {
    ?>
    <script>
        document.getElementById('<?= $inputId ?>').addEventListener('input', function(e) {
            const query = e.target.value.trim();
            (<?= $callback ?>)(query);
        });
    </script>
    <?php
}

function filterTable($tableId, $query, $searchColumns = []) {
    ?>
    <script>
        function filterTable(tableId, query, columns) {
            const table = document.getElementById(tableId);
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                let found = false;
                if (!query) {
                    found = true;
                } else {
                    columns.forEach(colIndex => {
                        const cell = row.cells[colIndex];
                        if (cell && cell.textContent.toLowerCase().includes(query.toLowerCase())) {
                            found = true;
                        }
                    });
                }
                row.style.display = found ? '' : 'none';
            });
        }

        filterTable('<?= $tableId ?>', '<?= addslashes($query) ?>', <?= json_encode($searchColumns) ?>);
    </script>
    <?php
}

// === –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–• ===

if (isset($_GET['action']) && !isset($_GET['ajax'])) {
    switch ($_GET['action']) {
        case 'export_products':
            exportProductsCSV();
            break;
        case 'export_orders':
            exportOrdersCSV();
            break;
        case 'print_order':
            printOrder($_GET['id']);
            break;
    }
}

function exportProductsCSV() {
    $products = getProducts();

    header('Content-Type: text/csv; charset=utf-8');
    header('Content-Disposition: attachment; filename="products_' . date('Y-m-d') . '.csv"');

    $output = fopen('php://output', 'w');

    // BOM –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è UTF-8 –≤ Excel
    fprintf($output, chr(0xEF).chr(0xBB).chr(0xBF));

    // –ó–∞–≥–æ–ª–æ–≤–∫–∏
    fputcsv($output, [
        'ID', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ê—Ä—Ç–∏–∫—É–ª', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–¶–µ–Ω–∞', '–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞', 
        '–û—Å—Ç–∞—Ç–æ–∫', '–ê–∫—Ç–∏–≤–µ–Ω', '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π', '–ù–æ–≤–∏–Ω–∫–∞', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è'
    ], ';');

    foreach ($products as $product) {
        fputcsv($output, [
            $product['id'],
            $product['name'],
            $product['sku'],
            $product['category'],
            $product['price'],
            $product['old_price'] ?: '',
            $product['stock'],
            $product['is_active'] ? '–î–∞' : '–ù–µ—Ç',
            $product['is_featured'] ? '–î–∞' : '–ù–µ—Ç',
            $product['is_new'] ? '–î–∞' : '–ù–µ—Ç',
            $product['created_at']
        ], ';');
    }

    fclose($output);
    exit;
}

function exportOrdersCSV() {
    $orders = getOrders();

    header('Content-Type: text/csv; charset=utf-8');
    header('Content-Disposition: attachment; filename="orders_' . date('Y-m-d') . '.csv"');

    $output = fopen('php://output', 'w');
    fprintf($output, chr(0xEF).chr(0xBB).chr(0xBF));

    fputcsv($output, [
        'ID', '–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞', '–ö–ª–∏–µ–Ω—Ç', 'Email', '–¢–µ–ª–µ—Ñ–æ–Ω', '–°—É–º–º–∞', 
        '–°—Ç–∞—Ç—É—Å', '–û–ø–ª–∞—Ç–∞', '–î–æ—Å—Ç–∞–≤–∫–∞', '–î–∞—Ç–∞'
    ], ';');

    foreach ($orders as $order) {
        fputcsv($output, [
            $order['id'],
            $order['order_number'],
            $order['customer_name'],
            $order['customer_email'],
            $order['customer_phone'],
            $order['total_amount'],
            $order['status_label'],
            $order['payment_method'] === 'card' ? '–ö–∞—Ä—Ç–æ–π' : '–ù–∞–ª–∏—á–Ω—ã–º–∏',
            $order['delivery_method'] === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑',
            $order['created_at']
        ], ';');
    }

    fclose($output);
    exit;
}

function printOrder($orderId) {
    $order = getOrderById($orderId);
    if (!$order) {
        die('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }
    ?>
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset='UTF-8'>
        <title>–ó–∞–∫–∞–∑ <?= $order['order_number'] ?></title>
        <style>
            body { font-family: Arial, sans-serif; font-size: 12px; }
            .header { text-align: center; margin-bottom: 20px; }
            .order-info { margin-bottom: 20px; }
            .customer-info { margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f2f2f2; }
            @media print { 
                body { margin: 0; } 
                button { display: none; }
            }
        </style>
    </head>
    <body>
        <div class='header'>
            <h1>–ó–ê–ö–ê–ó <?= $order['order_number'] ?></h1>
            <p>–æ—Ç <?= date('d.m.Y H:i', strtotime($order['created_at'])) ?></p>
        </div>

        <div class='order-info'>
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <?= $order['status_label'] ?></p>
            <p><strong>–°—É–º–º–∞:</strong> <?= number_format($order['total_amount'], 0, '', ' ') ?> ‚ÇΩ</p>
            <p><strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong> <?= $order['payment_method'] === 'card' ? '–ö–∞—Ä—Ç–æ–π' : '–ù–∞–ª–∏—á–Ω—ã–º–∏' ?></p>
            <p><strong>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> <?= $order['delivery_method'] === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑' ?></p>
        </div>

        <div class='customer-info'>
            <h3>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</h3>
            <p><strong>–ò–º—è:</strong> <?= htmlspecialchars($order['customer_name']) ?></p>
            <p><strong>Email:</strong> <?= htmlspecialchars($order['customer_email']) ?></p>
            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <?= htmlspecialchars($order['customer_phone']) ?></p>
            <p><strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> <?= htmlspecialchars($order['delivery_address']) ?></p>
        </div>

        <?php if ($order['notes']): ?>
        <div>
            <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
            <p><?= nl2br(htmlspecialchars($order['notes'])) ?></p>
        </div>
        <?php endif; ?>

        <button onclick='window.print()'>–ü–µ—á–∞—Ç—å</button>
        <button onclick='window.close()'>–ó–∞–∫—Ä—ã—Ç—å</button>

        <script>
            window.onload = function() {
                window.print();
            };
        </script>
    </body>
    </html>
    <?php
    exit;
}

// === –°–¢–ò–õ–ò –ò –°–ö–†–ò–ü–¢–´ (–≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞) ===
?>

<style>
/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ */

.file-upload-area {
    border: 2px dashed var(--border-color);
    border-radius: var(--border-radius);
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    background: var(--bg-secondary);
    margin-bottom: 16px;
}

.file-upload-area:hover {
    border-color: var(--primary-color);
    background: rgba(46, 204, 113, 0.05);
}

.file-upload-area.dragover {
    border-color: var(--primary-color);
    background: rgba(46, 204, 113, 0.1);
}

.uploaded-images {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 16px;
}

.uploaded-image {
    position: relative;
    width: 100px;
    height: 100px;
    border-radius: var(--border-radius);
    overflow: hidden;
    border: 2px solid var(--border-color);
}

.uploaded-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.uploaded-image .remove-btn {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 24px;
    height: 24px;
    background: var(--danger-color);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.form-row-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
}

.status-select {
    font-size: 12px;
    padding: 4px 8px;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: var(--bg-primary);
}

.bulk-actions {
    background: var(--bg-secondary);
    padding: 16px;
    border-radius: var(--border-radius);
    margin-bottom: 20px;
    display: none;
}

.bulk-actions.show {
    display: block;
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.spinner-large {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
// === –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
function initFileUpload(areaId, inputId) {
    const area = document.getElementById(areaId);
    const input = document.getElementById(inputId);

    if (!area || !input) return;

    area.addEventListener('click', () => input.click());

    area.addEventListener('dragover', (e) => {
        e.preventDefault();
        area.classList.add('dragover');
    });

    area.addEventListener('dragleave', () => {
        area.classList.remove('dragover');
    });

    area.addEventListener('drop', (e) => {
        e.preventDefault();
        area.classList.remove('dragover');
        input.files = e.dataTransfer.files;
        previewImages(input);
    });

    input.addEventListener('change', () => {
        previewImages(input);
    });
}

function previewImages(input) {
    const previewContainer = input.parentElement.nextElementSibling;
    if (!previewContainer.classList.contains('uploaded-images')) return;

    previewContainer.innerHTML = '';

    Array.from(input.files).forEach((file, index) => {
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const div = document.createElement('div');
                div.className = 'uploaded-image';
                div.innerHTML = `
                    <img src="${e.target.result}" alt="Preview">
                    <button type="button" class="remove-btn" onclick="removePreviewImage(this, ${index})">&times;</button>
                `;
                previewContainer.appendChild(div);
            };
            reader.readAsDataURL(file);
        }
    });
}

function removePreviewImage(btn, index) {
    btn.parentElement.remove();
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –∏–∑ input
}

// –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏
function toggleAllCheckboxes(masterCheckbox) {
    const checkboxes = document.querySelectorAll('.bulk-checkbox[data-id]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = masterCheckbox.checked;
    });
    updateBulkActions();
}

function updateBulkActions() {
    const selectedIds = getSelectedIds();
    const bulkActions = document.getElementById('bulkActions');
    const selectedCount = document.getElementById('selectedCount');

    if (selectedIds.length > 0) {
        bulkActions.classList.add('show');
        selectedCount.textContent = selectedIds.length;
    } else {
        bulkActions.classList.remove('show');
    }
}

function getSelectedIds() {
    const checkboxes = document.querySelectorAll('.bulk-checkbox[data-id]:checked');
    return Array.from(checkboxes).map(cb => parseInt(cb.dataset.id));
}

// –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showLoading() {
    const overlay = document.createElement('div');
    overlay.className = 'loading-overlay';
    overlay.id = 'loadingOverlay';
    overlay.innerHTML = '<div class="spinner-large"></div>';
    document.body.appendChild(overlay);
}

function hideLoading() {
    const overlay = document.getElementById('loadingOverlay');
    if (overlay) {
        overlay.remove();
    }
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 20px;
        background: var(--${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'}-color);
        color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        z-index: 10000;
        animation: slideInRight 0.3s ease;
        max-width: 400px;
        word-wrap: break-word;
    `;
    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 16px; cursor: pointer; margin-left: auto;">&times;</button>
        </div>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

// AJAX —Ñ–æ—Ä–º—ã
document.addEventListener('DOMContentLoaded', function() {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ AJAX —Ñ–æ—Ä–º
    document.querySelectorAll('.ajax-form').forEach(form => {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';

            const formData = new FormData(form);
            formData.append('ajax', '1');

            try {
                const response = await fetch('admin.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(data.message || '–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ', 'success');

                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                    const modal = form.closest('.modal');
                    if (modal) {
                        setTimeout(() => {
                            modal.style.display = 'none';
                            document.body.style.overflow = '';
                        }, 1000);
                    }

                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    showNotification(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                console.error('Form submission error:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏—Ö
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        });
    });

    // –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
});

// –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
async function removeProductImage(productId, imageIndex) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) return;

    showLoading();

    const formData = new FormData();
    formData.append('action', 'remove_product_image');
    formData.append('product_id', productId);
    formData.append('image_index', imageIndex);
    formData.append('ajax', '1');

    try {
        const response = await fetch('admin.php', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data.success) {
            showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
            setTimeout(() => location.reload(), 1000);
        } else {
            showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    } finally {
        hideLoading();
    }
}
</script>

<?php
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
function initSearch($inputId, $callbackFunction) {
    ?>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('<?= $inputId ?>');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.trim();
                    <?= $callbackFunction ?>(query);
                });
            }
        });
    </script>
    <?php
}
?>

<!-- –ó–∞–∫—Ä—ã–≤–∞—é—â–∏–π —Ç–µ–≥ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∞–¥–º–∏–Ω–∫–∏ -->
</body>
</html>
