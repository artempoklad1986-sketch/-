<?php
require_once 'functions.php';

// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
$featured_products = getFeaturedProducts(8);
$categories = getCategoriesWithCount();
$stats = getDashboardStats();
$settings = getSettings();
$slider = loadJsonData('slider.json');
$news = array_slice(loadJsonData('news.json'), 0, 3);
$reviews = array_slice(loadJsonData('reviews.json'), 0, 6);

// –ò–∫–æ–Ω–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
$categoryIcons = [
    '–ü–ª–∞–≤–∞—é—â–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏—è' => 'üåä',
    '–≠–ø–∏—Ñ–∏—Ç—ã' => 'ü™®',
    '–ú—Ö–∏' => 'üçÉ',
    '–î–ª–∏–Ω–Ω–æ—Å—Ç–µ–±–µ–ª—å–Ω—ã–µ' => 'üåø',
    '–†–æ–∑–µ—Ç–æ—á–Ω—ã–µ' => 'üåπ',
    '–ü–æ—á–≤–æ–ø–æ–∫—Ä–æ–≤–Ω—ã–µ' => 'üå±',
    '–ö–ª—É–±–Ω–µ–≤—ã–µ' => 'ü•î',
    '–ü–µ—á–µ–Ω–æ—á–Ω–∏–∫–∏' => 'üçÄ',
    '–õ—É–∫–æ–≤–∏—á–Ω—ã–µ' => 'üßÖ'
];
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± –ê–∫–≤–∞—Ä–∏—É–º–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è - –õ—É—á—à–∏–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –≤–æ–¥–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π</title>
    <meta name="description" content="–ë–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä –∞–∫–≤–∞—Ä–∏—É–º–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π ‚úÖ <?= $stats['total_products'] ?> –≤–∏–¥–æ–≤ ‚úÖ <?= $stats['total_categories'] ?> –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏">

    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1>üå± –ê–∫–≤–∞—Ä–∏—É–º–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è</h1>
                <p class="subtitle">–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç–µ —Å–≤–æ–π –∞–∫–≤–∞—Ä–∏—É–º –≤ –ø–æ–¥–≤–æ–¥–Ω—ã–π —Å–∞–¥ –º–µ—á—Ç—ã</p>
                <div class="stats">
                    <div class="stat">
                        <span class="stat-number"><?= $stats['total_products'] ?>+</span>
                        <span class="stat-label">—Ä–∞—Å—Ç–µ–Ω–∏–π</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number"><?= $stats['total_categories'] ?></span>
                        <span class="stat-label">–∫–∞—Ç–µ–≥–æ—Ä–∏–π</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        <span class="stat-label">–∫–∞—á–µ—Å—Ç–≤–æ</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- NAVIGATION -->
    <nav class="nav">
        <div class="container">
            <div class="nav-container">
                <a href="index.php">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="products.php">üåø –í—Å–µ —Ä–∞—Å—Ç–µ–Ω–∏—è (<?= $stats['total_products'] ?>)</a>
                <a href="#categories">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
                <a href="#featured">‚ú® –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</a>
                <a href="cart.php">üõí –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cart-count"><?= count(getCart()) ?></span>)</a>
                <a href="admin/">‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞</a>
            </div>
        </div>
    </nav>

    <!-- SLIDER SECTION -->
    <?php if (!empty($slider)): ?>
    <section class="slider-section">
        <div class="container">
            <div class="slider">
                <?php foreach ($slider as $index => $slide): ?>
                <div class="slide <?= $index === 0 ? 'active' : '' ?>">
                    <div class="slide-content">
                        <h2><?= htmlspecialchars($slide['title']) ?></h2>
                        <p><?= htmlspecialchars($slide['description']) ?></p>
                        <?php if (!empty($slide['button_text']) && !empty($slide['button_link'])): ?>
                        <a href="<?= htmlspecialchars($slide['button_link']) ?>" class="btn btn-large">
                            <?= htmlspecialchars($slide['button_text']) ?>
                        </a>
                        <?php endif; ?>
                    </div>
                    <?php if (!empty($slide['image'])): ?>
                    <div class="slide-image">
                        <img src="<?= htmlspecialchars($slide['image']) ?>" alt="<?= htmlspecialchars($slide['title']) ?>">
                    </div>
                    <?php endif; ?>
                </div>
                <?php endforeach; ?>

                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ -->
                <div class="slider-nav">
                    <?php foreach ($slider as $index => $slide): ?>
                    <button class="nav-dot <?= $index === 0 ? 'active' : '' ?>" data-slide="<?= $index ?>"></button>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>
    </section>
    <?php endif; ?>

    <!-- CATEGORIES SECTION -->
    <section class="categories" id="categories">
        <div class="container">
            <h2 class="section-title">üóÇÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ç–µ–Ω–∏–π</h2>
            <p class="section-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–≤–∞—Ä–∏—É–º–∞</p>

            <div class="categories-grid">
                <?php foreach ($categories as $category): ?>
                <div class="category-card">
                    <span class="icon"><?= $categoryIcons[$category['name']] ?? 'üå±' ?></span>
                    <a href="category.php?id=<?= $category['id'] ?>">
                        <?= htmlspecialchars($category['name']) ?>
                    </a>
                    <div class="count"><?= $category['products_count'] ?> —Ä–∞—Å—Ç–µ–Ω–∏–π</div>
                </div>
                <?php endforeach; ?>
            </div>
        </div>
    </section>

    <!-- FEATURED PRODUCTS -->
    <section class="featured" id="featured">
        <div class="container">
            <h2 class="section-title">‚ú® –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è</h2>
            <p class="section-subtitle">–õ—É—á—à–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –æ–ø—ã—Ç–Ω—ã—Ö –∞–∫–≤–∞—Ä–∏—É–º–∏—Å—Ç–æ–≤</p>

            <?php if ($featured_products): ?>
                <div class="products-grid">
                    <?php foreach ($featured_products as $product): ?>
                        <div class="product-card">
                            <img src="<?= htmlspecialchars($product['main_image']) ?>"
                                 alt="<?= htmlspecialchars($product['name']) ?>"
                                 class="product-image"
                                 loading="lazy">
                            <div class="product-info">
                                <h3 class="product-name"><?= htmlspecialchars($product['name']) ?></h3>
                                <p class="product-latin"><?= htmlspecialchars($product['latin_name']) ?></p>

                                <?php 
                                $category = getCategoryById($product['category_id']);
                                if ($category): ?>
                                <span class="product-category"><?= htmlspecialchars($category['name']) ?></span>
                                <?php endif; ?>

                                <div class="product-price"><?= formatPrice($product['price']) ?></div>

                                <?php
                                $difficultyClass = 'easy';
                                if (strtolower($product['difficulty']) == '—Å—Ä–µ–¥–Ω–µ') $difficultyClass = 'medium';
                                elseif (strtolower($product['difficulty']) == '—Å–ª–æ–∂–Ω–æ') $difficultyClass = 'hard';
                                ?>
                                <span class="product-difficulty difficulty-<?= $difficultyClass ?>">
                                    <?= htmlspecialchars($product['difficulty']) ?>
                                </span>

                                <div class="product-actions">
                                    <button class="btn btn-details" onclick="openProductModal(<?= $product['id'] ?>)">
                                        üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                    </button>
                                    <button class="btn btn-cart" onclick="addToCart(<?= $product['id'] ?>)">
                                        üõí –í –∫–æ—Ä–∑–∏–Ω—É
                                    </button>
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php else: ?>
                <div class="no-products">
                    <h3>–¢–æ–≤–∞—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h3>
                    <p>–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–∞—Ç–∞–ª–æ–≥–∞</p>
                </div>
            <?php endif; ?>
        </div>
    </section>

    <!-- NEWS SECTION -->
    <?php if (!empty($news)): ?>
    <section class="news-section">
        <div class="container">
            <h2 class="section-title">üì∞ –ù–æ–≤–æ—Å—Ç–∏ –∏ —Å—Ç–∞—Ç—å–∏</h2>
            <p class="section-subtitle">–ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–∏ –∞–∫–≤–∞—Ä–∏—É–º–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π</p>

            <div class="news-grid">
                <?php foreach ($news as $article): ?>
                <div class="news-card">
                    <?php if (!empty($article['image'])): ?>
                    <img src="<?= htmlspecialchars($article['image']) ?>" alt="<?= htmlspecialchars($article['title']) ?>" class="news-image">
                    <?php endif; ?>
                    <div class="news-content">
                        <div class="news-date"><?= date('d.m.Y', strtotime($article['date'])) ?></div>
                        <h3 class="news-title"><?= htmlspecialchars($article['title']) ?></h3>
                        <p class="news-excerpt"><?= htmlspecialchars(mb_substr($article['content'], 0, 150)) ?>...</p>
                        <a href="news.php?id=<?= $article['id'] ?>" class="news-link">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ ‚Üí</a>
                    </div>
                </div>
                <?php endforeach; ?>
            </div>
        </div>
    </section>
    <?php endif; ?>

    <!-- REVIEWS SECTION -->
    <?php if (!empty($reviews)): ?>
    <section class="reviews-section">
        <div class="container">
            <h2 class="section-title">‚≠ê –û—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h2>
            <p class="section-subtitle">–ß—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –Ω–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã</p>

            <div class="reviews-grid">
                <?php foreach ($reviews as $review): ?>
                <div class="review-card">
                    <div class="review-header">
                        <div class="review-author"><?= htmlspecialchars($review['author']) ?></div>
                        <div class="review-rating">
                            <?php for ($i = 1; $i <= 5; $i++): ?>
                                <span class="star <?= $i <= $review['rating'] ? 'filled' : '' ?>">‚≠ê</span>
                            <?php endfor; ?>
                        </div>
                    </div>
                    <p class="review-text"><?= htmlspecialchars($review['text']) ?></p>
                    <div class="review-date"><?= date('d.m.Y', strtotime($review['date'])) ?></div>
                </div>
                <?php endforeach; ?>
            </div>
        </div>
    </section>
    <?php endif; ?>

    <!-- STATS SECTION -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="number"><?= $stats['total_products'] ?>+</div>
                    <div class="label">–í–∏–¥–æ–≤ —Ä–∞—Å—Ç–µ–Ω–∏–π –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</div>
                </div>
                <div class="stat-item">
                    <div class="number"><?= $stats['total_categories'] ?></div>
                    <div class="label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                </div>
                <div class="stat-item">
                    <div class="number"><?= $stats['total_orders'] ?></div>
                    <div class="label">–î–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="number">24/7</div>
                    <div class="label">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA SECTION -->
    <section class="cta-section">
        <div class="container">
            <div class="cta-content">
                <h2 class="cta-title">–ì–æ—Ç–æ–≤—ã —Å–æ–∑–¥–∞—Ç—å –∞–∫–≤–∞—Ä–∏—É–º –º–µ—á—Ç—ã?</h2>
                <p class="cta-text">–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –º–∏—Ä –ø–æ–¥–≤–æ–¥–Ω–æ–≥–æ —Å–∞–¥–æ–≤–æ–¥—Å—Ç–≤–∞ —Å –Ω–∞—à–∏–º–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏</p>
                <div class="cta-buttons">
                    <a href="products.php" class="btn btn-large">üåø –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ä–∞—Å—Ç–µ–Ω–∏—è</a>
                    <a href="#categories" class="btn btn-outline btn-large">üìÇ –í—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</a>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>üå± –ê–∫–≤–∞—Ä–∏—É–º–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è</h3>
                    <p>–õ—É—á—à–∏–π –≤—ã–±–æ—Ä –≤–æ–¥–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–≤–∞—Ä–∏—É–º–∞. –ö–∞—á–µ—Å—Ç–≤–æ, –∫—Ä–∞—Å–æ—Ç–∞, –∑–¥–æ—Ä–æ–≤—å–µ –≤–∞—à–∏—Ö —Ä—ã–±–æ–∫.</p>
                </div>

                <div class="footer-section">
                    <h3>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <?php foreach (array_slice($categories, 0, 5) as $category): ?>
                        <a href="category.php?id=<?= $category['id'] ?>"><?= htmlspecialchars($category['name']) ?></a>
                    <?php endforeach; ?>
                </div>

                <div class="footer-section">
                    <h3>üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                    <a href="products.php">–í—Å–µ —Ä–∞—Å—Ç–µ–Ω–∏—è</a>
                    <a href="search.php">–ü–æ–∏—Å–∫</a>
                    <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
                    <a href="admin/">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
                </div>

                <div class="footer-section">
                    <h3>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <p>üìß info@aquaplants.ru</p>
                    <p>üì± +7 (999) 123-45-67</p>
                    <p>üïí –ü–Ω-–í—Å: 9:00-21:00</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; <?= date('Y') ?> –ê–∫–≤–∞—Ä–∏—É–º–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <!-- MODAL FOR PRODUCT DETAILS -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="modalContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
            </div>
        </div>
    </div>

    <script src="assets/js/script.js"></script>
</body>
</html>
