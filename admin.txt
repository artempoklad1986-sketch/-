<?php
/**
 * –ê–¥–º–∏–Ω–∫–∞ –ê–∫–≤–∞–°–±–æ—Ä - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
 */

session_start();

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ
define('ADMIN_ACCESS', true);

// –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
error_reporting(E_ALL & ~E_WARNING);
ini_set('display_errors', 1);

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
$pdo = null;
$dbError = null;

try {
    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
    $dbConfigPath = '../config/database.php';
    if (file_exists($dbConfigPath)) {
        $dbConfig = require $dbConfigPath;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        if (is_array($dbConfig) && isset($dbConfig['host'], $dbConfig['database'], $dbConfig['username'], $dbConfig['password'])) {
            $dsn = "mysql:host={$dbConfig['host']};dbname={$dbConfig['database']};charset=utf8mb4";
            $pdo = new PDO($dsn, $dbConfig['username'], $dbConfig['password'], [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci"
            ]);
        } else {
            throw new Exception('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ë–î');
        }
    } else {
        // –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è shared hosting
        $host = 'localhost';
        $dbname = 'dizain9n_aqua'; // –û–±—ã—á–Ω–æ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –ë–î –Ω–∞ shared hosting
        $username = 'dizain9n_aqua';
        $password = ''; // –í–∞—à –ø–∞—Ä–æ–ª—å –æ—Ç –ë–î

        // –ü–æ–ø—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è shared hosting
        $possibleConfigs = [
            ['localhost', 'dizain9n_aqua', 'dizain9n_aqua', ''],
            ['localhost', 'aquasbor', 'root', ''],
            ['mysql', 'aquasbor', 'root', ''],
            ['127.0.0.1', 'aquasbor', 'root', '']
        ];

        foreach ($possibleConfigs as $config) {
            try {
                $dsn = "mysql:host={$config[0]};dbname={$config[1]};charset=utf8mb4";
                $pdo = new PDO($dsn, $config[2], $config[3], [
                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                    PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci"
                ]);
                break; // –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
            } catch (PDOException $e) {
                continue; // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            }
        }

        if (!$pdo) {
            throw new Exception('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∏ —Å –æ–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ë–î');
        }
    }
} catch (Exception $e) {
    $dbError = $e->getMessage();
    error_log("DB Connection Error: " . $dbError);
}

// –ï—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫–∏
if (!$pdo) {
    // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–µ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    $systemStats = [
        'products' => 0,
        'active_products' => 0,
        'orders' => 0,
        'new_orders' => 0,
        'reviews' => 0,
        'pending_reviews' => 0,
        'total_revenue' => 0,
        'php_version' => PHP_VERSION,
        'server_load' => 25.5,
        'disk_usage' => '1.2 GB',
        'db_size' => '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'
    ];
} else {
    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ç–∞–±–ª–∏—Ü –µ—Å–ª–∏ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞
    try {
        $pdo->exec("CREATE TABLE IF NOT EXISTS `products` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `latin_name` varchar(255) DEFAULT NULL,
            `category` varchar(100) DEFAULT NULL,
            `price` decimal(10,2) NOT NULL DEFAULT '0.00',
            `description` text,
            `difficulty` varchar(50) DEFAULT NULL,
            `care` json DEFAULT NULL,
            `features` json DEFAULT NULL,
            `main_image` varchar(500) DEFAULT NULL,
            `images` json DEFAULT NULL,
            `status` enum('active','inactive','draft') DEFAULT 'active',
            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            `updated_at` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
            PRIMARY KEY (`id`),
            KEY `category` (`category`),
            KEY `status` (`status`),
            KEY `difficulty` (`difficulty`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci");

        $pdo->exec("CREATE TABLE IF NOT EXISTS `orders` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `customer_name` varchar(255) NOT NULL,
            `customer_email` varchar(255) NOT NULL,
            `customer_phone` varchar(50) DEFAULT NULL,
            `products` json NOT NULL,
            `total_amount` decimal(10,2) NOT NULL,
            `status` enum('new','processing','shipped','completed','cancelled') DEFAULT 'new',
            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            `updated_at` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
            PRIMARY KEY (`id`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci");

        $pdo->exec("CREATE TABLE IF NOT EXISTS `reviews` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `product_id` int(11) NOT NULL,
            `customer_name` varchar(255) NOT NULL,
            `rating` tinyint(1) NOT NULL DEFAULT 5,
            `comment` text,
            `status` enum('pending','approved','rejected') DEFAULT 'pending',
            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            PRIMARY KEY (`id`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci");
    } catch (Exception $e) {
        error_log("Table creation error: " . $e->getMessage());
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    $systemStats = getSystemStats();
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function getSystemStats() {
    global $pdo;

    $stats = [];

    try {
        if ($pdo) {
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
            $stmt = $pdo->query("SELECT COUNT(*) as count FROM products");
            $stats['products'] = $stmt ? $stmt->fetch()['count'] : 0;

            $stmt = $pdo->query("SELECT COUNT(*) as count FROM products WHERE status = 'active'");
            $stats['active_products'] = $stmt ? $stmt->fetch()['count'] : 0;

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
            $stmt = $pdo->query("SELECT COUNT(*) as count FROM orders");
            $stats['orders'] = $stmt ? $stmt->fetch()['count'] : 0;

            $stmt = $pdo->query("SELECT COUNT(*) as count FROM orders WHERE status = 'new'");
            $stats['new_orders'] = $stmt ? $stmt->fetch()['count'] : 0;

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤
            $stmt = $pdo->query("SELECT COUNT(*) as count FROM reviews");
            $stats['reviews'] = $stmt ? $stmt->fetch()['count'] : 0;

            $stmt = $pdo->query("SELECT COUNT(*) as count FROM reviews WHERE status = 'pending'");
            $stats['pending_reviews'] = $stmt ? $stmt->fetch()['count'] : 0;

            // –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤
            $stmt = $pdo->query("SELECT COALESCE(SUM(total_amount), 0) as total FROM orders WHERE status != 'cancelled'");
            $stats['total_revenue'] = $stmt ? $stmt->fetch()['total'] : 0;
        } else {
            // –ó–∞–≥–ª—É—à–∫–∏ –µ—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
            $stats['products'] = 0;
            $stats['active_products'] = 0;
            $stats['orders'] = 0;
            $stats['new_orders'] = 0;
            $stats['reviews'] = 0;
            $stats['pending_reviews'] = 0;
            $stats['total_revenue'] = 0;
        }

        // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        $stats['php_version'] = PHP_VERSION;
        $stats['server_load'] = function_exists('sys_getloadavg') ? sys_getloadavg()[0] * 100 : rand(15, 45);
        $stats['disk_usage'] = formatBytes(disk_free_space('.'));
        $stats['db_size'] = $pdo ? '15.6 MB' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ';

    } catch (Exception $e) {
        error_log("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: " . $e->getMessage());

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        $stats = [
            'products' => 0,
            'active_products' => 0,
            'orders' => 0,
            'new_orders' => 0,
            'reviews' => 0,
            'pending_reviews' => 0,
            'total_revenue' => 0,
            'php_version' => PHP_VERSION,
            'server_load' => 25,
            'disk_usage' => '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
            'db_size' => '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'
        ];
    }

    return $stats;
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
function formatBytes($size, $precision = 2) {
    if ($size === false) return '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ';

    $units = ['B', 'KB', 'MB', 'GB', 'TB'];

    for ($i = 0; $size >= 1024 && $i < count($units) - 1; $i++) {
        $size /= 1024;
    }

    return round($size, $precision) . ' ' . $units[$i];
}

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
$currentPage = $_GET['page'] ?? 'dashboard';
$allowedPages = ['dashboard', 'products', 'orders', 'reviews', 'analytics', 'settings'];

if (!in_array($currentPage, $allowedPages)) {
    $currentPage = 'dashboard';
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥—É–ª–µ–π
$allModules = [
    [
        'name' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏',
        'description' => '–ö–∞—Ç–∞–ª–æ–≥ –∞–∫–≤–∞—Ä–∏—É–º–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π',
        'status' => 'active',
        'menu' => ['icon' => 'bi-box-seam'],
        'created_at' => date('Y-m-d H:i:s')
    ],
    [
        'name' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏',
        'description' => '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤',
        'status' => 'active',
        'menu' => ['icon' => 'bi-cart-check'],
        'created_at' => date('Y-m-d H:i:s')
    ],
    [
        'name' => '–°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤',
        'description' => '–û—Ç–∑—ã–≤—ã –æ —Ç–æ–≤–∞—Ä–∞—Ö',
        'status' => 'active',
        'menu' => ['icon' => 'bi-chat-square-text'],
        'created_at' => date('Y-m-d H:i:s')
    ]
];

// –û–±—Ä–∞–±–æ—Ç–∫–∞ AJAX –∑–∞–ø—Ä–æ—Å–æ–≤
if (isset($_GET['ajax'])) {
    header('Content-Type: application/json; charset=utf-8');

    switch ($_GET['ajax']) {
        case 'stats':
            echo json_encode(getSystemStats(), JSON_UNESCAPED_UNICODE);
            exit;

        case 'clear_cache':
            // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
            if (function_exists('opcache_reset')) {
                opcache_reset();
            }
            echo json_encode(['status' => 'success', 'message' => '–ö–µ—à –æ—á–∏—â–µ–Ω'], JSON_UNESCAPED_UNICODE);
            exit;

        case 'test_db':
            echo json_encode([
                'status' => $pdo ? 'connected' : 'error',
                'message' => $pdo ? '–ë–î –ø–æ–¥–∫–ª—é—á–µ–Ω–∞' : ($dbError ?: '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î'),
                'stats' => $systemStats
            ], JSON_UNESCAPED_UNICODE);
            exit;
    }
}
?>

<!DOCTYPE html>
<html lang="ru" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫–≤–∞–°–±–æ—Ä - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS -->
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --info-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-brand {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
        }

        .sidebar-brand h4 {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            font-weight: 800;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            margin: 0.25rem 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #6c757d;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-link:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateX(5px);
        }

        .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-link i {
            font-size: 1.25rem;
            margin-right: 0.75rem;
            width: 20px;
        }

        .nav-badge {
            margin-left: auto;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        /* –•–µ–¥–µ—Ä */
        .admin-header {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .admin-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: none;
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stats-card.primary::before { background: var(--primary-gradient); }
        .stats-card.success::before { background: var(--success-gradient); }
        .stats-card.info::before { background: var(--info-gradient); }
        .stats-card.warning::before { background: var(--warning-gradient); }

        .stats-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats-label {
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .stats-icon {
            font-size: 3rem;
            opacity: 0.1;
            color: #667eea;
        }

        /* –í–∏–¥–∂–µ—Ç—ã */
        .widget-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: none;
            overflow: hidden;
            height: 100%;
        }

        .widget-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        .widget-header h5 {
            margin: 0;
            font-weight: 700;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            color: white;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .btn-outline-gradient {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box, var(--primary-gradient) border-box;
            color: #667eea;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-gradient:hover {
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-2px);
        }

        /* –ê–ª–µ—Ä—Ç –¥–ª—è –æ—à–∏–±–∫–∏ –ë–î */
        .db-error-alert {
            position: sticky;
            top: 0;
            z-index: 999;
            margin-bottom: 2rem;
            border: none;
            border-radius: 10px;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã */
        .progress-modern {
            height: 8px;
            border-radius: 10px;
            background: #e9ecef;
            overflow: hidden;
        }

        .progress-bar {
            background: var(--primary-gradient);
            border-radius: 10px;
            transition: width 0.6s ease;
        }

        /* –°—Ç–∞—Ç—É—Å—ã –º–æ–¥—É–ª–µ–π */
        .module-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .module-status.active {
            background: #28a745;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }

        .module-status.inactive {
            background: #dc3545;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in-up {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .admin-header {
                padding: 1rem;
            }

            .stats-value {
                font-size: 2rem;
            }
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        [data-bs-theme="dark"] {
            --bs-body-bg: #1a1d29;
            --bs-body-color: #e4e6ea;
        }

        [data-bs-theme="dark"] .sidebar {
            background: #2d3748;
            border-right: 1px solid #4a5568;
        }

        [data-bs-theme="dark"] .stats-card,
        [data-bs-theme="dark"] .widget-card,
        [data-bs-theme="dark"] .admin-header {
            background: #2d3748;
            color: #e4e6ea;
        }

        [data-bs-theme="dark"] .widget-header {
            background: #4a5568;
            border-color: #4a5568;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ */
        .alert {
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- –°–∞–π–¥–±–∞—Ä -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-brand">
            <i class="bi bi-water fs-2 text-primary mb-2"></i>
            <h4>–ê–∫–≤–∞–°–±–æ—Ä</h4>
            <small class="text-muted">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</small>
            <?php if ($dbError): ?>
                <div class="mt-2">
                    <span class="badge bg-danger">–ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</span>
                </div>
            <?php else: ?>
                <div class="mt-2">
                    <span class="badge bg-success">–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç</span>
                </div>
            <?php endif; ?>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-item">
                <a href="?page=dashboard" class="nav-link <?= $currentPage === 'dashboard' ? 'active' : '' ?>">
                    <i class="bi bi-speedometer2"></i>
                    –î–∞—à–±–æ—Ä–¥
                </a>
            </div>

            <div class="nav-item">
                <a href="?page=products" class="nav-link <?= $currentPage === 'products' ? 'active' : '' ?>">
                    <i class="bi bi-box-seam"></i>
                    –¢–æ–≤–∞—Ä—ã
                    <span class="nav-badge"><?= $systemStats['products'] ?></span>
                </a>
            </div>

            <div class="nav-item">
                <a href="?page=orders" class="nav-link <?= $currentPage === 'orders' ? 'active' : '' ?>">
                    <i class="bi bi-cart-check"></i>
                    –ó–∞–∫–∞–∑—ã
                    <?php if ($systemStats['new_orders'] > 0): ?>
                        <span class="nav-badge bg-danger"><?= $systemStats['new_orders'] ?></span>
                    <?php endif; ?>
                </a>
            </div>

            <div class="nav-item">
                <a href="?page=reviews" class="nav-link <?= $currentPage === 'reviews' ? 'active' : '' ?>">
                    <i class="bi bi-chat-square-text"></i>
                    –û—Ç–∑—ã–≤—ã
                    <?php if ($systemStats['pending_reviews'] > 0): ?>
                        <span class="nav-badge bg-warning"><?= $systemStats['pending_reviews'] ?></span>
                    <?php endif; ?>
                </a>
            </div>

            <div class="nav-item">
                <a href="?page=analytics" class="nav-link <?= $currentPage === 'analytics' ? 'active' : '' ?>">
                    <i class="bi bi-graph-up"></i>
                    –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                </a>
            </div>

            <hr class="my-3">

            <div class="nav-item">
                <a href="?page=settings" class="nav-link <?= $currentPage === 'settings' ? 'active' : '' ?>">
                    <i class="bi bi-gear"></i>
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </a>
            </div>

            <div class="nav-item">
                <a href="../" target="_blank" class="nav-link">
                    <i class="bi bi-arrow-up-right-square"></i>
                    –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç
                </a>
            </div>

            <div class="nav-item">
                <a href="#" class="nav-link" onclick="toggleTheme()">
                    <i class="bi bi-moon" id="themeIcon"></i>
                    –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
                </a>
            </div>
        </nav>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content" id="mainContent">
        <!-- –ê–ª–µ—Ä—Ç –æ—à–∏–±–∫–∏ –ë–î -->
        <?php if ($dbError): ?>
        <div class="alert alert-warning db-error-alert">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-triangle-fill fs-4 me-3"></i>
                <div>
                    <h6 class="mb-1">–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h6>
                    <p class="mb-2 small"><?= htmlspecialchars($dbError) ?></p>
                    <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-outline-warning" onclick="testDBConnection()">
                            <i class="bi bi-arrow-repeat me-1"></i>
                            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="showDBSetupHelp()">
                            <i class="bi bi-question-circle me-1"></i>
                            –ü–æ–º–æ—â—å –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
                        </button>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>
        <?php endif; ?>

        <!-- –•–µ–¥–µ—Ä -->
        <div class="admin-header">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <button class="btn btn-outline-secondary d-md-none me-3" onclick="toggleSidebar()">
                            <i class="bi bi-list"></i>
                        </button>
                        <div>
                            <h2 class="mb-0">
                                <?php
                                $titles = [
                                    'dashboard' => '–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å',
                                    'products' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏',
                                    'orders' => '–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤',
                                    'reviews' => '–û—Ç–∑—ã–≤—ã –æ —Ç–æ–≤–∞—Ä–∞—Ö',
                                    'analytics' => '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂',
                                    'settings' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã'
                                ];
                                echo $titles[$currentPage] ?? '–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å';
                                ?>
                            </h2>
                            <small class="text-muted">
                                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ê–∫–≤–∞–°–±–æ—Ä
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="d-flex align-items-center justify-content-end gap-2">
                        <span class="text-muted small">
                            <i class="bi bi-clock me-1"></i>
                            <?= date('d.m.Y H:i') ?>
                        </span>
                        <div class="vr"></div>
                        <?php if ($pdo): ?>
                            <span class="badge bg-success">
                                <i class="bi bi-database me-1"></i>
                                –ë–î –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
                            </span>
                        <?php else: ?>
                            <span class="badge bg-danger">
                                <i class="bi bi-database-x me-1"></i>
                                –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                            </span>
                        <?php endif; ?>
                        <button class="btn btn-outline-primary btn-sm" onclick="updateStats()">
                            <i class="bi bi-arrow-repeat"></i>
                        </button>
                        <button class="btn btn-gradient btn-sm" onclick="showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–∫–≤–∞–°–±–æ—Ä!', 'success')">
                            <i class="bi bi-bell me-1"></i>
                            –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class="page-content">
            <?php
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω—É–∂–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            $pageFile = "pages/{$currentPage}.php";
            if (file_exists($pageFile)) {
                include $pageFile;
            } else {
                // –ó–∞–≥–ª—É—à–∫–∞ –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
                echo "<div class='text-center py-5 fade-in-up'>";
                echo "<i class='bi bi-exclamation-triangle text-muted' style='font-size: 5rem;'></i>";
                echo "<h3 class='mt-3'>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h3>";
                echo "<p class='text-muted'>–§–∞–π–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã <code>{$pageFile}</code> –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>";
                echo "<a href='?page=dashboard' class='btn btn-gradient'>–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>";
                echo "</div>";
            }
            ?>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π JS -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let systemStats = <?= json_encode($systemStats, JSON_UNESCAPED_UNICODE) ?>;
        let dbConnected = <?= $pdo ? 'true' : 'false' ?>;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
            const savedTheme = localStorage.getItem('admin_theme') || 'light';
            document.documentElement.setAttribute('data-bs-theme', savedTheme);
            updateThemeIcon(savedTheme);

            // –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è
            const elements = document.querySelectorAll('.fade-in-up');
            elements.forEach((el, index) => {
                el.style.animationDelay = (index * 0.1) + 's';
            });

            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ë–î –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
            if (dbConnected) {
                setInterval(updateStats, 300000);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ —Å–µ—Å—Å–∏–∏
            <?php if (isset($_SESSION['success'])): ?>
                showNotification('<?= addslashes($_SESSION['success']) ?>', 'success');
                <?php unset($_SESSION['success']); ?>
            <?php endif; ?>

            <?php if (isset($_SESSION['error'])): ?>
                showNotification('<?= addslashes($_SESSION['error']) ?>', 'danger');
                <?php unset($_SESSION['error']); ?>
            <?php endif; ?>

            console.log('üåä –ê–∫–≤–∞–°–±–æ—Ä –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', systemStats);
            console.log('üóÑÔ∏è –ë–î:', dbConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('admin_theme', newTheme);
            updateThemeIcon(newTheme);

            showNotification(`–¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –Ω–∞ ${newTheme === 'dark' ? '—Ç–µ–º–Ω—É—é' : '—Å–≤–µ—Ç–ª—É—é'}`, 'info');
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            if (icon) {
                icon.className = theme === 'dark' ? 'bi bi-sun' : 'bi bi-moon';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function updateStats() {
            try {
                const response = await fetch('?ajax=stats');
                const newStats = await response.json();
                systemStats = newStats;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                const elements = document.querySelectorAll('[data-stat]');
                elements.forEach(el => {
                    const stat = el.getAttribute('data-stat');
                    if (newStats[stat] !== undefined) {
                        // –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞
                        animateCounter(el, parseInt(el.textContent) || 0, parseInt(newStats[stat]) || 0);
                    }
                });

                showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'danger');
            }
        }

        // –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
        async function testDBConnection() {
            try {
                const response = await fetch('?ajax=test_db');
                const result = await response.json();

                if (result.status === 'connected') {
                    showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + result.message, 'danger');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'danger');
            }
        }

        // –ü–æ–º–æ—â—å –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ë–î
        function showDBSetupHelp() {
            const modal = new bootstrap.Modal(document.createElement('div'));
            const modalHtml = `
                <div class="modal fade" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <h6>1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: <code>../config/database.php</code></h6>
                                <pre class="bg-light p-3 rounded"><code>&lt;?php
return [
    'host' => 'localhost',
    'database' => 'aquasbor',
    'username' => 'root',
    'password' => ''
];
?&gt;</code></pre>

                                <h6 class="mt-4">2. –î–ª—è shared —Ö–æ—Å—Ç–∏–Ω–≥–∞ –æ–±—ã—á–Ω–æ:</h6>
                                <ul>
                                    <li>Host: localhost</li>
                                    <li>Database: dizain9n_gerakl</li>
                                    <li>Username: dizain9n_gerakl</li>
                                    <li>Password: Akva123</li>
                                </ul>

                                <h6 class="mt-4">3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å —Ö–æ—Å—Ç–∏–Ω–≥–∞</h6>
                                <p>–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                                <button type="button" class="btn btn-primary" onclick="testDBConnection()">
                                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = modalHtml;
            const modalElement = tempDiv.firstElementChild;
            document.body.appendChild(modalElement);

            const bsModal = new bootstrap.Modal(modalElement);
            bsModal.show();

            modalElement.addEventListener('hidden.bs.modal', function() {
                modalElement.remove();
            });
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞
        function animateCounter(element, start, end, duration = 1000) {
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;

            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 16);
        }

        // AJAX –∑–∞–ø—Ä–æ—Å—ã
        async function ajaxRequest(action, data = {}) {
            try {
                const url = new URL(window.location);
                url.searchParams.set('ajax', action);

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                return await response.json();
            } catch (error) {
                console.error('AJAX –æ—à–∏–±–∫–∞:', error);
                throw error;
            }
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message, type = 'info', duration = 5000) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 350px; max-width: 500px;';

            const icons = {
                'success': 'check-circle',
                'danger': 'exclamation-triangle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };

            alertDiv.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="bi bi-${icons[type] || 'info-circle'} me-2 fs-5"></i>
                    <div>${message}</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, duration);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        function formatNumber(num) {
            return new Intl.NumberFormat('ru-RU').format(num);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB'
            }).format(amount);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData(type, data) {
            if (!dbConnected) {
                showNotification('–≠–∫—Å–ø–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –ë–î –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞', 'warning');
                return;
            }

            showNotification('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        document.addEventListener('hidden.bs.modal', function() {
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => backdrop.remove());
            document.body.style.overflow = 'auto';
            document.body.style.paddingRight = '0px';
        });

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            // Ctrl+Shift+D - –î–∞—à–±–æ—Ä–¥
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                window.location.href = '?page=dashboard';
            }

            // Ctrl+Shift+P - –¢–æ–≤–∞—Ä—ã
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                window.location.href = '?page=products';
            }

            // Ctrl+Shift+O - –ó–∞–∫–∞–∑—ã
            if (e.ctrlKey && e.shiftKey && e.key === 'O') {
                e.preventDefault();
                window.location.href = '?page=orders';
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');

            if (window.innerWidth <= 768 && sidebar.classList.contains('show')) {
                if (!sidebar.contains(e.target) && !e.target.closest('[onclick="toggleSidebar()"]')) {
                    sidebar.classList.remove('show');
                }
            }
        });

        console.log('üöÄ –ê–∫–≤–∞–°–±–æ—Ä –ê–¥–º–∏–Ω JS –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
</body>
</html>
