<?php
/**
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * MODULE METADATA
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * @module_id       design
 * @module_name     üé® –î–∏–∑–∞–π–Ω
 * @module_icon     fas fa-palette
 * @module_order    100
 * @module_version  1.0.0
 * @module_author   –ê—Ä—Ç—ë–º
 * @module_enabled  true
 * @module_access   admin
 * @module_description –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 */

if (!defined('ADMIN_CORE_LOADED')) {
    die('Direct access not allowed');
}
?>

<div class='row'>
  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
  <div class='card'>
    <h3 style='margin-bottom:20px'>üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∞–π—Ç–∞</h3>

    <h4 style='margin-bottom:12px'>–õ–æ–≥–æ—Ç–∏–ø</h4>
    <form method='post' enctype='multipart/form-data' id='logoForm'>
      <input type='hidden' name='admin_upload' value='1'>
      <input type='hidden' name='what' value='logo'>
      <div class='drop <?=!empty($cfg['logo']) ? 'has-image' : ''?>' id='logoDrop'>
        <input type='file' name='file' accept='image/*' onchange='handleFileUpload(this, "logoDrop", "logoForm")'>
        <button type='button' class='drop-remove' onclick='removeImage("logoDrop", "logo")'>‚úï</button>
        <div class='drop-content'>
          <?php if(!empty($cfg['logo'])): ?>
            <img src='<?=esc($cfg['logo'])?>' class='drop-preview' alt='–õ–æ–≥–æ—Ç–∏–ø'>
            <div class='drop-text'>–õ–æ–≥–æ—Ç–∏–ø –∑–∞–≥—Ä—É–∂–µ–Ω</div>
            <div class='drop-hint'>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–º–µ–Ω—ã</div>
          <?php else: ?>
            <div class='drop-icon'>üñºÔ∏è</div>
            <div class='drop-text'>–ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø</div>
            <div class='drop-hint'>PNG, JPG, SVG –¥–æ 10 –ú–ë</div>
          <?php endif; ?>
        </div>
      </div>
    </form>

    <h4 style='margin-top:24px;margin-bottom:12px'>Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h4>
    <form method='post' enctype='multipart/form-data' id='heroForm'>
      <input type='hidden' name='admin_upload' value='1'>
      <input type='hidden' name='what' value='hero'>
      <div class='drop <?=($cfg['hero_mode']==='image'&&!empty($cfg['hero_image'])) ? 'has-image' : ''?>' id='heroDrop'>
        <input type='file' name='file' accept='image/*' onchange='handleFileUpload(this, "heroDrop", "heroForm")'>
        <button type='button' class='drop-remove' onclick='removeImage("heroDrop", "hero")'>‚úï</button>
        <div class='drop-content'>
          <?php if($cfg['hero_mode']==='image'&&!empty($cfg['hero_image'])): ?>
            <img src='<?=esc($cfg['hero_image'])?>' class='drop-preview' alt='Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'>
            <div class='drop-text'>Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</div>
            <div class='drop-hint'>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–º–µ–Ω—ã</div>
          <?php else: ?>
            <div class='drop-icon'>üé®</div>
            <div class='drop-text'>–ó–∞–≥—Ä—É–∑–∏—Ç—å hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
            <div class='drop-hint'>PNG, JPG –¥–æ 10 –ú–ë</div>
          <?php endif; ?>
        </div>
      </div>
    </form>
  </div>

  <!-- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ -->
  <div class='card'>
    <h3 style='margin-bottom:20px'>üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –∏ —Å—Ç–∏–ª–∏</h3>
    <form method='post'>
      <div class='form-row'>
        <div class='form-group'>
          <label>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –±—Ä–µ–Ω–¥–∞</label>
          <input type='color' name='theme[brand]' value='<?=esc($cfg['theme']['brand'])?>'>
        </div>
        <div class='form-group'>
          <label>–ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç</label>
          <input type='color' name='theme[accent]' value='<?=esc($cfg['theme']['accent'])?>'>
        </div>
      </div>

      <div class='form-row'>
        <div class='form-group'>
          <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
          <input type='color' name='theme[bg]' value='<?=esc($cfg['theme']['bg'])?>'>
        </div>
        <div class='form-group'>
          <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
          <input type='color' name='theme[text]' value='<?=esc($cfg['theme']['text'])?>'>
        </div>
      </div>

      <div class='form-group'>
        <label>–¶–≤–µ—Ç –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞</label>
        <input type='color' name='theme[muted]' value='<?=esc($cfg['theme']['muted'])?>'>
      </div>

      <h4 style='margin-top:24px;margin-bottom:12px'>–≠—Ñ—Ñ–µ–∫—Ç—ã –∏ —Ä–∞–∑–º–µ—Ä—ã</h4>
      <div class='form-row'>
        <div class='form-group'>
          <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–µ–∫: <strong><?=esc($cfg['theme']['card_opacity'])?></strong></label>
          <input type='range' name='theme[card_opacity]' min='0.3' max='1' step='0.05' value='<?=esc($cfg['theme']['card_opacity'])?>' oninput='this.previousElementSibling.querySelector("strong").textContent=this.value'>
        </div>
        <div class='form-group'>
          <label>–†–∞–∑–º—ã—Ç–∏–µ —Å—Ç–µ–∫–ª–∞: <strong><?=esc($cfg['theme']['blur'])?>px</strong></label>
          <input type='range' name='theme[blur]' min='0' max='30' value='<?=esc($cfg['theme']['blur'])?>' oninput='this.previousElementSibling.querySelector("strong").textContent=this.value+"px"'>
        </div>
      </div>

      <div class='form-row'>
        <div class='form-group'>
          <label>–†–∞–¥–∏—É—Å —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è: <strong><?=esc($cfg['theme']['radius'])?>px</strong></label>
          <input type='range' name='theme[radius]' min='0' max='28' value='<?=esc($cfg['theme']['radius'])?>' oninput='this.previousElementSibling.querySelector("strong").textContent=this.value+"px"'>
        </div>
        <div class='form-group'>
          <label>–°–∏–ª–∞ —Ç–µ–Ω–µ–π: <strong><?=esc($cfg['theme']['shadow'])?></strong></label>
          <input type='range' name='theme[shadow]' min='0' max='0.5' step='0.01' value='<?=esc($cfg['theme']['shadow'])?>' oninput='this.previousElementSibling.querySelector("strong").textContent=this.value'>
        </div>
      </div>

      <div class='form-group'>
        <label>–®–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: <strong><?=esc($cfg['theme']['container'])?>px</strong></label>
        <input type='range' name='theme[container]' min='900' max='1400' step='50' value='<?=esc($cfg['theme']['container'])?>' oninput='this.previousElementSibling.querySelector("strong").textContent=this.value+"px"'>
      </div>

      <button class='btn-success' name='admin_save' value='1'>üé® –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
    </form>
  </div>
</div>

<style>
/* Drag&Drop –°—Ç–∏–ª–∏ */
.drop{
  position:relative;
  display:grid;
  place-items:center;
  min-height:150px;
  border:2px dashed rgba(255,255,255,.25);
  border-radius:10px;
  background:#0f1624;
  cursor:pointer;
  transition:all 0.3s;
  margin-bottom:20px;
}
.drop.hover{
  background:#0c1220;
  border-color:var(--brand);
}
.drop input[type=file]{
  position:absolute;
  inset:0;
  opacity:0;
  cursor:pointer;
}
.drop-content{
  text-align:center;
  pointer-events:none;
}
.drop-icon{
  font-size:32px;
  margin-bottom:8px;
  opacity:0.7;
}
.drop-text{
  font-size:14px;
  font-weight:600;
  margin-bottom:4px;
}
.drop-hint{
  font-size:11px;
  opacity:0.6;
}
.drop.has-image{
  border-style:solid;
  border-color:var(--brand);
}
.drop-preview{
  max-width:100%;
  max-height:100px;
  border-radius:6px;
  margin-bottom:8px;
}
.drop-remove{
  position:absolute;
  top:8px;
  right:8px;
  background:rgba(255,0,0,.8);
  color:#fff;
  border:none;
  border-radius:50%;
  width:28px;
  height:28px;
  cursor:pointer;
  font-size:14px;
  display:none;
  z-index:10;
}
.drop.has-image .drop-remove{
  display:block;
}
</style>

<script>
function handleFileUpload(input, dropId, formId) {
  if (input.files && input.files[0]) {
    const file = input.files[0];
    const drop = document.getElementById(dropId);
    const form = document.getElementById(formId);

    if (file.size > 10 * 1024 * 1024) {
      alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 10 –ú–ë.');
      input.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const content = drop.querySelector('.drop-content');
      content.innerHTML = `
        <img src='${e.target.result}' class='drop-preview' alt='–ü—Ä–µ–≤—å—é'>
        <div class='drop-text'>–§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ</div>
        <div class='drop-hint'>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–º–µ–Ω—ã</div>
      `;
      drop.classList.add('has-image');
    };
    reader.readAsDataURL(file);

    setTimeout(() => {
      form.submit();
    }, 500);
  }
}

function removeImage(dropId, type) {
  if (confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) {
    const drop = document.getElementById(dropId);

    if (type === 'logo') {
      drop.querySelector('.drop-content').innerHTML = `
        <div class='drop-icon'>üñºÔ∏è</div>
        <div class='drop-text'>–ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø</div>
        <div class='drop-hint'>PNG, JPG, SVG –¥–æ 10 –ú–ë</div>
      `;
    } else {
      drop.querySelector('.drop-content').innerHTML = `
        <div class='drop-icon'>üé®</div>
        <div class='drop-text'>–ó–∞–≥—Ä—É–∑–∏—Ç—å hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
        <div class='drop-hint'>PNG, JPG –¥–æ 10 –ú–ë</div>
      `;
    }

    drop.classList.remove('has-image');

    const form = new FormData();
    form.append('admin_save', '1');
    form.append(type === 'logo' ? 'logo' : 'hero_image', '');
    form.append(type === 'logo' ? 'logo' : 'hero_mode', type === 'logo' ? '' : 'svg');

    fetch(location.href, {
      method: 'POST',
      body: form
    }).then(() => {
      location.reload();
    });
  }
}

document.querySelectorAll('.drop').forEach(drop => {
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    drop.addEventListener(eventName, preventDefaults, false);
  });

  ['dragenter', 'dragover'].forEach(eventName => {
    drop.addEventListener(eventName, () => drop.classList.add('hover'), false);
  });

  ['dragleave', 'drop'].forEach(eventName => {
    drop.addEventListener(eventName, () => drop.classList.remove('hover'), false);
  });

  drop.addEventListener('drop', handleDrop, false);
});

function preventDefaults(e) {
  e.preventDefault();
  e.stopPropagation();
}

function handleDrop(e) {
  const dt = e.dataTransfer;
  const files = dt.files;
  const input = e.target.querySelector('input[type="file"]');

  if (files.length > 0) {
    input.files = files;
    const changeEvent = new Event('change', { bubbles: true });
    input.dispatchEvent(changeEvent);
  }
}
</script>
