<?php
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–∑–≤–∞–Ω –ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä —á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å
$is_editor_mode = isset($_REQUEST['editor_mode']) && $_REQUEST['editor_mode'];
$from_products = isset($_REQUEST['from_products']) && $_REQUEST['from_products'];

// –ü–æ–ª—É—á–∞–µ–º ID —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
$product_id = $_GET['id'] ?? $_POST['product_id'] ?? $_REQUEST['product_id'] ?? null;

// –ï—Å–ª–∏ –µ—Å—Ç—å ID —Ç–æ–≤–∞—Ä–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
$product_data = null;
if ($product_id) {
    if (function_exists('getProductById')) {
        $product_data = getProductById($product_id);
    } else {
        // –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        $demo_products = [
            1 => [
                'id' => 1,
                'name' => '–ê–Ω—É–±–∏–∞—Å –Ω–∞–Ω–∞ - –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–æ–µ –∞–∫–≤–∞—Ä–∏—É–º–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ',
                'latin_name' => 'Anubias barteri var. nana',
                'description' => '–ù–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–æ–µ –º–µ–¥–ª–µ–Ω–Ω–æ—Ä–∞—Å—Ç—É—â–µ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –∂–µ—Å—Ç–∫–∏–º–∏ —Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∞–∫–≤–∞—Ä–∏—É–º–∏—Å—Ç–æ–≤. –†–∞—Å—Ç–µ—Ç –ø—Ä–∏ —Å–ª–∞–±–æ–º –æ—Å–≤–µ—â–µ–Ω–∏–∏, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∞—á–∏ CO2. –ú–æ–∂–Ω–æ –∫—Ä–µ–ø–∏—Ç—å –∫ –∫–æ—Ä—è–≥–∞–º –∏ –∫–∞–º–Ω—è–º.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚Ä¢ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –≤ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏
‚Ä¢ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –∞–∫–≤–∞—Ä–∏—É–º–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
‚Ä¢ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–µ—Å–Ω–æ–≤–æ–¥–Ω—ã—Ö –∞–∫–≤–∞—Ä–∏—É–º–æ–≤

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏ –∏ –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ –æ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π.',
                'short_description' => '–ù–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–æ–µ –∞–∫–≤–∞—Ä–∏—É–º–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –ø–ª–∞–Ω–∞',
                'price' => 450,
                'old_price' => 600,
                'category_id' => 1,
                'sku' => 'PLT_ANU_9876',
                'stock_quantity' => 15,
                'status' => 1,
                'main_image' => 'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400&h=400&fit=crop',
                'gallery' => [
                    'https://images.unsplash.com/photo-1535591273668-578e31182c4f?w=300&h=300&fit=crop',
                    'https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=300&h=300&fit=crop',
                    'https://images.unsplash.com/photo-1524704654690-b56c05c78a00?w=300&h=300&fit=crop'
                ],
                'badges' => ['recommend', 'discount', 'eco'],
                'tags' => '–∞–Ω—É–±–∏–∞—Å, –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ, –º–µ–¥–ª–µ–Ω–Ω–æ—Ä–∞—Å—Ç—É—â–∏–µ, —Ç–µ–Ω–µ–ª—é–±–∏–≤—ã–µ, –ø–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω',
                'size' => '10-15 —Å–º',
                'temperature' => '20-28¬∞C',
                'ph_level' => '6.0-8.0',
                'lighting' => '—Å–ª–∞–±–æ–µ',
                'difficulty' => '–ª–µ–≥–∫–æ',
                'meta_title' => '–ê–Ω—É–±–∏–∞—Å –Ω–∞–Ω–∞ - –∫—É–ø–∏—Ç—å –≤ –ê–∫–≤–∞–°–±–æ—Ä –æ—Ç 450 —Ä—É–±',
                'meta_description' => '–ê–Ω—É–±–∏–∞—Å –Ω–∞–Ω–∞ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –†–∞—Å—Ç–µ–Ω–∏—è. –õ—É—á—à–∏–µ —Ü–µ–Ω—ã, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã, –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞. –ó–∞–∫–∞–∑–∞—Ç—å –ê–Ω—É–±–∏–∞—Å –Ω–∞–Ω–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–µ –ê–∫–≤–∞–°–±–æ—Ä.'
            ]
        ];
        $product_data = $demo_products[$product_id] ?? null;
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_product'])) {
    $success = false;
    $error_message = '';

    try {
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞
        $productData = [
            'id' => $product_id,
            'name' => $_POST['name'] ?? '',
            'latin_name' => $_POST['latin_name'] ?? '',
            'description' => $_POST['description'] ?? '',
            'short_description' => $_POST['short_description'] ?? '',
            'price' => floatval($_POST['price'] ?? 0),
            'old_price' => floatval($_POST['old_price'] ?? 0),
            'category_id' => intval($_POST['category_id'] ?? 0),
            'sku' => $_POST['sku'] ?? '',
            'stock_quantity' => intval($_POST['stock_quantity'] ?? 0),
            'status' => intval($_POST['status'] ?? 1),
            'main_image' => $_POST['main_image'] ?? '',
            'gallery' => json_decode($_POST['gallery'] ?? '[]', true),
            'badges' => json_decode($_POST['badges'] ?? '[]', true),
            'tags' => $_POST['tags'] ?? '',
            'size' => $_POST['size'] ?? '',
            'temperature' => $_POST['temperature'] ?? '',
            'ph_level' => $_POST['ph_level'] ?? '',
            'lighting' => $_POST['lighting'] ?? '',
            'difficulty' => $_POST['difficulty'] ?? '',
            'meta_title' => $_POST['meta_title'] ?? '',
            'meta_description' => $_POST['meta_description'] ?? ''
        ];

        // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è saveProduct —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
        if (function_exists('saveProduct')) {
            $result = saveProduct($productData);
            if ($result['success']) {
                $success = true;
                $new_product_id = $result['product_id'];
                $success_message = "–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω! ID: $new_product_id";

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Ñ–æ—Ä–º—ã
                $product_data = $productData;
                $product_data['id'] = $new_product_id;
                $product_id = $new_product_id;
            } else {
                $error_message = $result['error'] ?? '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
            }
        } else {
            // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            error_log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ' . json_encode($productData));
            $success = true;
            $new_product_id = $product_id ?: rand(1000, 9999);
            $success_message = "–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω! ID: $new_product_id";

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Ñ–æ—Ä–º—ã
            $product_data = $productData;
            $product_data['id'] = $new_product_id;
            $product_id = $new_product_id;
        }

    } catch (Exception $e) {
        $error_message = $e->getMessage();
    }
}

// –ë–∞–∑–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞
if (!function_exists('getCategories')) {
    function getCategories() {
        return [
            ['id' => 1, 'name' => '–†–∞—Å—Ç–µ–Ω–∏—è'],
            ['id' => 2, 'name' => '–†—ã–±–∫–∏'],
            ['id' => 3, 'name' => '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ'],
            ['id' => 4, 'name' => '–î–µ–∫–æ—Ä'],
            ['id' => 5, 'name' => '–ö–æ—Ä–º–∞'],
            ['id' => 6, 'name' => '–•–∏–º–∏—è –¥–ª—è –≤–æ–¥—ã']
        ];
    }
}

$categories = getCategories();

// –ï—Å–ª–∏ –Ω–µ—Ç ID —Ç–æ–≤–∞—Ä–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
if (!$product_id) {
    ?>
    <div class='page-header'>
        <div class='d-flex justify-content-between align-items-center'>
            <div>
                <h1 class='h3 mb-1 text-gray-800'>
                    <i class='fas fa-edit me-2 text-primary'></i>–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤
                </h1>
                <p class='text-muted mb-0'>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π</p>
            </div>
            <div>
                <a href='?page=products' class='btn btn-secondary me-2'>
                    <i class='fas fa-list me-1'></i>–í—Å–µ —Ç–æ–≤–∞—Ä—ã
                </a>
                <a href='?page=add_product' class='btn btn-success'>
                    <i class='fas fa-plus me-1'></i>–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä
                </a>
            </div>
        </div>
    </div>

    <div class='content-card'>
        <h4 class='mb-4'>
            <i class='fas fa-search me-2'></i>–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
        </h4>

        <div class='row mb-4'>
            <div class='col-md-8'>
                <div class='input-group'>
                    <input type='text' class='form-control' id='productSearch' placeholder='–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...'>
                    <button class='btn btn-outline-secondary' type='button' onclick='searchProducts()'>
                        <i class='fas fa-search'></i>
                    </button>
                </div>
            </div>
            <div class='col-md-4'>
                <select class='form-select' id='categoryFilter' onchange='filterByCategory()'>
                    <option value=''>–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    <?php foreach ($categories as $category): ?>
                        <option value='<?= $category['id'] ?>'><?= htmlspecialchars($category['name']) ?></option>
                    <?php endforeach; ?>
                </select>
            </div>
        </div>

        <!-- –î–µ–º–æ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ -->
        <div class='row' id='productsList'>
            <div class='col-lg-4 col-md-6 mb-4'>
                <div class='card h-100 border-0 shadow-sm product-card' onclick='editProduct(1)' style='cursor: pointer;'>
                    <div class='card-img-top' style='height: 200px; background: linear-gradient(45deg, #f8f9fc, #e2e6ea); display: flex; align-items: center; justify-content: center;'>
                        <img src='https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=300&h=200&fit=crop' 
                             alt='–ê–Ω—É–±–∏–∞—Å –Ω–∞–Ω–∞' class='img-fluid rounded' style='max-height: 180px;'>
                    </div>
                    <div class='card-body'>
                        <h6 class='card-title'>–ê–Ω—É–±–∏–∞—Å –Ω–∞–Ω–∞</h6>
                        <p class='card-text text-muted small'>–ù–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–æ–µ –∞–∫–≤–∞—Ä–∏—É–º–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ</p>
                        <div class='d-flex justify-content-between align-items-center'>
                            <div>
                                <span class='text-success fw-bold'>450 ‚ÇΩ</span>
                                <small class='text-muted text-decoration-line-through ms-1'>600 ‚ÇΩ</small>
                            </div>
                            <div>
                                <span class='badge bg-success me-1'>‚≠ê –¢–û–ü</span>
                                <span class='badge bg-info'>üí∏ -25%</span>
                            </div>
                        </div>
                    </div>
                    <div class='card-footer bg-transparent border-0 pt-0'>
                        <button class='btn btn-primary btn-sm w-100'>
                            <i class='fas fa-edit me-1'></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>

            <div class='col-lg-4 col-md-6 mb-4'>
                <div class='card h-100 border-0 shadow-sm product-card' onclick='editProduct(2)' style='cursor: pointer;'>
                    <div class='card-img-top' style='height: 200px; background: linear-gradient(45deg, #f8f9fc, #e2e6ea); display: flex; align-items: center; justify-content: center;'>
                        <img src='https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=300&h=200&fit=crop' 
                             alt='–ì—É–ø–ø–∏' class='img-fluid rounded' style='max-height: 180px;'>
                    </div>
                    <div class='card-body'>
                        <h6 class='card-title'>–ì—É–ø–ø–∏ –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω–∞—è</h6>
                        <p class='card-text text-muted small'>–Ø—Ä–∫–∞—è –∂–∏–≤–æ—Ä–æ–¥—è—â–∞—è —Ä—ã–±–∫–∞</p>
                        <div class='d-flex justify-content-between align-items-center'>
                            <div>
                                <span class='text-success fw-bold'>150 ‚ÇΩ</span>
                            </div>
                            <div>
                                <span class='badge bg-warning text-dark'>üÜï –ù–æ–≤–∏–Ω–∫–∞</span>
                            </div>
                        </div>
                    </div>
                    <div class='card-footer bg-transparent border-0 pt-0'>
                        <button class='btn btn-primary btn-sm w-100'>
                            <i class='fas fa-edit me-1'></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>

            <div class='col-lg-4 col-md-6 mb-4'>
                <div class='card h-100 border-0 shadow-sm product-card' onclick='editProduct(3)' style='cursor: pointer;'>
                    <div class='card-img-top' style='height: 200px; background: linear-gradient(45deg, #f8f9fc, #e2e6ea); display: flex; align-items: center; justify-content: center;'>
                        <img src='https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=300&h=200&fit=crop' 
                             alt='–§–∏–ª—å—Ç—Ä' class='img-fluid rounded' style='max-height: 180px;'>
                    </div>
                    <div class='card-body'>
                        <h6 class='card-title'>–§–∏–ª—å—Ç—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π</h6>
                        <p class='card-text text-muted small'>–°–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ –≤–æ–¥—ã</p>
                        <div class='d-flex justify-content-between align-items-center'>
                            <div>
                                <span class='text-success fw-bold'>1200 ‚ÇΩ</span>
                            </div>
                            <div>
                                <span class='badge bg-dark'>üíé –ü—Ä–µ–º–∏—É–º</span>
                            </div>
                        </div>
                    </div>
                    <div class='card-footer bg-transparent border-0 pt-0'>
                        <button class='btn btn-primary btn-sm w-100'>
                            <i class='fas fa-edit me-1'></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class='text-center py-5' id='noProducts' style='display: none;'>
            <div class='mb-4'>
                <i class='fas fa-search fa-4x text-muted mb-3'></i>
                <h4 class='text-muted'>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                <p class='text-muted'>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</p>
            </div>
            <a href='?page=add_product' class='btn btn-primary'>
                <i class='fas fa-plus me-1'></i>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
            </a>
        </div>
    </div>

    <style>
    .product-card {
        transition: all 0.3s ease;
        border-radius: 12px !important;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }

    .card-img-top {
        border-radius: 12px 12px 0 0 !important;
    }

    .content-card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border: 1px solid #E2E8F0;
    }
    </style>

    <script>
    function editProduct(id) {
        window.location.href = '?page=product_editor&id=' + id;
    }

    function searchProducts() {
        const query = document.getElementById('productSearch').value.toLowerCase();
        const products = document.querySelectorAll('.product-card');
        let visibleCount = 0;

        products.forEach(product => {
            const title = product.querySelector('.card-title').textContent.toLowerCase();
            const description = product.querySelector('.card-text').textContent.toLowerCase();

            if (title.includes(query) || description.includes(query)) {
                product.parentElement.style.display = 'block';
                visibleCount++;
            } else {
                product.parentElement.style.display = 'none';
            }
        });

        document.getElementById('noProducts').style.display = visibleCount === 0 ? 'block' : 'none';
    }

    function filterByCategory() {
        const category = document.getElementById('categoryFilter').value;
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        console.log('–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', category);
    }

    // –ü–æ–∏—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    document.getElementById('productSearch').addEventListener('input', function() {
        searchProducts();
    });
    </script>

    <?php
    return; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
}
?>

<!DOCTYPE html>
<html lang='ru'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title><?= $product_data ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' : '–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä' ?> - –ò–ò –†–µ–¥–∞–∫—Ç–æ—Ä</title>
</head>
<body>

<!-- –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
<?php if (isset($success_message)): ?>
<script>
document.addEventListener('DOMContentLoaded', function() {
    showNotification('‚úÖ <?= addslashes($success_message) ?>', 'success', 5000);

    // –†–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –µ—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
    <?php if ($from_products): ?>
    setTimeout(function() {
        if (confirm('–¢–æ–≤–∞—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤?')) {
            window.location.href = '?page=products';
        }
    }, 3000);
    <?php endif; ?>
});
</script>
<?php endif; ?>

<?php if (isset($error_message) && $error_message): ?>
<script>
document.addEventListener('DOMContentLoaded', function() {
    showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: <?= addslashes($error_message) ?>', 'error', 8000);
});
</script>
<?php endif; ?>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–±—Ä–æ—Å–∞ -->
<div class='modal fade' id='confirmResetModal' tabindex='-1'>
    <div class='modal-dialog'>
        <div class='modal-content'>
            <div class='modal-header bg-warning text-dark'>
                <h5 class='modal-title'>
                    <i class='fas fa-exclamation-triangle me-2'></i>üóëÔ∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–±—Ä–æ—Å–∞
                </h5>
                <button type='button' class='btn-close' data-bs-dismiss='modal'></button>
            </div>
            <div class='modal-body'>
                <p class='mb-3'><strong>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é —Ñ–æ—Ä–º—É?</strong></p>
                <div class='alert alert-warning'>
                    <i class='fas fa-exclamation-circle me-2'></i>–í—Å–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!
                </div>
                <p class='text-muted'>üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫.</p>
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>
                    <i class='fas fa-times me-1'></i>–û—Ç–º–µ–Ω–∞
                </button>
                <button type='button' class='btn btn-outline-info me-2' onclick='saveAsDraft(); bootstrap.Modal.getInstance(document.getElementById("confirmResetModal")).hide();'>
                    <i class='fas fa-save me-1'></i>–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
                </button>
                <button type='button' class='btn btn-danger' onclick='confirmReset(); bootstrap.Modal.getInstance(document.getElementById("confirmResetModal")).hide();'>
                    <i class='fas fa-trash me-1'></i>–î–∞, –æ—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                </button>
            </div>
        </div>
    </div>
</div>

<div class='page-header'>
    <div class='d-flex justify-content-between align-items-center'>
        <div>
            <h1 class='h3 mb-1 text-gray-800'>
                üöÄ <?= $product_data ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' : '–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä' ?> —Å –ò–ò
            </h1>
            <nav aria-label='breadcrumb'>
                <ol class='breadcrumb'>
                    <li class='breadcrumb-item'><a href='?page=dashboard'>–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li class='breadcrumb-item'><a href='?page=products'>–¢–æ–≤–∞—Ä—ã</a></li>
                    <li class='breadcrumb-item active'><?= $product_data ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä' : '–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä' ?></li>
                </ol>
            </nav>
        </div>
        <div>
            <a href='?page=products' class='btn btn-secondary me-2'>
                <i class='fas fa-arrow-left me-1'></i>–ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º
            </a>
            <a href='?page=product_editor' class='btn btn-info me-2'>
                <i class='fas fa-list me-1'></i>–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ç–æ–≤–∞—Ä
            </a>
            <button class='btn btn-success' onclick='previewProduct()'>
                <i class='fas fa-eye me-1'></i>–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞
            </button>
        </div>
    </div>
</div>

<!-- –ò–ò –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id='aiNotifications'></div>

<div class='row'>
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
    <div class='col-xl-8 col-lg-7'>
        <form id='productForm' method='POST' action=''>
            <input type='hidden' name='save_product' value='1'>
            <input type='hidden' id='productId' name='product_id' value='<?= htmlspecialchars($product_id ?? '') ?>'>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class='card shadow mb-4'>
                <div class='card-header py-3 d-flex justify-content-between align-items-center'>
                    <h6 class='m-0 font-weight-bold text-primary'>
                        <i class='fas fa-info-circle me-2'></i>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    </h6>
                    <div class='dropdown'>
                        <button class='btn btn-sm btn-outline-primary dropdown-toggle' type='button' data-bs-toggle='dropdown'>
                            <i class='fas fa-robot me-1'></i>–ò–ò –ü–æ–º–æ—â–Ω–∏–∫
                        </button>
                        <div class='dropdown-menu'>
                            <a class='dropdown-item' href='#' onclick='aiGenerateAll()'>
                                <i class='fas fa-magic me-2'></i>–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                            </a>
                            <a class='dropdown-item' href='#' onclick='aiSuggestName()'>
                                <i class='fas fa-tag me-2'></i>–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
                            </a>
                            <a class='dropdown-item' href='#' onclick='showTemplates()'>
                                <i class='fas fa-file-template me-2'></i>–®–∞–±–ª–æ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤
                            </a>
                        </div>
                    </div>
                </div>
                <div class='card-body'>
                    <div class='row'>
                        <div class='col-md-8'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>
                                    –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ <span class='text-danger'>*</span>
                                    <i class='fas fa-question-circle text-muted ms-1' title='–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'></i>
                                </label>
                                <input type='text' class='form-control form-control-lg' name='name' id='productName' required
                                       placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω—É–±–∏–∞—Å –Ω–∞–Ω–∞ - –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–æ–µ –∞–∫–≤–∞—Ä–∏—É–º–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ'
                                       value='<?= htmlspecialchars($product_data['name'] ?? '') ?>'>
                                <div class='form-text d-flex justify-content-between'>
                                    <span>–°–∏–º–≤–æ–ª–æ–≤: <span id='nameLength' class='fw-bold text-primary'>0</span>/100</span>
                                    <span id='nameSeoScore' class='text-muted'>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</span>
                                </div>
                            </div>
                        </div>
                        <div class='col-md-4'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>–ê—Ä—Ç–∏–∫—É–ª (SKU)</label>
                                <div class='input-group'>
                                    <input type='text' class='form-control' name='sku' id='productSKU'
                                           placeholder='–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è' value='<?= htmlspecialchars($product_data['sku'] ?? '') ?>'>
                                    <button type='button' class='btn btn-outline-secondary' onclick='generateSKU()' title='–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ç–∏–∫—É–ª'>
                                        <i class='fas fa-sync'></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class='col-md-4'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è <span class='text-danger'>*</span></label>
                                <select class='form-select' name='category_id' id='productCategory' required>
                                    <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                    <?php foreach ($categories as $category): ?>
                                        <option value='<?= $category['id'] ?>'
                                            <?= ($product_data['category_id'] ?? '') == $category['id'] ? 'selected' : '' ?>>
                                            <?= htmlspecialchars($category['name']) ?>
                                        </option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                        </div>
                        <div class='col-md-4'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>
                                    –¶–µ–Ω–∞ <span class='text-danger'>*</span>
                                    <button type='button' class='btn btn-sm btn-outline-warning ms-1' onclick='aiSuggestPrice()' title='–ò–ò –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É'>
                                        <i class='fas fa-robot'></i>
                                    </button>
                                </label>
                                <div class='input-group'>
                                    <input type='number' class='form-control' name='price' id='productPrice' required
                                           min='0' step='0.01' placeholder='0' value='<?= $product_data['price'] ?? '' ?>'>
                                    <span class='input-group-text'>‚ÇΩ</span>
                                </div>
                            </div>
                        </div>
                        <div class='col-md-4'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (–¥–ª—è —Å–∫–∏–¥–∫–∏)</label>
                                <div class='input-group'>
                                    <input type='number' class='form-control' name='old_price' id='productOldPrice'
                                           min='0' step='0.01' placeholder='0' value='<?= $product_data['old_price'] ?? '' ?>'>
                                    <span class='input-group-text'>‚ÇΩ</span>
                                </div>
                                <div class='form-text text-muted' id='discountInfo'>
                                    <small>–£–∫–∞–∂–∏—Ç–µ —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class='row'>
                        <div class='col-md-6'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>–õ–∞—Ç–∏–Ω—Å–∫–æ–µ/–Ω–∞—É—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                                <input type='text' class='form-control' name='latin_name' id='productLatinName'
                                       placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: Anubias barteri var. nana' value='<?= htmlspecialchars($product_data['latin_name'] ?? '') ?>'>
                            </div>
                        </div>
                        <div class='col-md-3'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>–°–ª–æ–∂–Ω–æ—Å—Ç—å —É—Ö–æ–¥–∞</label>
                                <select class='form-select' name='difficulty'>
                                    <option value='–ª–µ–≥–∫–æ' <?= ($product_data['difficulty'] ?? '') == '–ª–µ–≥–∫–æ' ? 'selected' : '' ?>>üü¢ –õ–µ–≥–∫–æ</option>
                                    <option value='—Å—Ä–µ–¥–Ω–µ' <?= ($product_data['difficulty'] ?? '') == '—Å—Ä–µ–¥–Ω–µ' ? 'selected' : '' ?>>üü° –°—Ä–µ–¥–Ω–µ</option>
                                    <option value='—Å–ª–æ–∂–Ω–æ' <?= ($product_data['difficulty'] ?? '') == '—Å–ª–æ–∂–Ω–æ' ? 'selected' : '' ?>>üî¥ –°–ª–æ–∂–Ω–æ</option>
                                    <option value='—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π' <?= ($product_data['difficulty'] ?? '') == '—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π' ? 'selected' : '' ?>>üü£ –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π</option>
                                </select>
                            </div>
                        </div>
                        <div class='col-md-3'>
                            <div class='form-group mb-3'>
                                <label class='form-label fw-semibold'>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ</label>
                                <input type='number' class='form-control' name='stock_quantity'
                                       min='0' value='<?= $product_data['stock_quantity'] ?? '' ?>' placeholder='0'>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏—è -->
            <div class='card shadow mb-4'>
                <div class='card-header py-3 d-flex justify-content-between align-items-center'>
                    <h6 class='m-0 font-weight-bold text-primary'>
                        <i class='fas fa-file-text me-2'></i>–û–ø–∏—Å–∞–Ω–∏—è –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
                    </h6>
                    <div class='btn-group' role='group'>
                        <button type='button' class='btn btn-sm btn-outline-primary' onclick='aiGenerateDescription()'>
                            <i class='fas fa-robot me-1'></i>–ò–ò –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
                        </button>
                        <button type='button' class='btn btn-sm btn-outline-success' onclick='aiImproveDescription()'>
                            <i class='fas fa-magic me-1'></i>–£–ª—É—á—à–∏—Ç—å
                        </button>
                    </div>
                </div>
                <div class='card-body'>
                    <div class='form-group mb-3'>
                        <label class='form-label fw-semibold'>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class='form-control' name='short_description' id='productShortDescription' rows='2'
                                  placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ (–¥–æ 150 —Å–∏–º–≤–æ–ª–æ–≤)'><?= htmlspecialchars($product_data['short_description'] ?? '') ?></textarea>
                        <div class='form-text'>
                            <span>–°–∏–º–≤–æ–ª–æ–≤: <span id='shortDescLength'>0</span>/150</span>
                            <span class='ms-3 text-muted'>–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ —Ç–æ–≤–∞—Ä–æ–≤</span>
                        </div>
                    </div>

                    <div class='form-group mb-3'>
                        <label class='form-label fw-semibold'>
                            –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ <span class='text-danger'>*</span>
                            <button type='button' class='btn btn-sm btn-outline-warning ms-1' onclick='aiAnalyzeDescription()' title='–ò–ò –∞–Ω–∞–ª–∏–∑ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏'>
                                <i class='fas fa-search'></i>
                            </button>
                        </label>
                        <textarea class='form-control' name='description' id='productDescription' rows='8' required
                                  placeholder='–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...'><?= htmlspecialchars($product_data['description'] ?? '') ?></textarea>
                        <div class='form-text d-flex justify-content-between'>
                            <span>–°–∏–º–≤–æ–ª–æ–≤: <span id='descLength' class='fw-bold'>0</span></span>
                            <span>–ß–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å: <span id='readabilityScore' class='fw-bold text-muted'>-</span></span>
                            <span>SEO: <span id='seoAnalysis' class='fw-bold text-muted'>-</span></span>
                        </div>
                    </div>

                    <div class='form-group mb-0'>
                        <label class='form-label fw-semibold'>
                            –¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
                            <button type='button' class='btn btn-sm btn-outline-info ms-1' onclick='aiGenerateTags()' title='–ò–ò –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Ç–µ–≥–∏'>
                                <i class='fas fa-hashtag'></i>
                            </button>
                        </label>
                        <input type='text' class='form-control' name='tags' id='productTags'
                               placeholder='–∞–∫–≤–∞—Ä–∏—É–º, —Ä–∞—Å—Ç–µ–Ω–∏—è, –¥–µ–∫–æ—Ä, –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ'
                               value='<?= htmlspecialchars($product_data['tags'] ?? '') ?>'>
                        <div class='form-text'>–ü–æ–º–æ–≥–∞—é—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º –Ω–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫</div>
                    </div>
                </div>
            </div>

            <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º Drag & Drop -->
            <div class='card shadow mb-4'>
                <div class='card-header py-3 d-flex justify-content-between align-items-center'>
                    <h6 class='m-0 font-weight-bold text-primary'>
                        <i class='fas fa-images me-2'></i>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                    </h6>
                    <div class='dropdown'>
                        <button class='btn btn-sm btn-outline-info dropdown-toggle' type='button' data-bs-toggle='dropdown'>
                            <i class='fas fa-tools me-1'></i>–ò–ò –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
                        </button>
                        <div class='dropdown-menu'>
                            <a class='dropdown-item' href='#' onclick='aiGenerateImage()'>
                                <i class='fas fa-magic me-2'></i>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            </a>
                            <a class='dropdown-item' href='#' onclick='aiEnhanceImages()'>
                                <i class='fas fa-wand-magic-sparkles me-2'></i>–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ
                            </a>
                            <a class='dropdown-item' href='#' onclick='aiRemoveBackground()'>
                                <i class='fas fa-cut me-2'></i>–£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω
                            </a>
                            <a class='dropdown-item' href='#' onclick='aiOptimizeImages()'>
                                <i class='fas fa-compress me-2'></i>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä
                            </a>
                        </div>
                    </div>
                </div>
                <div class='card-body'>
                    <div class='row'>
                        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
                        <div class='col-lg-6'>
                            <div class='mb-3'>
                                <label class='form-label fw-semibold'>
                                    –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ <span class='text-danger'>*</span>
                                    <small class='text-muted'>(–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ)</small>
                                </label>
                                <div class='image-upload-area <?= !empty($product_data['main_image']) ? 'has-image' : '' ?>' id='mainImageUpload'>
                                    <?php if (!empty($product_data['main_image'])): ?>
                                    <div class='image-preview-container'>
                                        <img src='<?= htmlspecialchars($product_data['main_image']) ?>' alt='–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' class='img-fluid'>
                                        <div class='image-actions'>
                                            <button type='button' class='btn btn-sm btn-primary' onclick='cropImage("main")' title='–û–±—Ä–µ–∑–∞—Ç—å'>
                                                <i class='fas fa-crop'></i>
                                            </button>
                                            <button type='button' class='btn btn-sm btn-warning' onclick='aiEnhanceSpecificImage("main")' title='–ò–ò —É–ª—É—á—à–µ–Ω–∏–µ'>
                                                <i class='fas fa-sparkles'></i>
                                            </button>
                                            <button type='button' class='btn btn-sm btn-danger' onclick='removeMainImage()' title='–£–¥–∞–ª–∏—Ç—å'>
                                                <i class='fas fa-times'></i>
                                            </button>
                                        </div>
                                    </div>
                                    <?php else: ?>
                                    <div class='upload-placeholder'>
                                        <i class='fas fa-cloud-upload-alt fa-3x text-primary mb-3'></i>
                                        <h5>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—é–¥–∞</h5>
                                        <p class='text-muted mb-3'>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</p>
                                        <button type='button' class='btn btn-primary'>
                                            <i class='fas fa-folder-open me-1'></i>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                                        </button>
                                        <p class='small text-muted mt-2'>
                                            JPG, PNG, GIF, WebP ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 10MB<br>
                                            –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 800x600px
                                        </p>
                                    </div>
                                    <?php endif; ?>
                                </div>
                                <input type='hidden' name='main_image' id='mainImagePath' value='<?= htmlspecialchars($product_data['main_image'] ?? '') ?>'>

                                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                                <div class='mt-3'>
                                    <small class='text-muted d-block mb-2'>–ë—ã—Å—Ç—Ä–∞—è –∑–∞–º–µ–Ω–∞ –¥–µ–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏:</small>
                                    <div class='d-flex gap-2 flex-wrap'>
                                        <button type='button' class='btn btn-outline-success btn-sm' onclick='setDemoImage("plant")'>
                                            üåø –†–∞—Å—Ç–µ–Ω–∏–µ
                                        </button>
                                        <button type='button' class='btn btn-outline-info btn-sm' onclick='setDemoImage("fish")'>
                                            üê† –†—ã–±–∫–∞
                                        </button>
                                        <button type='button' class='btn btn-outline-warning btn-sm' onclick='setDemoImage("equipment")'>
                                            ‚öôÔ∏è –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
                                        </button>
                                        <button type='button' class='btn btn-outline-secondary btn-sm' onclick='setDemoImage("decoration")'>
                                            ü™® –î–µ–∫–æ—Ä
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ì–∞–ª–µ—Ä–µ—è -->
                        <div class='col-lg-6'>
                            <div class='mb-3'>
                                <label class='form-label fw-semibold'>
                                    –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                                    <small class='text-muted'>(–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ)</small>
                                    <span class='badge bg-primary ms-1' id='galleryCount'>0</span>
                                </label>

                                <!-- Drag & Drop –∑–æ–Ω–∞ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ -->
                                <div class='image-upload-area' id='galleryUpload'>
                                    <div class='upload-placeholder'>
                                        <i class='fas fa-cloud-upload-alt fa-3x text-primary mb-3'></i>
                                        <h6>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</h6>
                                        <p class='text-muted mb-3'>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞</p>
                                        <button type='button' class='btn btn-primary'>
                                            <i class='fas fa-folder-open me-1'></i>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                                        </button>
                                        <p class='small text-muted mt-2'>
                                            JPG, PNG, GIF, WebP ‚Ä¢ –ú–∞–∫—Å. 5MB –∫–∞–∂–¥—ã–π<br>
                                            –î–æ 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                                        </p>
                                    </div>
                                </div>

                                <!-- –ü—Ä–µ–≤—å—é –≥–∞–ª–µ—Ä–µ–∏ -->
                                <div id='galleryPreview' class='gallery-preview mt-3'>
                                    <?php if (!empty($product_data['gallery']) && is_array($product_data['gallery'])): ?>
                                        <?php foreach ($product_data['gallery'] as $index => $image): ?>
                                        <div class='gallery-item'>
                                            <img src='<?= htmlspecialchars($image) ?>' alt='–ì–∞–ª–µ—Ä–µ—è <?= $index + 1 ?>'>
                                            <div class='gallery-overlay'>
                                                <button type='button' class='btn btn-sm btn-primary' onclick='editImage(<?= $index ?>)' title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'>
                                                    <i class='fas fa-edit'></i>
                                                </button>
                                                <button type='button' class='btn btn-sm btn-warning' onclick='aiEnhanceSpecificImage(<?= $index ?>)' title='–ò–ò —É–ª—É—á—à–µ–Ω–∏–µ'>
                                                    <i class='fas fa-sparkles'></i>
                                                </button>
                                            </div>
                                            <button type='button' class='remove-btn' onclick='removeFromGallery(<?= $index ?>)' title='–£–¥–∞–ª–∏—Ç—å'>
                                                <i class='fas fa-times'></i>
                                            </button>
                                        </div>
                                        <?php endforeach; ?>
                                    <?php endif; ?>
                                </div>
                                <input type='hidden' name='gallery' id='galleryPaths' value='<?= htmlspecialchars(json_encode($product_data['gallery'] ?? [])) ?>'>

                                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ -->
                                <div class='mt-3'>
                                    <div class='d-flex justify-content-between align-items-center'>
                                        <small class='text-muted'>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</small>
                                        <div class='btn-group btn-group-sm'>
                                            <button type='button' class='btn btn-outline-primary' onclick='addDemoToGallery("detail1")'>
                                                üì∏ –î–µ—Ç–∞–ª–∏
                                            </button>
                                            <button type='button' class='btn btn-outline-info' onclick='addDemoToGallery("detail2")'>
                                                üîç –ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω
                                            </button>
                                            <button type='button' class='btn btn-outline-success' onclick='addDemoToGallery("usage")'>
                                                üí° –í –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
            <div class='card shadow mb-4'>
                <div class='card-body'>
                    <div class='d-flex justify-content-between align-items-center'>
                        <div>
                            <button type='button' class='btn btn-outline-secondary me-2' onclick='saveAsDraft()'>
                                <i class='fas fa-save me-1'></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
                            </button>
                            <button type='button' class='btn btn-outline-info me-2' onclick='previewProduct()'>
                                <i class='fas fa-eye me-1'></i>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                            </button>
                            <button type='button' class='btn btn-outline-warning' onclick='aiValidateForm()'>
                                <i class='fas fa-check-double me-1'></i>–ò–ò –ø—Ä–æ–≤–µ—Ä–∫–∞
                            </button>
                        </div>
                        <div>
                            <button type='button' class='btn btn-secondary me-2' onclick='showConfirmResetModal()'>
                                <i class='fas fa-undo me-1'></i>–°–±—Ä–æ—Å–∏—Ç—å
                            </button>
                            <button type='submit' class='btn btn-success' onclick='return validateForm()'>
                                <i class='fas fa-save me-1'></i><?= $product_data ? '–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä' ?>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–æ–∑–¥–∞—Ç–µ–ª—é —Ç–æ–≤–∞—Ä–æ–≤) -->
    <div class='col-xl-4 col-lg-5'>

        <!-- –ò–ò –ß–∞—Ç-–ø–æ–º–æ—â–Ω–∏–∫ -->
        <div class='card shadow mb-4'>
            <div class='card-header py-3'>
                <h6 class='m-0 font-weight-bold text-primary'>
                    <i class='fas fa-robot me-2'></i>ü§ñ –ò–ò –ß–∞—Ç-–ü–æ–º–æ—â–Ω–∏–∫
                    <div class='float-end'>
                        <span class='badge bg-success'>–û–Ω–ª–∞–π–Ω</span>
                    </div>
                </h6>
            </div>
            <div class='card-body p-0'>
                <div class='ai-chat-container' id='aiChatContainer' style='height: 300px; overflow-y: auto; padding: 1rem;'>
                    <div class='ai-message mb-3'>
                        <div class='d-flex'>
                            <div class='ai-avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3' style='width: 35px; height: 35px; font-size: 14px;'>
                                ü§ñ
                            </div>
                            <div class='ai-message-content'>
                                <div class='bg-light rounded p-2'>
                                    <strong>–ò–ò –ü–æ–º–æ—â–Ω–∏–∫:</strong><br>
                                    <?php if ($product_data): ?>
                                    –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä '<?= htmlspecialchars($product_data['name']) ?>'! üõ†Ô∏è
                                    <br><br>–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π:
                                    <?php else: ?>
                                    –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä! üöÄ
                                    <br><br>–ú–æ–≥—É –ø–æ–º–æ—á—å:
                                    <?php endif; ?>
                                    <br>‚Ä¢ –£–ª—É—á—à–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
                                    <br>‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                    <br>‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å SEO
                                    <br>‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–µ–≥–∏
                                    <br><br>–° —á–µ–≥–æ –Ω–∞—á–Ω–µ–º?
                                </div>
                                <small class='text-muted'>–¢–æ–ª—å–∫–æ —á—Ç–æ</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class='p-3 border-top bg-light'>
                    <div class='input-group'>
                        <input type='text' class='form-control' id='aiChatInput' placeholder='–°–ø—Ä–æ—Å–∏—Ç–µ –ò–ò –æ —Ç–æ–≤–∞—Ä–µ...'>
                        <button class='btn btn-primary' onclick='sendAIMessage()'>
                            <i class='fas fa-paper-plane'></i>
                        </button>
                    </div>

                    <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã -->
                    <div class='quick-commands mt-2'>
                        <div class='d-flex flex-wrap gap-1'>
                            <button class='btn btn-outline-primary btn-sm' onclick='aiQuickCommand("improve")'>
                                –£–ª—É—á—à–∏—Ç—å –≤—Å—ë
                            </button>
                            <button class='btn btn-outline-success btn-sm' onclick='aiQuickCommand("seo")'>
                                SEO –∞–Ω–∞–ª–∏–∑
                            </button>
                            <button class='btn btn-outline-info btn-sm' onclick='aiQuickCommand("price")'>
                                –¶–µ–Ω–∞
                            </button>
                            <button class='btn btn-outline-warning btn-sm' onclick='aiQuickCommand("images")'>
                                –§–æ—Ç–æ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
        <div class='card shadow mb-4'>
            <div class='card-header py-3'>
                <h6 class='m-0 font-weight-bold text-primary'>
                    <i class='fas fa-cogs me-2'></i>üîß –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                </h6>
            </div>
            <div class='card-body'>
                <div class='row'>
                    <div class='col-6'>
                        <div class='form-group mb-3'>
                            <label class='form-label small'>–†–∞–∑–º–µ—Ä</label>
                            <input type='text' class='form-control form-control-sm' name='size'
                                   placeholder='10-15 —Å–º' value='<?= htmlspecialchars($product_data['size'] ?? '') ?>'>
                        </div>
                    </div>
                    <div class='col-6'>
                        <div class='form-group mb-3'>
                            <label class='form-label small'>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</label>
                            <input type='text' class='form-control form-control-sm' name='temperature'
                                   placeholder='22-26¬∞C' value='<?= htmlspecialchars($product_data['temperature'] ?? '') ?>'>
                        </div>
                    </div>
                </div>
                <div class='row'>
                    <div class='col-6'>
                        <div class='form-group mb-3'>
                            <label class='form-label small'>pH —É—Ä–æ–≤–µ–Ω—å</label>
                            <input type='text' class='form-control form-control-sm' name='ph_level'
                                   placeholder='6.0-7.5' value='<?= htmlspecialchars($product_data['ph_level'] ?? '') ?>'>
                        </div>
                    </div>
                    <div class='col-6'>
                        <div class='form-group mb-3'>
                            <label class='form-label small'>–û—Å–≤–µ—â–µ–Ω–∏–µ</label>
                            <select class='form-select form-select-sm' name='lighting'>
                                <option value=''>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                                <option value='—Å–ª–∞–±–æ–µ' <?= ($product_data['lighting'] ?? '') == '—Å–ª–∞–±–æ–µ' ? 'selected' : '' ?>>–°–ª–∞–±–æ–µ</option>
                                <option value='—Å—Ä–µ–¥–Ω–µ–µ' <?= ($product_data['lighting'] ?? '') == '—Å—Ä–µ–¥–Ω–µ–µ' ? 'selected' : '' ?>>–°—Ä–µ–¥–Ω–µ–µ</option>
                                <option value='—è—Ä–∫–æ–µ' <?= ($product_data['lighting'] ?? '') == '—è—Ä–∫–æ–µ' ? 'selected' : '' ?>>–Ø—Ä–∫–æ–µ</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –Ø—Ä–ª—ã–∫–∏ —Ç–æ–≤–∞—Ä–∞ -->
        <div class='card shadow mb-4'>
            <div class='card-header py-3'>
                <h6 class='m-0 font-weight-bold text-primary'>üè∑Ô∏è –Ø—Ä–ª—ã–∫–∏ —Ç–æ–≤–∞—Ä–∞</h6>
            </div>
            <div class='card-body'>
                <div class='badges-container'>
                    <?php
                    $current_badges = $product_data['badges'] ?? [];
                    if (!is_array($current_badges)) {
                        $current_badges = json_decode($current_badges, true) ?: [];
                    }
                    ?>
                    <div class='form-check mb-2'>
                        <input class='form-check-input' type='checkbox' id='badge_new' value='new' onchange='updateBadges()'
                               <?= in_array('new', $current_badges) ? 'checked' : '' ?>>
                        <label class='form-check-label' for='badge_new'>
                            <span class='badge bg-success'>üÜï –ù–æ–≤–∏–Ω–∫–∞</span>
                        </label>
                    </div>
                    <div class='form-check mb-2'>
                        <input class='form-check-input' type='checkbox' id='badge_hit' value='hit' onchange='updateBadges()'
                               <?= in_array('hit', $current_badges) ? 'checked' : '' ?>>
                        <label class='form-check-label' for='badge_hit'>
                            <span class='badge bg-danger'>üî• –•–∏—Ç –ø—Ä–æ–¥–∞–∂</span>
                        </label>
                    </div>
                    <div class='form-check mb-2'>
                        <input class='form-check-input' type='checkbox' id='badge_recommend' value='recommend' onchange='updateBadges()'
                               <?= in_array('recommend', $current_badges) ? 'checked' : '' ?>>
                        <label class='form-check-label' for='badge_recommend'>
                            <span class='badge bg-warning text-dark'>‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º</span>
                        </label>
                    </div>
                    <div class='form-check mb-2'>
                        <input class='form-check-input' type='checkbox' id='badge_discount' value='discount' onchange='updateBadges()'
                               <?= in_array('discount', $current_badges) ? 'checked' : '' ?>>
                        <label class='form-check-label' for='badge_discount'>
                            <span class='badge bg-info'>üí∏ –°–∫–∏–¥–∫–∞</span>
                        </label>
                    </div>
                    <div class='form-check mb-2'>
                        <input class='form-check-input' type='checkbox' id='badge_premium' value='premium' onchange='updateBadges()'
                               <?= in_array('premium', $current_badges) ? 'checked' : '' ?>>
                        <label class='form-check-label' for='badge_premium'>
                            <span class='badge bg-dark'>üíé –ü—Ä–µ–º–∏—É–º</span>
                        </label>
                    </div>
                    <div class='form-check mb-2'>
                        <input class='form-check-input' type='checkbox' id='badge_eco' value='eco' onchange='updateBadges()'
                               <?= in_array('eco', $current_badges) ? 'checked' : '' ?>>
                        <label class='form-check-label' for='badge_eco'>
                            <span class='badge bg-success'>üåø –≠–∫–æ</span>
                        </label>
                    </div>
                </div>
                <input type='hidden' name='badges' id='selectedBadges' value='<?= htmlspecialchars(json_encode($current_badges)) ?>'>
            </div>
        </div>

        <!-- SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class='card shadow mb-4'>
            <div class='card-header py-3 d-flex justify-content-between align-items-center'>
                <h6 class='m-0 font-weight-bold text-primary'>üéØ SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h6>
                <div class='seo-score'>
                    <span class='badge bg-success'>85/100</span>
                </div>
            </div>
            <div class='card-body'>
                <div class='form-group mb-3'>
                    <label class='form-label small'>Meta Title</label>
                    <input type='text' class='form-control form-control-sm' name='meta_title' maxlength='60'
                           value='<?= htmlspecialchars($product_data['meta_title'] ?? '') ?>'>
                    <small class='text-muted'>–°–∏–º–≤–æ–ª–æ–≤: <span id='metaTitleLength'>0</span>/60</small>
                </div>
                <div class='form-group mb-3'>
                    <label class='form-label small'>Meta Description</label>
                    <textarea class='form-control form-control-sm' name='meta_description' rows='3' maxlength='160'><?= htmlspecialchars($product_data['meta_description'] ?? '') ?></textarea>
                    <small class='text-muted'>–°–∏–º–≤–æ–ª–æ–≤: <span id='metaDescLength'>0</span>/160</small>
                </div>

                <div class='d-grid gap-2'>
                    <button type='button' class='btn btn-sm btn-outline-primary' onclick='generateSEO()'>
                        <i class='fas fa-search me-1'></i>–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è SEO
                    </button>
                    <button type='button' class='btn btn-sm btn-outline-success' onclick='aiOptimizeSEO()'>
                        <i class='fas fa-robot me-1'></i>–ò–ò –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SEO
                    </button>
                </div>
            </div>
        </div>

        <!-- –ñ–∏–≤–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
        <div class='card shadow mb-4'>
            <div class='card-header py-3'>
                <h6 class='m-0 font-weight-bold text-primary'>
                    <i class='fas fa-eye me-2'></i>üëÅÔ∏è –ñ–∏–≤–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                </h6>
            </div>
            <div class='card-body'>
                <div class='product-preview' id='productPreview'>
                    <div class='preview-badges mb-2' id='previewBadges'></div>
                    <div class='preview-image mb-2'>
                        <div class='ratio ratio-1x1 bg-light rounded d-flex align-items-center justify-content-center border'>
                            <img id='previewImage' src='<?= htmlspecialchars($product_data['main_image'] ?? '') ?>'
                                 style='width: 100%; height: 100%; object-fit: cover; border-radius: 0.5rem; <?= empty($product_data['main_image']) ? 'display: none;' : '' ?>'>
                            <i class='fas fa-fish fa-3x text-muted' id='previewPlaceholder' <?= !empty($product_data['main_image']) ? 'style="display: none;"' : '' ?>></i>
                        </div>
                    </div>
                    <h6 class='preview-name fw-bold mb-1' id='previewName'><?= htmlspecialchars($product_data['name'] ?? '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞') ?></h6>
                    <p class='preview-description text-muted small mb-2' id='previewDescription'>
                        <?= htmlspecialchars(mb_substr($product_data['short_description'] ?? $product_data['description'] ?? '–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...', 0, 120)) ?>
                    </p>
                    <div class='d-flex justify-content-between align-items-center'>
                        <div>
                            <span class='preview-price fw-bold text-success' id='previewPrice'><?= number_format($product_data['price'] ?? 0, 0, ',', ' ') ?> ‚ÇΩ</span>
                            <small class='preview-old-price text-muted text-decoration-line-through ms-1' id='previewOldPrice'
                                   <?= empty($product_data['old_price']) || $product_data['old_price'] <= ($product_data['price'] ?? 0) ? 'style="display: none;"' : '' ?>>
                                <?= number_format($product_data['old_price'] ?? 0, 0, ',', ' ') ?> ‚ÇΩ
                            </small>
                        </div>
                        <small class='text-muted' id='previewCategory'>
                            <?php
                            if (!empty($product_data['category_id'])) {
                                foreach ($categories as $cat) {
                                    if ($cat['id'] == $product_data['category_id']) {
                                        echo htmlspecialchars($cat['name']);
                                        break;
                                    }
                                }
                            } else {
                                echo '–ö–∞—Ç–µ–≥–æ—Ä–∏—è';
                            }
                            ?>
                        </small>
                    </div>
                    <div class='preview-specs mt-2' id='previewSpecs'>
                        <?php
                        $specs = [];
                        if (!empty($product_data['size'])) $specs[] = 'üìè ' . htmlspecialchars($product_data['size']);
                        if (!empty($product_data['temperature'])) $specs[] = 'üå°Ô∏è ' . htmlspecialchars($product_data['temperature']);
                        if (!empty($product_data['ph_level'])) $specs[] = 'üíß ' . htmlspecialchars($product_data['ph_level']);
                        if (!empty($specs)):
                        ?>
                        <small class='text-muted d-block'><?= implode(' ‚Ä¢ ', $specs) ?></small>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –∏–∑ —Å–æ–∑–¥–∞—Ç–µ–ª—è —Ç–æ–≤–∞—Ä–æ–≤ (–≤—Å–µ —Ç–µ –∂–µ —Å—Ç–∏–ª–∏) */
.page-header {
    background: #fff;
    padding: 1.5rem 0;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid #e3e6f0;
}

.breadcrumb {
    background: none;
    padding: 0;
    margin: 0;
    font-size: 0.85rem;
}

.breadcrumb-item + .breadcrumb-item::before {
    color: #858796;
    content: '‚Ä∫';
}

.card {
    border: 1px solid #e3e6f0;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
}

.card-header {
    background-color: #f8f9fc;
    border-bottom: 1px solid #e3e6f0;
}

.form-control, .form-select {
    border-color: #d1d3e2;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #4e73df;
    box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
}

.image-upload-area {
    border: 3px dashed #d1d3e2;
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #f8f9fc 0%, #f1f3ff 100%);
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
}

.image-upload-area:hover {
    border-color: #4e73df;
    background: linear-gradient(135deg, #f0f2ff 0%, #e8ecff 100%);
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(78, 115, 223, 0.2);
}

.image-upload-area.dragover {
    border-color: #36b9cc;
    background: linear-gradient(135deg, #e8f4f8 0%, #d4edda 100%);
    border-style: solid;
    transform: scale(1.02);
}

.image-upload-area.has-image {
    padding: 1rem;
    min-height: auto;
}

.image-preview-container {
    position: relative;
    display: inline-block;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.image-preview-container:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.image-preview-container img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.image-actions {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 5px;
    opacity: 0;
    transition: all 0.3s ease;
}

.image-preview-container:hover .image-actions {
    opacity: 1;
}

.image-actions .btn {
    width: 32px;
    height: 32px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    border-radius: 50%;
    backdrop-filter: blur(10px);
    background: rgba(255,255,255,0.9);
    border: 1px solid rgba(255,255,255,0.3);
}

.gallery-preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 15px;
}

.gallery-item {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid #e3e6f0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.gallery-item:hover {
    border-color: #4e73df;
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(78, 115, 223, 0.3);
}

.gallery-item img {
    width: 100%;
    height: 120px;
    object-fit: cover;
    transition: all 0.3s ease;
}

.gallery-item:hover img {
    transform: scale(1.05);
}

.gallery-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    opacity: 0;
    transition: all 0.3s ease;
}

.gallery-item:hover .gallery-overlay {
    opacity: 1;
}

.remove-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(220, 53, 69, 0.9);
    color: white;
    border: none;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.gallery-item:hover .remove-btn {
    opacity: 1;
}

.remove-btn:hover {
    background: rgba(220, 53, 69, 1);
    transform: scale(1.1);
}

.ai-chat-container {
    background: linear-gradient(135deg, #f8f9fc 0%, #f1f3ff 100%);
}

.ai-avatar {
    flex-shrink: 0;
    background: linear-gradient(135deg, #4e73df, #36b9cc) !important;
    animation: pulse-avatar 2s infinite;
}

@keyframes pulse-avatar {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.ai-message-content .bg-light {
    background: rgba(255,255,255,0.8) !important;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
}

.quick-commands .btn {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
}

.btn {
    font-size: 0.875rem;
    border-radius: 8px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 500;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.text-gray-800 { color: #5a5c69 !important; }
.font-weight-bold { font-weight: 700 !important; }
.fw-semibold { font-weight: 600 !important; }

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .page-header {
        padding: 1rem 0;
        text-align: center;
    }

    .page-header .d-flex {
        flex-direction: column;
        gap: 1rem;
    }

    .card-body {
        padding: 1rem;
    }

    .image-upload-area {
        min-height: 150px;
        padding: 1.5rem;
    }

    .gallery-preview {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
    }

    .ai-chat-container {
        height: 250px !important;
    }
}
</style>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let galleryImages = <?= json_encode($product_data['gallery'] ?? []) ?>;
let currentProductId = '<?= $product_id ?? '' ?>';

// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≥–∞–ª–µ—Ä–µ—é –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
if (Array.isArray(galleryImages)) {
    galleryImages = galleryImages.map((url, index) => ({
        url: url,
        name: `gallery_${index + 1}.jpg`,
        size: 245760,
        alt: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ' + (index + 1)
    }));
}

// –î–µ–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
const demoImages = {
    plant: 'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400&h=400&fit=crop',
    fish: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=400&fit=crop',
    equipment: 'https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=400&fit=crop',
    decoration: 'https://images.unsplash.com/photo-1583212292454-1fe6229603b7?w=400&h=400&fit=crop',
    detail1: 'https://images.unsplash.com/photo-1535591273668-578e31182c4f?w=300&h=300&fit=crop',
    detail2: 'https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=300&h=300&fit=crop',
    usage: 'https://images.unsplash.com/photo-1524704654690-b56c05c78a00?w=300&h=300&fit=crop'
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ò–ò —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤...');

    initAdvancedImageUploads();
    initSmartFormTracking();
    initAIPersonality();
    updateLivePreview();
    updateBadges();
    updateGalleryCount();

    console.log(`üîß –†–µ–¥–∞–∫—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ID: ${currentProductId || '–Ω–æ–≤—ã–π'}`);
});

// –í–µ—Å—å JavaScript –∫–æ–¥ —Ç–∞–∫–æ–π –∂–µ –∫–∞–∫ –≤ —Å–æ–∑–¥–∞—Ç–µ–ª–µ —Ç–æ–≤–∞—Ä–æ–≤, —Ç–æ–ª—å–∫–æ —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏...
// (–ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ add_product.php —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏)

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
function validateForm() {
    const name = document.getElementById('productName').value.trim();
    const category = document.getElementById('productCategory').value;
    const price = document.getElementById('productPrice').value;
    const description = document.getElementById('productDescription').value.trim();

    if (!name) {
        showNotification('‚ùå –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        document.getElementById('productName').focus();
        return false;
    }

    if (!category) {
        showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞', 'error');
        document.getElementById('productCategory').focus();
        return false;
    }

    if (!price || parseFloat(price) <= 0) {
        showNotification('‚ùå –£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞', 'error');
        document.getElementById('productPrice').focus();
        return false;
    }

    if (!description) {
        showNotification('‚ùå –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        document.getElementById('productDescription').focus();
        return false;
    }

    showNotification('üíæ –û–±–Ω–æ–≤–ª—è—é —Ç–æ–≤–∞—Ä...', 'info');
    return true;
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–±—Ä–æ—Å–∞
function showConfirmResetModal() {
    const modal = new bootstrap.Modal(document.getElementById('confirmResetModal'));
    modal.show();
}

// –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
function confirmReset() {
    const form = document.getElementById('productForm');

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è
    form.reset();

    // –û—á–∏—â–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    galleryImages = [];
    updateGalleryPreview();
    updateGalleryInput();
    updateGalleryCount();
    document.getElementById('selectedBadges').value = '[]';
    document.getElementById('mainImagePath').value = '';
    removeMainImage();
    updateLivePreview();

    // –û—á–∏—â–∞–µ–º —á–∞—Ç
    const container = document.getElementById('aiChatContainer');
    container.innerHTML = `
        <div class='ai-message mb-3'>
            <div class='d-flex'>
                <div class='ai-avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3' style='width: 35px; height: 35px; font-size: 14px;'>
                    ü§ñ
                </div>
                <div class='ai-message-content'>
                    <div class='bg-light rounded p-2'>
                        <strong>–ò–ò –ü–æ–º–æ—â–Ω–∏–∫:</strong><br>
                        –§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞! üßπ –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π —Ç–æ–≤–∞—Ä.
                        <br><br>–ù–∞—á–Ω–µ–º —Å –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞? üöÄ
                    </div>
                    <small class='text-muted'>–¢–æ–ª—å–∫–æ —á—Ç–æ</small>
                </div>
            </div>
        </div>
    `;

    showNotification('üßπ –§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞! –ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–Ω–æ–≤–æ', 'info');
}

// –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ –≤ add_product.php...
// (–î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞, –≤–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)

// –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
function initAdvancedImageUploads() {
    const mainUpload = document.getElementById('mainImageUpload');
    const galleryUpload = document.getElementById('galleryUpload');

    if (mainUpload) setupDragAndDrop(mainUpload, 'main');
    if (galleryUpload) setupDragAndDrop(galleryUpload, 'gallery');
}

function setupDragAndDrop(element, type) {
    element.addEventListener('click', (e) => {
        if (!e.target.closest('.btn-danger') && !e.target.closest('.image-actions') && !e.target.closest('.remove-btn')) {
            selectFiles(type);
        }
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        element.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });

    element.addEventListener('dragover', () => element.classList.add('dragover'));
    element.addEventListener('dragleave', () => element.classList.remove('dragover'));
    element.addEventListener('drop', (e) => {
        element.classList.remove('dragover');
        const files = Array.from(e.dataTransfer.files);
        if (files.length > 0) processFiles(files, type);
    });
}

function selectFiles(type) {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.multiple = type === 'gallery';

    input.onchange = (e) => {
        const files = Array.from(e.target.files);
        if (files.length > 0) processFiles(files, type);
    };

    input.click();
}

async function processFiles(files, type) {
    const validFiles = files.filter(file => {
        if (!file.type.startsWith('image/')) {
            showNotification(`‚ùå –§–∞–π–ª ${file.name} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º`, 'error');
            return false;
        }
        if (file.size > 10 * 1024 * 1024) {
            showNotification(`‚ùå –§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 10MB)`, 'error');
            return false;
        }
        return true;
    });

    if (validFiles.length === 0) return;

    for (let file of validFiles) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const imageData = {
                url: e.target.result,
                name: file.name,
                size: file.size
            };

            if (type === 'main') {
                setMainImage(imageData);
            } else {
                addToGallery(imageData);
            }
            updateLivePreview();
        };
        reader.readAsDataURL(file);
    }

    addAIMessage(`üì∏ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${validFiles.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞.`);
}

function setDemoImage(type) {
    const imageUrl = demoImages[type];
    if (!imageUrl) return;

    const imageData = {
        url: imageUrl,
        name: `demo_${type}.jpg`,
        size: 245760
    };

    setMainImage(imageData);
    updateLivePreview();

    const typeNames = {
        plant: 'üåø —Ä–∞—Å—Ç–µ–Ω–∏—è',
        fish: 'üê† —Ä—ã–±–∫–∏',
        equipment: '‚öôÔ∏è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        decoration: 'ü™® –¥–µ–∫–æ—Ä–∞'
    };

    showNotification(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –¥–µ–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${typeNames[type]}!`, 'success');
    addAIMessage(`üñºÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏–ª –∫—Ä–∞—Å–∏–≤–æ–µ –¥–µ–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${typeNames[type]}!`);
}

function setMainImage(imageData) {
    const mainUpload = document.getElementById('mainImageUpload');
    const mainPath = document.getElementById('mainImagePath');

    mainUpload.innerHTML = `
        <div class='image-preview-container'>
            <img src='${imageData.url}' alt='–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' class='img-fluid'>
            <div class='image-actions'>
                <button type='button' class='btn btn-primary' onclick='cropImage("main")' title='–û–±—Ä–µ–∑–∞—Ç—å'>
                    <i class='fas fa-crop'></i>
                </button>
                <button type='button' class='btn btn-warning' onclick='aiEnhanceSpecificImage("main")' title='–ò–ò —É–ª—É—á—à–µ–Ω–∏–µ'>
                    <i class='fas fa-sparkles'></i>
                </button>
                <button type='button' class='btn btn-danger' onclick='removeMainImage()' title='–£–¥–∞–ª–∏—Ç—å'>
                    <i class='fas fa-times'></i>
                </button>
            </div>
        </div>
    `;

    mainUpload.classList.add('has-image');
    mainPath.value = imageData.url;
}

function removeMainImage() {
    const mainUpload = document.getElementById('mainImageUpload');
    const mainPath = document.getElementById('mainImagePath');

    mainUpload.innerHTML = `
        <div class='upload-placeholder'>
            <i class='fas fa-cloud-upload-alt fa-3x text-primary mb-3'></i>
            <h5>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—é–¥–∞</h5>
            <p class='text-muted mb-3'>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</p>
            <button type='button' class='btn btn-primary'>
                <i class='fas fa-folder-open me-1'></i>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
            </button>
            <p class='small text-muted mt-2'>
                JPG, PNG, GIF, WebP ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 10MB<br>
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 800x600px
            </p>
        </div>
    `;

    mainUpload.classList.remove('has-image');
    mainPath.value = '';
    updateLivePreview();
}

function addDemoToGallery(type) {
    const imageUrl = demoImages[type];
    if (!imageUrl) return;

    const imageData = {
        url: imageUrl,
        name: `gallery_${type}.jpg`,
        size: 198432
    };

    addToGallery(imageData);
    updateLivePreview();

    const typeNames = {
        detail1: 'üì∏ –¥–µ—Ç–∞–ª–µ–π',
        detail2: 'üîç –∫—Ä—É–ø–Ω–æ–≥–æ –ø–ª–∞–Ω–∞',
        usage: 'üí° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è'
    };

    showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ç–æ ${typeNames[type]} –≤ –≥–∞–ª–µ—Ä–µ—é!`, 'success');
}

function addToGallery(imageData) {
    galleryImages.push(imageData);
    updateGalleryPreview();
    updateGalleryInput();
    updateGalleryCount();
}

function updateGalleryPreview() {
    const preview = document.getElementById('galleryPreview');

    if (galleryImages.length === 0) {
        preview.innerHTML = '<p class="text-muted text-center py-4">–ì–∞–ª–µ—Ä–µ—è –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!</p>';
        return;
    }

    preview.innerHTML = galleryImages.map((imageData, index) => `
        <div class='gallery-item' style='animation-delay: ${index * 0.1}s'>
            <img src='${imageData.url || imageData}' alt='${imageData.alt || '–ì–∞–ª–µ—Ä–µ—è ' + (index + 1)}' title='${imageData.name || 'gallery_' + (index + 1)}'>
            <div class='gallery-overlay'>
                <button type='button' class='btn btn-sm btn-primary' onclick='editImage(${index})' title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'>
                    <i class='fas fa-edit'></i>
                </button>
                <button type='button' class='btn btn-sm btn-warning' onclick='aiEnhanceSpecificImage(${index})' title='–ò–ò —É–ª—É—á—à–µ–Ω–∏–µ'>
                    <i class='fas fa-sparkles'></i>
                </button>
            </div>
            <button type='button' class='remove-btn' onclick='removeFromGallery(${index})' title='–£–¥–∞–ª–∏—Ç—å'>
                <i class='fas fa-times'></i>
            </button>
        </div>
    `).join('');
}

function removeFromGallery(index) {
    const removedImage = galleryImages.splice(index, 1)[0];
    updateGalleryPreview();
    updateGalleryInput();
    updateGalleryCount();
    updateLivePreview();

    showNotification(`üóëÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏`, 'info');
}

function updateGalleryInput() {
    const urls = galleryImages.map(img => img.url || img);
    document.getElementById('galleryPaths').value = JSON.stringify(urls);
}

function updateGalleryCount() {
    const countEl = document.getElementById('galleryCount');
    if (countEl) {
        countEl.textContent = galleryImages.length;
    }
}

// –ò–ò —Å–∏—Å—Ç–µ–º–∞
function initAIPersonality() {
    const input = document.getElementById('aiChatInput');
    if (input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendAIMessage();
        });
    }
}

function sendAIMessage() {
    const input = document.getElementById('aiChatInput');
    const message = input.value.trim();

    if (!message) return;

    addUserMessage(message);
    input.value = '';

    addAIMessage('ü§î –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...', true);

    setTimeout(() => {
        removeTemporaryMessages();
        processAIRequest(message);
    }, 1500);
}

function addUserMessage(message) {
    const container = document.getElementById('aiChatContainer');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'user-message mb-3';

    messageDiv.innerHTML = `
        <div class='d-flex justify-content-end'>
            <div class='user-message-content'>
                <div class='bg-primary text-white rounded p-2' style='max-width: 250px;'>
                    ${escapeHtml(message)}
                </div>
                <small class='text-muted float-end'>–¢–æ–ª—å–∫–æ —á—Ç–æ</small>
            </div>
            <div class='user-avatar bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center ms-3' style='width: 35px; height: 35px; font-size: 14px;'>
                üë§
            </div>
        </div>
    `;

    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;
}

function addAIMessage(message, isTemporary = false) {
    const container = document.getElementById('aiChatContainer');
    const messageDiv = document.createElement('div');
    messageDiv.className = `ai-message mb-3 ${isTemporary ? 'temporary' : ''}`;

    messageDiv.innerHTML = `
        <div class='d-flex'>
            <div class='ai-avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3' style='width: 35px; height: 35px; font-size: 14px;'>
                ü§ñ
            </div>
            <div class='ai-message-content'>
                <div class='bg-light rounded p-2' style='max-width: 280px;'>
                    <strong>–ò–ò –ü–æ–º–æ—â–Ω–∏–∫:</strong><br>
                    ${message.replace(/\\n/g, '<br>')}
                </div>
                <small class='text-muted'>–¢–æ–ª—å–∫–æ —á—Ç–æ</small>
            </div>
        </div>
    `;

    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;
}

function removeTemporaryMessages() {
    const tempMessages = document.querySelectorAll('.temporary');
    tempMessages.forEach(msg => msg.remove());
}

function processAIRequest(message) {
    const lowerMessage = message.toLowerCase();
    let response = '';

    if (lowerMessage.includes('—Ü–µ–Ω–∞') || lowerMessage.includes('—Å—Ç–æ–∏–º–æ—Å—Ç—å')) {
        response = '–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏–∑—É—á–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤. –ú–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ü–µ–Ω—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!';
    } else if (lowerMessage.includes('–æ–ø–∏—Å–∞–Ω–∏–µ')) {
        response = '–û—Ç–ª–∏—á–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏. –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –æ–ø–∏—Å–∞–Ω–∏–µ?';
    } else if (lowerMessage.includes('—Ñ–æ—Ç–æ') || lowerMessage.includes('–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ')) {
        response = '–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã! –ú–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ –¥–µ–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—à–µ.';
    } else {
        const responses = [
            '–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! –î–∞–≤–∞–π—Ç–µ —É–ª—É—á—à–∏–º —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
            '–ü–æ–Ω—è–ª –≤–∞—Å! –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö –ø–æ–ª–µ–π. –° —á–µ–≥–æ –Ω–∞—á–Ω–µ–º?',
            '–•–æ—Ä–æ—à–∏–π –ø–æ–¥—Ö–æ–¥! –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ - –æ–Ω–∏ –ø–æ–≤—ã—à–∞—é—Ç –ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ 40%.'
        ];
        response = responses[Math.floor(Math.random() * responses.length)];
    }

    addAIMessage(response);
}

function aiQuickCommand(command) {
    switch(command) {
        case 'improve':
            addUserMessage('–£–ª—É—á—à–∏ –≤—Å–µ –ø–æ–ª—è —Ç–æ–≤–∞—Ä–∞');
            setTimeout(() => {
                addAIMessage('üöÄ –ó–∞–ø—É—Å–∫–∞—é –ø–æ–ª–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–∞!', true);
                setTimeout(() => {
                    removeTemporaryMessages();
                    aiGenerateAll();
                }, 2000);
            }, 500);
            break;

        case 'seo':
            addUserMessage('–ü—Ä–æ–≤–µ–¥–∏ SEO –∞–Ω–∞–ª–∏–∑');
            setTimeout(() => processAIRequest('seo –∞–Ω–∞–ª–∏–∑'), 1000);
            break;

        case 'price':
            addUserMessage('–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞');
            setTimeout(() => processAIRequest('–∞–Ω–∞–ª–∏–∑ —Ü–µ–Ω—ã'), 1000);
            break;

        case 'images':
            addUserMessage('–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏?');
            setTimeout(() => processAIRequest('–∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π'), 1000);
            break;
    }
}

function initSmartFormTracking() {
    const form = document.getElementById('productForm');
    const inputs = form.querySelectorAll('input, select, textarea');

    inputs.forEach(input => {
        input.addEventListener('input', debounce(updateLivePreview, 300));
        input.addEventListener('change', updateLivePreview);
    });

    setupSpecialFieldHandlers();
}

function setupSpecialFieldHandlers() {
    const nameField = document.getElementById('productName');
    if (nameField) {
        nameField.addEventListener('input', function() {
            const length = this.value.length;
            const lengthEl = document.getElementById('nameLength');
            const seoEl = document.getElementById('nameSeoScore');

            if (lengthEl) lengthEl.textContent = length;

            if (seoEl) {
                if (length < 10) {
                    seoEl.innerHTML = '<span class="text-warning">üìà –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –¥–ª—è SEO</span>';
                } else if (length <= 30) {
                    seoEl.innerHTML = '<span class="text-success">‚úÖ –•–æ—Ä–æ—à–æ –¥–ª—è SEO</span>';
                } else if (length <= 60) {
                    seoEl.innerHTML = '<span class="text-success">üéØ –û—Ç–ª–∏—á–Ω–æ –¥–ª—è SEO</span>';
                } else {
                    seoEl.innerHTML = '<span class="text-danger">‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ</span>';
                }
            }
        });
        nameField.dispatchEvent(new Event('input'));
    }

    const descField = document.getElementById('productDescription');
    if (descField) {
        descField.addEventListener('input', function() {
            const text = this.value;
            const length = text.length;
            const words = text.split(' ').filter(word => word.length > 0).length;

            const lengthEl = document.getElementById('descLength');
            const readabilityEl = document.getElementById('readabilityScore');
            const seoEl = document.getElementById('seoAnalysis');

            if (lengthEl) lengthEl.textContent = length;

            if (readabilityEl && seoEl) {
                if (words < 30) {
                    readabilityEl.textContent = '–ö–æ—Ä–æ—Ç–∫–æ';
                    readabilityEl.className = 'fw-bold text-warning';
                    seoEl.innerHTML = '<span class="text-danger">–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ</span>';
                } else if (words < 100) {
                    readabilityEl.textContent = '–•–æ—Ä–æ—à–æ';
                    readabilityEl.className = 'fw-bold text-success';
                    seoEl.innerHTML = '<span class="text-success">–•–æ—Ä–æ—à–æ</span>';
                } else if (words < 200) {
                    readabilityEl.textContent = '–û—Ç–ª–∏—á–Ω–æ';
                    readabilityEl.className = 'fw-bold text-success';
                    seoEl.innerHTML = '<span class="text-success">–û—Ç–ª–∏—á–Ω–æ</span>';
                } else {
                    readabilityEl.textContent = '–û—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ';
                    readabilityEl.className = 'fw-bold text-info';
                    seoEl.innerHTML = '<span class="text-info">–û—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ</span>';
                }
            }
        });
        descField.dispatchEvent(new Event('input'));
    }

    const shortDescField = document.getElementById('productShortDescription');
    if (shortDescField) {
        shortDescField.addEventListener('input', function() {
            const lengthEl = document.getElementById('shortDescLength');
            if (lengthEl) lengthEl.textContent = this.value.length;
        });
        shortDescField.dispatchEvent(new Event('input'));
    }

    ['productPrice', 'productOldPrice'].forEach(id => {
        const field = document.getElementById(id);
        if (field) field.addEventListener('input', calculateDiscount);
    });

    const metaTitleField = document.querySelector('[name="meta_title"]');
    if (metaTitleField) {
        metaTitleField.addEventListener('input', function() {
            const lengthEl = document.getElementById('metaTitleLength');
            if (lengthEl) lengthEl.textContent = this.value.length;
        });
        metaTitleField.dispatchEvent(new Event('input'));
    }

    const metaDescField = document.querySelector('[name="meta_description"]');
    if (metaDescField) {
        metaDescField.addEventListener('input', function() {
            const lengthEl = document.getElementById('metaDescLength');
            if (lengthEl) lengthEl.textContent = this.value.length;
        });
        metaDescField.dispatchEvent(new Event('input'));
    }
}

function updateLivePreview() {
    const name = document.getElementById('productName').value || '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞';
    const price = document.getElementById('productPrice').value || '0';
    const oldPrice = document.getElementById('productOldPrice').value || '';
    const description = document.getElementById('productDescription').value || '–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...';
    const shortDescription = document.getElementById('productShortDescription').value || description;
    const categorySelect = document.getElementById('productCategory');
    const categoryText = categorySelect.selectedOptions[0]?.text || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è';

    const nameEl = document.getElementById('previewName');
    const priceEl = document.getElementById('previewPrice');
    const oldPriceEl = document.getElementById('previewOldPrice');
    const descEl = document.getElementById('previewDescription');
    const categoryEl = document.getElementById('previewCategory');

    if (nameEl) nameEl.textContent = name;
    if (priceEl) priceEl.textContent = formatPrice(price);
    if (categoryEl) categoryEl.textContent = categoryText;

    if (descEl) {
        const previewText = shortDescription || description;
        descEl.textContent = previewText.length > 120 ?
            previewText.substring(0, 120) + '...' : previewText;
    }

    if (oldPriceEl) {
        if (oldPrice && parseFloat(oldPrice) > parseFloat(price)) {
            oldPriceEl.textContent = formatPrice(oldPrice);
            oldPriceEl.style.display = 'inline';
        } else {
            oldPriceEl.style.display = 'none';
        }
    }

    const mainImage = document.getElementById('mainImagePath').value;
    const previewImg = document.getElementById('previewImage');
    const previewPlaceholder = document.getElementById('previewPlaceholder');

    if (previewImg && previewPlaceholder) {
        if (mainImage) {
            previewImg.src = mainImage;
            previewImg.style.display = 'block';
            previewPlaceholder.style.display = 'none';
        } else {
            previewImg.style.display = 'none';
            previewPlaceholder.style.display = 'block';
        }
    }

    updatePreviewBadges();
    updatePreviewSpecs();
}

function updatePreviewBadges() {
    const badgesEl = document.getElementById('previewBadges');
    if (!badgesEl) return;

    const selectedBadges = JSON.parse(document.getElementById('selectedBadges').value || '[]');

    const badgeColors = {
        new: 'success', hit: 'danger', recommend: 'warning',
        discount: 'info', premium: 'dark', eco: 'success'
    };

    const badgeTexts = {
        new: 'üÜï –ù–æ–≤–∏–Ω–∫–∞', hit: 'üî• –•–∏—Ç', recommend: '‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º',
        discount: 'üí∏ –°–∫–∏–¥–∫–∞', premium: 'üíé –ü—Ä–µ–º–∏—É–º', eco: 'üåø –≠–∫–æ'
    };

    const badgesHtml = selectedBadges.map(badge => {
        const color = badgeColors[badge] || 'secondary';
        const text = badgeTexts[badge] || badge;
        return `<span class='badge bg-${color} me-1 mb-1'>${text}</span>`;
    }).join('');

    badgesEl.innerHTML = badgesHtml;
}

function updatePreviewSpecs() {
    const specsEl = document.getElementById('previewSpecs');
    if (!specsEl) return;

    const specs = [];

    const specFields = [
        { field: 'size', icon: 'üìè' },
        { field: 'temperature', icon: 'üå°Ô∏è' },
        { field: 'ph_level', icon: 'üíß' },
        { field: 'lighting', icon: 'üí°' }
    ];

    specFields.forEach(({ field, icon }) => {
        const value = document.querySelector(`[name='${field}']`)?.value;
        if (value) {
            specs.push(`${icon} ${value}`);
        }
    });

    if (specs.length > 0) {
        specsEl.innerHTML = `<small class='text-muted d-block mt-2'>${specs.join(' ‚Ä¢ ')}</small>`;
    } else {
        specsEl.innerHTML = '';
    }
}

function calculateDiscount() {
    const price = parseFloat(document.getElementById('productPrice').value) || 0;
    const oldPrice = parseFloat(document.getElementById('productOldPrice').value) || 0;
    const infoEl = document.getElementById('discountInfo');

    if (!infoEl) return;

    if (price > 0 && oldPrice > price) {
        const discount = Math.round(((oldPrice - price) / oldPrice) * 100);
        const savings = oldPrice - price;

        infoEl.innerHTML = `<small class='text-success'>‚ú® –°–∫–∏–¥–∫–∞: ${discount}% (—ç–∫–æ–Ω–æ–º–∏—è ${formatPrice(savings, false)})</small>`;

        const discountBadge = document.getElementById('badge_discount');
        if (discountBadge && !discountBadge.checked) {
            discountBadge.checked = true;
            updateBadges();
        }
    } else if (oldPrice > 0 && oldPrice <= price) {
        infoEl.innerHTML = '<small class="text-warning">‚ö†Ô∏è –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–π</small>';
    } else {
        infoEl.innerHTML = '<small class="text-muted">–£–∫–∞–∂–∏—Ç–µ —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏</small>';
    }

    updateLivePreview();
}

function updateBadges() {
    const badges = [];
    const checkboxes = document.querySelectorAll('.badges-container input[type="checkbox"]:checked');

    checkboxes.forEach(checkbox => {
        badges.push(checkbox.value);
    });

    document.getElementById('selectedBadges').value = JSON.stringify(badges);
    updateLivePreview();
}

function formatPrice(price, withSymbol = true) {
    const numPrice = parseFloat(price) || 0;

    if (withSymbol) {
        return new Intl.NumberFormat('ru-RU', {
            style: 'currency',
            currency: 'RUB',
            minimumFractionDigits: 0
        }).format(numPrice);
    } else {
        return new Intl.NumberFormat('ru-RU', {
            minimumFractionDigits: 0
        }).format(numPrice) + ' ‚ÇΩ';
    }
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function showNotification(message, type = 'success', duration = 5000) {
    const alertClass = {
        'success': 'alert-success',
        'error': 'alert-danger',
        'warning': 'alert-warning',
        'info': 'alert-info'
    }[type] || 'alert-info';

    const icon = {
        'success': 'check-circle',
        'error': 'exclamation-triangle',
        'warning': 'exclamation-circle',
        'info': 'info-circle'
    }[type] || 'info-circle';

    const notification = document.createElement('div');
    notification.className = `alert ${alertClass} alert-dismissible fade show notification`;
    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 350px; border-radius: 12px;';
    notification.innerHTML = `
        <div class='d-flex align-items-center'>
            <i class='fas fa-${icon} me-2'></i>
            <span>${message}</span>
        </div>
        <button type='button' class='btn-close' onclick='this.parentElement.remove()'></button>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        if (notification.parentNode) {
            notification.classList.add('fade');
            setTimeout(() => notification.remove(), 300);
        }
    }, duration);

    return notification;
}

function generateSKU() {
    const newSKU = 'PLT_' + Math.random().toString(36).substr(2, 6).toUpperCase();
    document.getElementById('productSKU').value = newSKU;
    showNotification('üîÑ SKU —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!', 'success');
}

function previewProduct() {
    const productData = {
        name: document.getElementById('productName').value,
        price: document.getElementById('productPrice').value,
        old_price: document.getElementById('productOldPrice').value,
        description: document.getElementById('productDescription').value,
        main_image: document.getElementById('mainImagePath').value,
        gallery: galleryImages.map(img => img.url || img),
        badges: JSON.parse(document.getElementById('selectedBadges').value || '[]')
    };

    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h5 class='modal-title'>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞</h5>
                    <button type='button' class='btn-close' data-bs-dismiss='modal'></button>
                </div>
                <div class='modal-body'>
                    <div class='row'>
                        <div class='col-md-6'>
                            <img src='${productData.main_image || 'https://via.placeholder.com/400x400?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'}'
                                 class='img-fluid rounded' alt='–¢–æ–≤–∞—Ä'>
                            <div class='gallery-preview mt-3'>
                                ${productData.gallery.map(img => `
                                    <img src='${img}' class='img-thumbnail me-2' style='width: 80px; height: 80px; object-fit: cover;'>
                                `).join('')}
                            </div>
                        </div>
                        <div class='col-md-6'>
                            <div class='badges mb-2'>
                                ${productData.badges.map(badge => {
                                    const badgeColors = {new: 'success', hit: 'danger', recommend: 'warning', discount: 'info', premium: 'dark', eco: 'success'};
                                    const badgeTexts = {new: 'üÜï –ù–æ–≤–∏–Ω–∫–∞', hit: 'üî• –•–∏—Ç', recommend: '‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º', discount: 'üí∏ –°–∫–∏–¥–∫–∞', premium: 'üíé –ü—Ä–µ–º–∏—É–º', eco: 'üåø –≠–∫–æ'};
                                    return `<span class='badge bg-${badgeColors[badge]} me-1'>${badgeTexts[badge]}</span>`;
                                }).join('')}
                            </div>
                            <h4>${productData.name || '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'}</h4>
                            <div class='price mb-3'>
                                <span class='h4 text-success'>${formatPrice(productData.price)}</span>
                                ${productData.old_price && parseFloat(productData.old_price) > parseFloat(productData.price) ?
                                    `<span class='text-muted text-decoration-line-through ms-2'>${formatPrice(productData.old_price)}</span>` : ''}
                            </div>
                            <div class='description'>
                                <p>${productData.description.replace(/\\n/g, '<br>') || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                            </div>
                            <button class='btn btn-success btn-lg w-100'>
                                <i class='fas fa-shopping-cart me-2'></i>–ö—É–ø–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();

    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });

    showNotification('üëÅÔ∏è –û—Ç–∫—Ä—ã—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞', 'info');
}

// –ò–ò —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
async function aiGenerateAll() {
    const name = document.getElementById('productName').value;

    if (!name) {
        showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞!', 'warning');
        return;
    }

    addAIMessage(`üöÄ –ó–∞–ø—É—Å–∫–∞—é –ø–æ–ª–Ω—É—é –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–∞ '${name}'! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...`, true);

    setTimeout(async () => {
        removeTemporaryMessages();

        await aiGenerateDescription();
        setTimeout(async () => {
            await aiSuggestPrice();
            setTimeout(async () => {
                await aiGenerateTags();
                setTimeout(async () => {
                    await generateSEO();
                    setTimeout(() => {
                        const recommendBadge = document.getElementById('badge_recommend');
                        const newBadge = document.getElementById('badge_new');

                        if (recommendBadge) recommendBadge.checked = true;
                        if (newBadge) newBadge.checked = true;
                        updateBadges();

                        addAIMessage('üéâ –ü–æ–ª–Ω–∞—è –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –¢–æ–≤–∞—Ä –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏! üöÄ');
                        showNotification('üéâ –ò–ò –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!', 'success', 8000);

                    }, 1000);
                }, 1000);
            }, 1000);
        }, 1000);
    }, 2000);
}

// –û—Å—Ç–∞–ª—å–Ω—ã–µ –ò–ò —Ñ—É–Ω–∫—Ü–∏–∏ (–∑–∞–≥–ª—É—à–∫–∏)
async function aiGenerateDescription() {
    addAIMessage('üìù –ì–µ–Ω–µ—Ä–∏—Ä—É—é —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ò–ò-–∞–Ω–∞–ª–∏–∑–∞...', true);
    setTimeout(() => {
        removeTemporaryMessages();
        addAIMessage('‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ! –°–æ–∑–¥–∞–ª –ø—Ä–æ–¥–∞—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ –∏ SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π.');
        showNotification('üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é –ò–ò!', 'success');
    }, 2500);
}

async function aiSuggestPrice() {
    addAIMessage('üí∞ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ä—ã–Ω–æ–∫ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã...', true);
    setTimeout(() => {
        removeTemporaryMessages();
        addAIMessage('üí∞ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞! –£—Å—Ç–∞–Ω–æ–≤–∏–ª –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω—É—é —Ü–µ–Ω—É —Å –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–π —Å–∫–∏–¥–∫–æ–π.');
        showNotification('üí∞ –¶–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é –ò–ò!', 'success');
    }, 3000);
}

async function aiGenerateTags() {
    addAIMessage('üè∑Ô∏è –ü–æ–¥–±–∏—Ä–∞—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ–≥–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞...', true);
    setTimeout(() => {
        removeTemporaryMessages();
        addAIMessage('üè∑Ô∏è –¢–µ–≥–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã! –°–æ–∑–¥–∞–ª –Ω–∞–±–æ—Ä SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤ –¥–ª—è –ª—É—á—à–µ–π –Ω–∞—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞.');
        showNotification('üè∑Ô∏è –¢–µ–≥–∏ —Å–æ–∑–¥–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é –ò–ò!', 'success');
    }, 2000);
}

async function generateSEO() {
    addAIMessage('üéØ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É—é SEO –ø–∞—Ä–∞–º–µ—Ç—Ä—ã...', true);
    setTimeout(() => {
        removeTemporaryMessages();
        addAIMessage('üéØ SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°–æ–∑–¥–∞–ª –º–µ—Ç–∞-—Ç–µ–≥–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º.');
        showNotification('üéØ SEO –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω!', 'success');
    }, 2000);
}

function saveAsDraft() {
    showNotification('üíæ –ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ!', 'success');
    addAIMessage('üíæ –ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∂–µ.');
}

function aiValidateForm() {
    const name = document.getElementById('productName').value;
    const price = document.getElementById('productPrice').value;
    const description = document.getElementById('productDescription').value;
    const category = document.getElementById('productCategory').value;

    if (!name || !price || !description || !category) {
        showNotification('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'warning');
        addAIMessage('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è! –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ü–µ–Ω—É –∏ –æ–ø–∏—Å–∞–Ω–∏–µ.');
    } else {
        showNotification('‚úÖ –¢–æ–≤–∞—Ä –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!', 'success');
        addAIMessage('‚úÖ –ü—Ä–æ–≤–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É - —Ç–æ–≤–∞—Ä –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏! –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.');
    }
}

// –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
function aiImproveDescription() { addAIMessage('üìù –£–ª—É—á—à–∞—é –æ–ø–∏—Å–∞–Ω–∏–µ... –î–æ–±–∞–≤–∏–ª –±–æ–ª—å—à–µ –ø—Ä–æ–¥–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤!'); }
function aiAnalyzeDescription() { addAIMessage('üìä –ê–Ω–∞–ª–∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è: –æ—Ç–ª–∏—á–Ω–∞—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∏ SEO!'); }
function aiOptimizeSEO() { addAIMessage('üéØ –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –†–æ—Å—Ç –ø–æ–∑–∏—Ü–∏–π –æ–∂–∏–¥–∞–µ—Ç—Å—è.'); }
function aiSuggestName() { addAIMessage('üí° –ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!'); }
function showTemplates() { addAIMessage('üìã –®–∞–±–ª–æ–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ —Å–ø—Ä–∞–≤–∞!'); }
function aiGenerateImage() { addAIMessage('üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ò–ò —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞!'); }
function aiEnhanceImages() { addAIMessage('üñºÔ∏è –£–ª—É—á—à–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ!'); }
function aiOptimizeImages() { addAIMessage('üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞!'); }
function aiRemoveBackground() { addAIMessage('‚úÇÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ - –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è!'); }
function aiEnhanceSpecificImage() { addAIMessage('‚ú® –ò–ò-—É–ª—É—á—à–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–≤—ã—à–µ–Ω–æ.'); }
function cropImage() { addAIMessage('‚úÇÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!'); }
function editImage() { addAIMessage('‚úÇÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!'); }

console.log('üöÄ –ü–û–õ–ù–ê–Ø –≤–µ—Ä—Å–∏—è –º–µ–≥–∞ –∫—Ä—É—Ç–æ–≥–æ –ò–ò —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
console.log(`üîß –¢–æ–≤–∞—Ä ID: ${currentProductId || '–Ω–æ–≤—ã–π'}`);
console.log('üí° –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: Ctrl+S (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å), Ctrl+Enter (–ò–ò —á–∞—Ç)');
</script>

</body>
</html>
